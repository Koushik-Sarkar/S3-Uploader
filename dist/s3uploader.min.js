!function(global){var Uploader=function(e){"use strict";return{hide:function(){return e.style.display="none",this},attach:function(t,r){return e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent&&e.attachEvent("on"+t,r),function(){Uploader(e).detach(t,r)}},detach:function(t,r){return e.removeEventListener?e.removeEventListener(t,r,!1):e.attachEvent&&e.detachEvent("on"+t,r),this},contains:function(t){return!!t&&(e===t||(e.contains?e.contains(t):!!(8&t.compareDocumentPosition(e))))},insertBefore:function(t){return t.parentNode.insertBefore(e,t),this},remove:function(){return e.parentNode.removeChild(e),this},css:function(t){if(null==e.style)throw new Uploader.Error("Can't apply style to node as it is not on the HTMLElement prototype chain!");return null!=t.opacity&&"string"!=typeof e.style.opacity&&void 0!==e.filters&&(t.filter="alpha(opacity="+Math.round(100*t.opacity)+")"),Uploader.extend(e.style,t),this},hasClass:function(t,r){var n=new RegExp("(^| )"+t+"( |$)");return n.test(e.className)||!(!r||!n.test(e.parentNode.className))},addClass:function(t){return Uploader(e).hasClass(t)||(e.className+=" "+t),this},removeClass:function(t){var r=new RegExp("(^| )"+t+"( |$)");return e.className=e.className.replace(r," ").replace(/^\s+|\s+$/g,""),this},getByClass:function(t,r){var n,o=[];return r&&e.querySelector?e.querySelector("."+t):e.querySelectorAll?e.querySelectorAll("."+t):(n=e.getElementsByTagName("*"),Uploader.each(n,function(e,r){Uploader(r).hasClass(t)&&o.push(r)}),r?o[0]:o)},getFirstByClass:function(t){return Uploader(e).getByClass(t,!0)},children:function(){for(var t=[],r=e.firstChild;r;)1===r.nodeType&&t.push(r),r=r.nextSibling;return t},setText:function(t){return e.innerText=t,e.textContent=t,this},clearText:function(){return Uploader(e).setText("")},hasAttribute:function(t){var r;return e.hasAttribute?!!e.hasAttribute(t)&&null==/^false$/i.exec(e.getAttribute(t)):void 0!==(r=e[t])&&null==/^false$/i.exec(r)}}},iE,NG,PG,QG,RG,SG,TG,UG,VG,WG,XG,ZG,mI,oI,NI,PI,RI,hJ,iJ,jJ,kJ,lJ,mJ,nJ;!function(){"use strict";var Za;Uploader.canvasToBlob=function(e,t,r){return Uploader.dataUriToBlob(e.toDataURL(t,r))},Uploader.dataUriToBlob=function(e){var t,r,n,o,i,a,s,l;return r=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURI(e.split(",")[1]),o=e.split(",")[0].split(":")[1].split(";")[0],t=new ArrayBuffer(r.length),n=new Uint8Array(t),Uploader.each(r,function(e,t){n[e]=t.charCodeAt(0)}),i=t,a=o,s=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,(l=s&&new s)?(l.append(i),l.getBlob(a)):new Blob([i],{type:a})},Uploader.log=function(e,t){window.console&&(t&&"info"!==t?window.console[t]?window.console[t](e):window.console.log("<"+t+"> "+e):window.console.log(e))},Uploader.isObject=function(e){return e&&!e.nodeType&&"[object Object]"===Object.prototype.toString.call(e)},Uploader.isFunction=function(e){return"function"==typeof e},Uploader.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)||e&&window.ArrayBuffer&&e.buffer&&e.buffer.constructor===ArrayBuffer},Uploader.isItemList=function(e){return"[object DataTransferItemList]"===Object.prototype.toString.call(e)},Uploader.isNodeList=function(e){return"[object NodeList]"===Object.prototype.toString.call(e)||e.item&&e.namedItem},Uploader.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},Uploader.trimStr=function(e){return String.prototype.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},Uploader.format=function(e){var t=Array.prototype.slice.call(arguments,1),r=e,n=r.indexOf("{}");return Uploader.each(t,function(e,t){var o=r.substring(0,n),i=r.substring(n+2);if((n=(r=o+t+i).indexOf("{}",n+t.length))<0)return!1}),r},Uploader.isFile=function(e){return window.File&&"[object File]"===Object.prototype.toString.call(e)},Uploader.isFileList=function(e){return window.FileList&&"[object FileList]"===Object.prototype.toString.call(e)},Uploader.isFileOrInput=function(e){return Uploader.isFile(e)||Uploader.isInput(e)},Uploader.isInput=function(e,t){var r=function(e){var r=e.toLowerCase();return t?"file"!==r:"file"===r};return!!(window.HTMLInputElement&&"[object HTMLInputElement]"===Object.prototype.toString.call(e)&&e.type&&r(e.type))||!!(e.tagName&&"input"===e.tagName.toLowerCase()&&e.type&&r(e.type))},Uploader.isBlob=function(e){if(window.Blob&&"[object Blob]"===Object.prototype.toString.call(e))return!0},Uploader.isXhrUploadSupported=function(){var e=document.createElement("input");return e.type="file",void 0!==e.multiple&&"undefined"!=typeof File&&"undefined"!=typeof FormData&&void 0!==Uploader.createXhrInstance().upload},Uploader.createXhrInstance=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){return Uploader.log("Neither XHR or ActiveX are supported!","error"),null}},Uploader.isFolderDropSupported=function(e){return e.items&&e.items.length>0&&e.items[0].webkitGetAsEntry},Uploader.isFileChunkingSupported=function(){return!Uploader.androidStock()&&Uploader.isXhrUploadSupported()&&(void 0!==File.prototype.slice||void 0!==File.prototype.webkitSlice||void 0!==File.prototype.mozSlice)},Uploader.sliceBlob=function(e,t,r){return(e.slice||e.mozSlice||e.webkitSlice).call(e,t,r)},Uploader.arrayBufferToHex=function(e){var t="",r=new Uint8Array(e);return Uploader.each(r,function(e,r){var n=r.toString(16);n.length<2&&(n="0"+n),t+=n}),t},Uploader.readBlobToHex=function(e,t,r){var n=Uploader.sliceBlob(e,t,t+r),o=new FileReader,i=new Uploader.Promise;return o.onload=function(){i.success(Uploader.arrayBufferToHex(o.result))},o.onerror=i.failure,o.readAsArrayBuffer(n),i},Uploader.extend=function(e,t,r){return Uploader.each(t,function(t,n){r&&Uploader.isObject(n)?(void 0===e[t]&&(e[t]={}),Uploader.extend(e[t],n,!0)):e[t]=n}),e},Uploader.override=function(e,t){var r={},n=t(r);return Uploader.each(n,function(t,n){void 0!==e[t]&&(r[t]=e[t]),e[t]=n}),e},Uploader.indexOf=function(e,t,r){if(e.indexOf)return e.indexOf(t,r);r=r||0;var n=e.length;for(r<0&&(r+=n);r<n;r+=1)if(e.hasOwnProperty(r)&&e[r]===t)return r;return-1},Uploader.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},Uploader.ie=function(){return-1!==navigator.userAgent.indexOf("MSIE")||-1!==navigator.userAgent.indexOf("Trident")},Uploader.ie7=function(){return-1!==navigator.userAgent.indexOf("MSIE 7")},Uploader.ie8=function(){return-1!==navigator.userAgent.indexOf("MSIE 8")},Uploader.ie10=function(){return-1!==navigator.userAgent.indexOf("MSIE 10")},Uploader.ie11=function(){return Uploader.ie()&&-1!==navigator.userAgent.indexOf("rv:11")},Uploader.edge=function(){return navigator.userAgent.indexOf("Edge")>=0},Uploader.safari=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Apple")},Uploader.chrome=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Google")},Uploader.opera=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Opera")},Uploader.firefox=function(){return!Uploader.edge()&&!Uploader.ie11()&&-1!==navigator.userAgent.indexOf("Mozilla")&&void 0!==navigator.vendor&&""===navigator.vendor},Uploader.windows=function(){return"Win32"===navigator.platform},Uploader.android=function(){return-1!==navigator.userAgent.toLowerCase().indexOf("android")},Uploader.androidStock=function(){return Uploader.android()&&navigator.userAgent.toLowerCase().indexOf("chrome")<0},Uploader.ios6=function(){return Uploader.ios()&&-1!==navigator.userAgent.indexOf(" OS 6_")},Uploader.ios7=function(){return Uploader.ios()&&-1!==navigator.userAgent.indexOf(" OS 7_")},Uploader.ios8=function(){return Uploader.ios()&&-1!==navigator.userAgent.indexOf(" OS 8_")},Uploader.ios800=function(){return Uploader.ios()&&-1!==navigator.userAgent.indexOf(" OS 8_0 ")},Uploader.ios=function(){return-1!==navigator.userAgent.indexOf("iPad")||-1!==navigator.userAgent.indexOf("iPod")||-1!==navigator.userAgent.indexOf("iPhone")},Uploader.iosChrome=function(){return Uploader.ios()&&-1!==navigator.userAgent.indexOf("CriOS")},Uploader.iosSafari=function(){return Uploader.ios()&&!Uploader.iosChrome()&&-1!==navigator.userAgent.indexOf("Safari")},Uploader.iosSafariWebView=function(){return Uploader.ios()&&!Uploader.iosChrome()&&!Uploader.iosSafari()},Uploader.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},Uploader.toElement=(Za=document.createElement("div"),function(e){Za.innerHTML=e;var t=Za.firstChild;return Za.removeChild(t),t}),Uploader.each=function(e,t){var r;if(e)if(window.Storage&&e.constructor===window.Storage)for(r=0;r<e.length&&!1!==t(e.key(r),e.getItem(e.key(r)));r++);else if(Uploader.isArray(e)||Uploader.isItemList(e)||Uploader.isNodeList(e))for(r=0;r<e.length&&!1!==t(r,e[r]);r++);else if(Uploader.isString(e))for(r=0;r<e.length&&!1!==t(r,e.charAt(r));r++);else for(r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&!1===t(r,e[r]))break},Uploader.bind=function(e,t){if(Uploader.isFunction(e)){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Uploader.extend([],r);return arguments.length&&(n=n.concat(Array.prototype.slice.call(arguments))),e.apply(t,n)}}throw new Error("first parameter must be a function!")},Uploader.obj2url=function(e,t,r){var n=[],o="&",i=function(e,r){var o=t?/\[\]$/.test(t)?t:t+"["+r+"]":r;"undefined"!==o&&"undefined"!==r&&n.push("object"==typeof e?Uploader.obj2url(e,o,!0):"[object Function]"===Object.prototype.toString.call(e)?encodeURIComponent(o)+"="+encodeURIComponent(e()):encodeURIComponent(o)+"="+encodeURIComponent(e))};return!r&&t?(o=/\?/.test(t)?/\?$/.test(t)?"":"&":"?",n.push(t),n.push(Uploader.obj2url(e))):"[object Array]"===Object.prototype.toString.call(e)&&void 0!==e?Uploader.each(e,function(e,t){i(t,e)}):null!=e&&"object"==typeof e?Uploader.each(e,function(e,t){i(t,e)}):n.push(encodeURIComponent(t)+"="+encodeURIComponent(e)),t?n.join(o):n.join(o).replace(/^&/,"").replace(/%20/g,"+")},Uploader.obj2FormData=function(e,t,r){return t||(t=new FormData),Uploader.each(e,function(e,n){e=r?r+"["+e+"]":e,Uploader.isObject(n)?Uploader.obj2FormData(n,t,e):Uploader.isFunction(n)?t.append(e,n()):t.append(e,n)}),t},Uploader.obj2Inputs=function(e,t){var r;return t||(t=document.createElement("form")),Uploader.obj2FormData(e,{append:function(e,n){(r=document.createElement("input")).setAttribute("name",e),r.setAttribute("value",n),t.appendChild(r)}}),t},Uploader.parseJson=function(json){return window.JSON&&Uploader.isFunction(JSON.parse)?JSON.parse(json):eval("("+json+")")},Uploader.getExtension=function(e){var t=e.lastIndexOf(".")+1;if(t>0)return e.substr(t,e.length-t)},Uploader.getFilename=function(e){return Uploader.isInput(e)?e.value.replace(/.*(\/|\\)/,""):Uploader.isFile(e)&&null!==e.fileName&&void 0!==e.fileName?e.fileName:e.name},Uploader.DisposeSupport=function(){var e=[];return{dispose:function(){var t;do{(t=e.shift())&&t()}while(t)},attach:function(){var e=arguments;this.addDisposer(Uploader(e[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(t){e.push(t)}}}}(),function(){"use strict";"function"==typeof define&&define.amd?define(function(){return Uploader}):"undefined"!=typeof module&&module.exports?module.exports=Uploader:global.Uploader=Uploader}(),function(){"use strict";Uploader.Error=function(e){this.message=e},Uploader.Error.prototype=new Error}(),Uploader.version="5.15.6",Uploader.supportedFeatures=function(){"use strict";var e,t,r,n,o,i,a,s,l,u,d,c,p,h,f,g;function m(){return!!window.XMLHttpRequest&&void 0!==Uploader.createXhrInstance().withCredentials}function U(){return void 0!==window.XDomainRequest}return e=function(){var e,t=!0;try{(e=document.createElement("input")).type="file",Uploader(e).hide(),e.disabled&&(t=!1)}catch(e){t=!1}return t}(),t=(n=e&&Uploader.isXhrUploadSupported())&&!Uploader.androidStock(),o=(r=n&&(("draggable"in(g=document.createElement("span"))||"ondragstart"in g&&"ondrop"in g)&&!Uploader.android()&&!Uploader.ios()))&&(Uploader.chrome()||Uploader.opera())&&void 0!==navigator.userAgent.match(/Chrome\/[2][1-9]|Chrome\/[3-9][0-9]/),i=n&&Uploader.isFileChunkingSupported(),a=n&&i&&function(){try{return!!window.localStorage&&Uploader.isFunction(window.localStorage.setItem)}catch(e){return!1}}(),s=n&&(Uploader.chrome()||Uploader.opera())&&void 0!==navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/),l=e&&(void 0!==window.postMessage||n),d=m(),u=U(),c=!!m()||U(),p=void 0!==document.createElement("input").webkitdirectory,h=n&&void 0!==window.FileReader,f=!!n&&!Uploader.androidStock()&&!Uploader.iosChrome(),{ajaxUploading:n,blobUploading:t,canDetermineSize:n,chunking:i,deleteFileCors:c,deleteFileCorsXdr:u,deleteFileCorsXhr:d,dialogElement:!!window.HTMLDialogElement,fileDrop:r,folderDrop:o,folderSelection:p,imagePreviews:h,imageValidation:h,itemSizeValidation:n,pause:i,progressBar:f,resume:a,scaling:h&&t,tiffPreviews:Uploader.safari(),unlimitedScaledImageSize:!Uploader.ios(),uploading:e,uploadCors:l,uploadCustomHeaders:n,uploadNonMultipart:n,uploadViaPaste:s}}(),Uploader.isGenericPromise=function(e){"use strict";return!!(e&&e.then&&Uploader.isFunction(e.then))},Uploader.Promise=function(){"use strict";var e,t,r=[],n=[],o=[],i=0;Uploader.extend(this,{then:function(o,a){return 0===i?(o&&r.push(o),a&&n.push(a)):-1===i?a&&a.apply(null,t):o&&o.apply(null,e),this},done:function(r){return 0===i?o.push(r):r.apply(null,void 0===t?e:t),this},success:function(){return i=1,e=arguments,r.length&&Uploader.each(r,function(t,r){r.apply(null,e)}),o.length&&Uploader.each(o,function(t,r){r.apply(null,e)}),this},failure:function(){return i=-1,t=arguments,n.length&&Uploader.each(n,function(e,r){r.apply(null,t)}),o.length&&Uploader.each(o,function(e,r){r.apply(null,t)}),this}})},Uploader.BlobProxy=function(e,t){"use strict";Uploader.extend(this,{referenceBlob:e,create:function(){return t(e)}})},Uploader.UploadButton=function(e){"use strict";var t,r,n=this,o=new Uploader.DisposeSupport,i={acceptFiles:null,element:null,focusClass:"Uploader-upload-button-focus",folders:!1,hoverClass:"Uploader-upload-button-hover",ios8BrowserCrashWorkaround:!1,multiple:!1,name:"qqfile",onChange:function(e){},title:null};function a(){var e=document.createElement("input");return e.setAttribute(Uploader.UploadButton.BUTTON_ID_ATTR_NAME,r),e.setAttribute("title",i.title),n.setMultiple(i.multiple,e),i.folders&&Uploader.supportedFeatures.folderSelection&&e.setAttribute("webkitdirectory",""),i.acceptFiles&&e.setAttribute("accept",i.acceptFiles),e.setAttribute("type","file"),e.setAttribute("name",i.name),Uploader(e).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:Uploader.ie()&&!Uploader.ie8()?"3500px":"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),!Uploader.ie7()&&Uploader(e).css({height:"100%"}),i.element.appendChild(e),o.attach(e,"change",function(){i.onChange(e)}),o.attach(e,"mouseover",function(){Uploader(i.element).addClass(i.hoverClass)}),o.attach(e,"mouseout",function(){Uploader(i.element).removeClass(i.hoverClass)}),o.attach(e,"focus",function(){Uploader(i.element).addClass(i.focusClass)}),o.attach(e,"blur",function(){Uploader(i.element).removeClass(i.focusClass)}),e}Uploader.extend(i,e),r=Uploader.getUniqueId(),Uploader(i.element).css({position:"relative",overflow:"hidden",direction:"ltr"}),Uploader.extend(this,{getInput:function(){return t},getButtonId:function(){return r},setMultiple:function(e,t){var r=t||this.getInput();i.ios8BrowserCrashWorkaround&&Uploader.ios8()&&(Uploader.iosChrome()||Uploader.iosSafariWebView())?r.setAttribute("multiple",""):e?r.setAttribute("multiple",""):r.removeAttribute("multiple")},setAcceptFiles:function(e){e!==i.acceptFiles&&t.setAttribute("accept",e)},reset:function(){t.parentNode&&Uploader(t).remove(),Uploader(i.element).removeClass(i.focusClass),t=null,t=a()}}),t=a()},Uploader.UploadButton.BUTTON_ID_ATTR_NAME="Uploader-button-id",Uploader.UploadData=function(e){"use strict";var t=[],r={},n={},o={},i={};Uploader.extend(this,{addFile:function(a){var s=a.status||Uploader.status.SUBMITTING,l=t.push({name:a.name,originalName:a.name,uuid:a.uuid,size:null==a.size?-1:a.size,status:s})-1;return a.batchId&&(t[l].batchId=a.batchId,void 0===i[a.batchId]&&(i[a.batchId]=[]),i[a.batchId].push(l)),a.proxyGroupId&&(t[l].proxyGroupId=a.proxyGroupId,void 0===o[a.proxyGroupId]&&(o[a.proxyGroupId]=[]),o[a.proxyGroupId].push(l)),t[l].id=l,r[a.uuid]=l,void 0===n[s]&&(n[s]=[]),n[s].push(l),a.onBeforeStatusChange&&a.onBeforeStatusChange(l),e.onStatusChange(l,null,s),l},retrieve:function(e){return Uploader.isObject(e)&&t.length?void 0!==e.id?function(e){if(Uploader.isArray(e)){var r=[];return Uploader.each(e,function(e,n){r.push(t[n])}),r}return t[e]}(e.id):void 0!==e.uuid?function(e){if(Uploader.isArray(e)){var n=[];return Uploader.each(e,function(e,o){n.push(t[r[o]])}),n}return t[r[e]]}(e.uuid):e.status?(o=e.status,i=[],a=[].concat(o),Uploader.each(a,function(e,r){var o=n[r];void 0!==o&&Uploader.each(o,function(e,r){i.push(t[r])})}),i):void 0:Uploader.extend([],t,!0);var o,i,a},reset:function(){t=[],r={},n={},i={}},setStatus:function(r,o){var i=t[r].status,a=Uploader.indexOf(n[i],r);n[i].splice(a,1),t[r].status=o,void 0===n[o]&&(n[o]=[]),n[o].push(r),e.onStatusChange(r,i,o)},uuidChanged:function(e,n){var o=t[e].uuid;t[e].uuid=n,r[n]=e,delete r[o]},updateName:function(e,r){t[e].name=r},updateSize:function(e,r){t[e].size=r},setParentId:function(e,r){t[e].parentId=r},getIdsInProxyGroup:function(e){var r=t[e].proxyGroupId;return r?o[r]:[]},getIdsInBatch:function(e){var r=t[e].batchId;return i[r]}})},Uploader.status={SUBMITTING:"submitting",SUBMITTED:"submitted",REJECTED:"rejected",QUEUED:"queued",CANCELED:"canceled",PAUSED:"paused",UPLOADING:"uploading",UPLOAD_RETRYING:"retrying upload",UPLOAD_SUCCESSFUL:"upload successful",UPLOAD_FAILED:"upload failed",DELETE_FAILED:"delete failed",DELETING:"deleting",DELETED:"deleted"},function(){"use strict";Uploader.basePublicApi={addBlobs:function(e,t,r){this.addFiles(e,t,r)},addInitialFiles:function(e){var t=this;Uploader.each(e,function(e,r){t._addCannedFile(r)})},addFiles:function(e,t,r){this._maybeHandleIos8SafariWorkaround();var n=0===this._storedIds.length?Uploader.getUniqueId():this._currentBatchId,o=Uploader.bind(function(e){this._handleNewFile({blob:e,name:this._options.blobs.defaultName},n,d)},this),i=Uploader.bind(function(e){this._handleNewFile(e,n,d)},this),a=Uploader.bind(function(e){var t=Uploader.canvasToBlob(e);this._handleNewFile({blob:t,name:this._options.blobs.defaultName+".png"},n,d)},this),s=Uploader.bind(function(e){var t=e.quality&&e.quality/100,r=Uploader.canvasToBlob(e.canvas,e.type,t);this._handleNewFile({blob:r,name:e.name},n,d)},this),l=Uploader.bind(function(e){if(Uploader.isInput(e)&&Uploader.supportedFeatures.ajaxUploading){var t=Array.prototype.slice.call(e.files),r=this;Uploader.each(t,function(e,t){r._handleNewFile(t,n,d)})}else this._handleNewFile(e,n,d)},this),u=this,d=[];this._currentBatchId=n,e&&(Uploader.isFileList(e)&&(e=Array.prototype.slice.call(e)),e=[].concat(e),Uploader.each(e,function(e,t){Uploader.isFileOrInput(t)?l(t):Uploader.isBlob(t)?o(t):Uploader.isObject(t)?t.blob&&t.name?i(t):t.canvas&&t.name&&s(t):t.tagName&&"canvas"===t.tagName.toLowerCase()?a(t):u.log(t+" is not a valid file container!  Ignoring!","warn")}),this.log("Received "+d.length+" files."),this._prepareItemsForUpload(d,t,r))},cancel:function(e){this._handler.cancel(e)},cancelAll:function(){var e=[],t=this;Uploader.extend(e,this._storedIds),Uploader.each(e,function(e,r){t.cancel(r)}),this._handler.cancelAll()},clearStoredFiles:function(){this._storedIds=[]},continueUpload:function(e){var t=this._uploadData.retrieve({id:e});return!(!Uploader.supportedFeatures.pause||!this._options.chunking.enabled)&&(t.status===Uploader.status.PAUSED?(this.log(Uploader.format("Paused file ID {} ({}) will be continued.  Not paused.",e,this.getName(e))),this._uploadFile(e),!0):(this.log(Uploader.format("Ignoring continue for file ID {} ({}).  Not paused.",e,this.getName(e)),"error"),!1))},deleteFile:function(e){return this._onSubmitDelete(e)},doesExist:function(e){return this._handler.isValid(e)},drawThumbnail:function(e,t,r,n,o){var i,a,s=new Uploader.Promise;return this._imageGenerator?(i=this._thumbnailUrls[e],a={customResizeFunction:o,maxSize:r>0?r:null,scale:r>0},!n&&Uploader.supportedFeatures.imagePreviews&&(i=this.getFile(e)),null==i?s.failure({container:t,error:"File or URL not found."}):this._imageGenerator.generate(i,t,a).then(function(e){s.success(e)},function(e,t){s.failure({container:e,error:t||"Problem generating thumbnail"})})):s.failure({container:t,error:"Missing image generator module"}),s},getButton:function(e){return this._getButton(this._buttonIdsForFileIds[e])},getEndpoint:function(e){return this._endpointStore.get(e)},getFile:function(e){return this._handler.getFile(e)||null},getInProgress:function(){return this._uploadData.retrieve({status:[Uploader.status.UPLOADING,Uploader.status.UPLOAD_RETRYING,Uploader.status.QUEUED]}).length},getName:function(e){return this._uploadData.retrieve({id:e}).name},getParentId:function(e){var t=this.getUploads({id:e}),r=null;return t&&void 0!==t.parentId&&(r=t.parentId),r},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(e){return this._uploadData.retrieve({id:e}).size},getNetUploads:function(){return this._netUploaded},getRemainingAllowedItems:function(){var e=this._currentItemLimit;return e>0?e-this._netUploadedOrQueued:null},getUploads:function(e){return this._uploadData.retrieve(e)},getUuid:function(e){return this._uploadData.retrieve({id:e}).uuid},log:function(e,t){!this._options.debug||t&&"info"!==t?t&&"info"!==t&&Uploader.log(e,t):Uploader.log(e)},pauseUpload:function(e){var t=this._uploadData.retrieve({id:e});if(!Uploader.supportedFeatures.pause||!this._options.chunking.enabled)return!1;if(Uploader.indexOf([Uploader.status.UPLOADING,Uploader.status.UPLOAD_RETRYING],t.status)>=0){if(this._handler.pause(e))return this._uploadData.setStatus(e,Uploader.status.PAUSED),!0;this.log(Uploader.format("Unable to pause file ID {} ({}).",e,this.getName(e)),"error")}else this.log(Uploader.format("Ignoring pause for file ID {} ({}).  Not in progress.",e,this.getName(e)),"error");return!1},removeFileRef:function(e){this._handler.expunge(e)},reset:function(){this.log("Resetting uploader..."),this._handler.reset(),this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],Uploader.each(this._buttons,function(e,t){t.reset()}),this._paramsStore.reset(),this._endpointStore.reset(),this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData.reset(),this._buttonIdsForFileIds=[],this._pasteHandler&&this._pasteHandler.reset(),this._options.session.refreshOnReset&&this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._totalProgress&&this._totalProgress.reset()},retry:function(e){return this._manualRetry(e)},scaleImage:function(e,t){var r=this;return Uploader.Scaler.prototype.scaleImage(e,t,{log:Uploader.bind(r.log,r),getFile:Uploader.bind(r.getFile,r),uploadData:r._uploadData})},setCustomHeaders:function(e,t){this._customHeadersStore.set(e,t)},setDeleteFileCustomHeaders:function(e,t){this._deleteFileCustomHeadersStore.set(e,t)},setDeleteFileEndpoint:function(e,t){this._deleteFileEndpointStore.set(e,t)},setDeleteFileParams:function(e,t){this._deleteFileParamsStore.set(e,t)},setEndpoint:function(e,t){this._endpointStore.set(e,t)},setForm:function(e){this._updateFormSupportAndParams(e)},setItemLimit:function(e){this._currentItemLimit=e},setName:function(e,t){this._uploadData.updateName(e,t)},setParams:function(e,t){this._paramsStore.set(e,t)},setUuid:function(e,t){return this._uploadData.uuidChanged(e,t)},setStatus:function(e,t){if(!this.getUploads({id:e}))throw new Uploader.Error(e+" is not a valid file ID.");switch(t){case Uploader.status.DELETED:this._onDeleteComplete(e,null,!1);break;case Uploader.status.DELETE_FAILED:this._onDeleteComplete(e,null,!0);break;default:var r="Method setStatus called on '"+name+"' not implemented yet for "+t;throw this.log(r),new Uploader.Error(r)}},uploadStoredFiles:function(){0===this._storedIds.length?this._itemError("noFilesError"):this._uploadStoredFiles()}},Uploader.basePrivateApi={_addCannedFile:function(e){var t=this;return this._uploadData.addFile({uuid:e.uuid,name:e.name,size:e.size,status:Uploader.status.UPLOAD_SUCCESSFUL,onBeforeStatusChange:function(r){e.deleteFileEndpoint&&t.setDeleteFileEndpoint(e.deleteFileEndpoint,r),e.deleteFileParams&&t.setDeleteFileParams(e.deleteFileParams,r),e.thumbnailUrl&&(t._thumbnailUrls[r]=e.thumbnailUrl),t._netUploaded++,t._netUploadedOrQueued++}})},_annotateWithButtonId:function(e,t){Uploader.isFile(e)&&(e.qqButtonId=this._getButtonId(t))},_batchError:function(e){this._options.callbacks.onError(null,null,e,void 0)},_createDeleteHandler:function(){var e=this;return new Uploader.DeleteFileAjaxRequester({method:this._options.deleteFile.method.toUpperCase(),maxConnections:this._options.maxConnections,uuidParamName:this._options.request.uuidName,customHeaders:this._deleteFileCustomHeadersStore,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,cors:this._options.cors,log:Uploader.bind(e.log,e),onDelete:function(t){e._onDelete(t),e._options.callbacks.onDelete(t)},onDeleteComplete:function(t,r,n){e._onDeleteComplete(t,r,n),e._options.callbacks.onDeleteComplete(t,r,n)}})},_createPasteHandler:function(){var e=this;return new Uploader.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:Uploader.bind(e.log,e),pasteReceived:function(t){e._handleCheckedCallback({name:"onPasteReceived",callback:Uploader.bind(e._options.callbacks.onPasteReceived,e,t),onSuccess:Uploader.bind(e._handlePasteSuccess,e,t),identifier:"pasted image"})}}})},_createStore:function(e,t){var r={},n=e,o={},i=t,a=function(e){return Uploader.isObject(e)?Uploader.extend({},e):e},s=function(e,t){i&&Uploader.isObject(t)&&Uploader.extend(t,Uploader.isFunction(i)?i():i),o[e]&&Uploader.extend(t,o[e])};return{set:function(e,t){null==t?(r={},n=a(e)):r[t]=a(e)},get:function(e){var t;return t=null!=e&&r[e]?r[e]:a(n),s(e,t),a(t)},addReadOnly:function(e,t){Uploader.isObject(r)&&(null===e?Uploader.isFunction(t)?i=t:(i=i||{},Uploader.extend(i,t)):(o[e]=o[e]||{},Uploader.extend(o[e],t)))},remove:function(e){return delete r[e]},reset:function(){r={},o={},n=e}}},_createUploadDataTracker:function(){var e=this;return new Uploader.UploadData({getName:function(t){return e.getName(t)},getUuid:function(t){return e.getUuid(t)},getSize:function(t){return e.getSize(t)},onStatusChange:function(t,r,n){e._onUploadStatusChange(t,r,n),e._options.callbacks.onStatusChange(t,r,n),e._maybeAllComplete(t,n),e._totalProgress&&setTimeout(function(){e._totalProgress.onStatusChange(t,r,n)},0)}})},_createUploadButton:function(e){var t,r=this,n=e.accept||this._options.validation.acceptFiles,o=e.allowedExtensions||this._options.validation.allowedExtensions;return t=new Uploader.UploadButton({acceptFiles:n,element:e.element,focusClass:this._options.classes.buttonFocus,folders:e.folders,hoverClass:this._options.classes.buttonHover,ios8BrowserCrashWorkaround:this._options.workarounds.ios8BrowserCrash,multiple:!!Uploader.supportedFeatures.ajaxUploading&&!(r._options.workarounds.iosEmptyVideos&&Uploader.ios()&&!Uploader.ios6()&&r._isAllowedExtension(o,".mov"))&&(void 0===e.multiple?r._options.multiple:e.multiple),name:this._options.request.inputName,onChange:function(e){r._onInputChange(e)},title:null==e.title?this._options.text.fileInputTitle:e.title}),this._disposeSupport.addDisposer(function(){t.dispose()}),r._buttons.push(t),t},_createUploadHandler:function(e,t){var r=this,n={},o={debug:this._options.debug,maxConnections:this._options.maxConnections,cors:this._options.cors,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:Uploader.bind(r.log,r),preventRetryParam:this._options.retry.preventRetryResponseProperty,onProgress:function(e,t,o,i){o<0||i<0||(n[e]&&n[e].loaded===o&&n[e].total===i||(r._onProgress(e,t,o,i),r._options.callbacks.onProgress(e,t,o,i)),n[e]={loaded:o,total:i})},onComplete:function(e,t,o,i){delete n[e];var a,s=r.getUploads({id:e}).status;s!==Uploader.status.UPLOAD_SUCCESSFUL&&s!==Uploader.status.UPLOAD_FAILED&&((a=r._onComplete(e,t,o,i))instanceof Uploader.Promise?a.done(function(){r._options.callbacks.onComplete(e,t,o,i)}):r._options.callbacks.onComplete(e,t,o,i))},onCancel:function(e,t,n){var o=new Uploader.Promise;return r._handleCheckedCallback({name:"onCancel",callback:Uploader.bind(r._options.callbacks.onCancel,r,e,t),onFailure:o.failure,onSuccess:function(){n.then(function(){r._onCancel(e,t)}),o.success()},identifier:e}),o},onUploadPrep:Uploader.bind(this._onUploadPrep,this),onUpload:function(e,t){r._onUpload(e,t),r._options.callbacks.onUpload(e,t)},onUploadChunk:function(e,t,n){r._onUploadChunk(e,n),r._options.callbacks.onUploadChunk(e,t,n)},onUploadChunkSuccess:function(e,t,n,o){r._onUploadChunkSuccess(e,t),r._options.callbacks.onUploadChunkSuccess.apply(r,arguments)},onResume:function(e,t,n){return r._options.callbacks.onResume(e,t,n)},onAutoRetry:function(e,t,n,o){return r._onAutoRetry.apply(r,arguments)},onUuidChanged:function(e,t){r.log("Server requested UUID change from '"+r.getUuid(e)+"' to '"+t+"'"),r.setUuid(e,t)},getName:Uploader.bind(r.getName,r),getUuid:Uploader.bind(r.getUuid,r),getSize:Uploader.bind(r.getSize,r),setSize:Uploader.bind(r._setSize,r),getDataByUuid:function(e){return r.getUploads({uuid:e})},isQueued:function(e){var t=r.getUploads({id:e}).status;return t===Uploader.status.QUEUED||t===Uploader.status.SUBMITTED||t===Uploader.status.UPLOAD_RETRYING||t===Uploader.status.PAUSED},getIdsInProxyGroup:r._uploadData.getIdsInProxyGroup,getIdsInBatch:r._uploadData.getIdsInBatch};return Uploader.each(this._options.request,function(e,t){o[e]=t}),o.customHeaders=this._customHeadersStore,e&&Uploader.each(e,function(e,t){o[e]=t}),new Uploader.UploadHandlerController(o,t)},_fileOrBlobRejected:function(e){this._netUploadedOrQueued--,this._uploadData.setStatus(e,Uploader.status.REJECTED)},_formatSize:function(e){if(0===e)return e+this._options.text.sizeSymbols[0];var t=-1;do{e/=1e3,t++}while(e>999);return Math.max(e,.1).toFixed(1)+this._options.text.sizeSymbols[t]},_generateExtraButtonSpecs:function(){var e=this;this._extraButtonSpecs={},Uploader.each(this._options.extraButtons,function(t,r){var n=r.multiple,o=Uploader.extend({},e._options.validation,!0),i=Uploader.extend({},r);void 0===n&&(n=e._options.multiple),i.validation&&Uploader.extend(o,r.validation,!0),Uploader.extend(i,{multiple:n,validation:o},!0),e._initExtraButton(i)})},_getButton:function(e){var t=this._extraButtonSpecs[e];return t?t.element:e===this._defaultButtonId?this._options.button:void 0},_getButtonId:function(e){var t,r,n=e;if(n instanceof Uploader.BlobProxy&&(n=n.referenceBlob),n&&!Uploader.isBlob(n)){if(Uploader.isFile(n))return n.qqButtonId;if("input"===n.tagName.toLowerCase()&&"file"===n.type.toLowerCase())return n.getAttribute(Uploader.UploadButton.BUTTON_ID_ATTR_NAME);if(t=n.getElementsByTagName("input"),Uploader.each(t,function(e,t){if("file"===t.getAttribute("type"))return r=t,!1}),r)return r.getAttribute(Uploader.UploadButton.BUTTON_ID_ATTR_NAME)}},_getNotFinished:function(){return this._uploadData.retrieve({status:[Uploader.status.UPLOADING,Uploader.status.UPLOAD_RETRYING,Uploader.status.QUEUED,Uploader.status.SUBMITTING,Uploader.status.SUBMITTED,Uploader.status.PAUSED]}).length},_getValidationBase:function(e){var t=this._extraButtonSpecs[e];return t?t.validation:this._options.validation},_getValidationDescriptor:function(e){return e.file instanceof Uploader.BlobProxy?{name:Uploader.getFilename(e.file.referenceBlob),size:e.file.referenceBlob.size}:{name:this.getUploads({id:e.id}).name,size:this.getUploads({id:e.id}).size}},_getValidationDescriptors:function(e){var t=this,r=[];return Uploader.each(e,function(e,n){r.push(t._getValidationDescriptor(n))}),r},_handleCameraAccess:function(){if(this._options.camera.ios&&Uploader.ios()){var e="image/*;capture=camera",t=this._options.camera.button,r=t?this._getButtonId(t):this._defaultButtonId,n=this._options;r&&r!==this._defaultButtonId&&(n=this._extraButtonSpecs[r]),n.multiple=!1,null===n.validation.acceptFiles?n.validation.acceptFiles=e:n.validation.acceptFiles+=","+e,Uploader.each(this._buttons,function(e,t){if(t.getButtonId()===r)return t.setMultiple(n.multiple),t.setAcceptFiles(n.acceptFiles),!1})}},_handleCheckedCallback:function(e){var t=this,r=e.callback();return Uploader.isGenericPromise(r)?(this.log(e.name+" - waiting for "+e.name+" promise to be fulfilled for "+e.identifier),r.then(function(r){t.log(e.name+" promise success for "+e.identifier),e.onSuccess(r)},function(){e.onFailure?(t.log(e.name+" promise failure for "+e.identifier),e.onFailure()):t.log(e.name+" promise failure for "+e.identifier)})):(!1!==r?e.onSuccess(r):e.onFailure?(this.log(e.name+" - return value was 'false' for "+e.identifier+".  Invoking failure callback."),e.onFailure()):this.log(e.name+" - return value was 'false' for "+e.identifier+".  Will not proceed."),r)},_handleNewFile:function(e,t,r){var n=this,o=Uploader.getUniqueId(),i=-1,a=Uploader.getFilename(e),s=e.blob||e,l=this._customNewFileHandler?this._customNewFileHandler:Uploader.bind(n._handleNewFileGeneric,n);!Uploader.isInput(s)&&s.size>=0&&(i=s.size),l(s,a,o,i,r,t,this._options.request.uuidName,{uploadData:n._uploadData,paramsStore:n._paramsStore,addFileToHandler:function(e,t){n._handler.add(e,t),n._netUploadedOrQueued++,n._trackButton(e)}})},_handleNewFileGeneric:function(e,t,r,n,o,i){var a=this._uploadData.addFile({uuid:r,name:t,size:n,batchId:i});this._handler.add(a,e),this._trackButton(a),this._netUploadedOrQueued++,o.push({id:a,file:e})},_handlePasteSuccess:function(e,t){var r=e.type.split("/")[1],n=t;null==n&&(n=this._options.paste.defaultName),n+="."+r,this.addFiles({name:n,blob:e})},_handleDeleteSuccess:function(e){if(this.getUploads({id:e}).status!==Uploader.status.DELETED){var t=this.getName(e);this._netUploadedOrQueued--,this._netUploaded--,this._handler.expunge(e),this._uploadData.setStatus(e,Uploader.status.DELETED),this.log("Delete request for '"+t+"' has succeeded.")}},_handleDeleteFailed:function(e,t){var r=this.getName(e);this._uploadData.setStatus(e,Uploader.status.DELETE_FAILED),this.log("Delete request for '"+r+"' has failed.","error"),t&&void 0!==t.withCredentials?this._options.callbacks.onError(e,r,"Delete request failed with response code "+t.status,t):this._options.callbacks.onError(e,r,"Delete request failed",t)},_initExtraButton:function(e){var t=this._createUploadButton({accept:e.validation.acceptFiles,allowedExtensions:e.validation.allowedExtensions,element:e.element,folders:e.folders,multiple:e.multiple,title:e.fileInputTitle});this._extraButtonSpecs[t.getButtonId()]=e},_initFormSupportAndParams:function(){this._formSupport=Uploader.FormSupport&&new Uploader.FormSupport(this._options.form,Uploader.bind(this.uploadStoredFiles,this),Uploader.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm?(this._paramsStore=this._createStore(this._options.request.params,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&(this._options.request.endpoint=this._formSupport.newEndpoint)):this._paramsStore=this._createStore(this._options.request.params)},_isDeletePossible:function(){return!(!Uploader.DeleteFileAjaxRequester||!this._options.deleteFile.enabled)&&(!this._options.cors.expected||(!!Uploader.supportedFeatures.deleteFileCorsXhr||!(!Uploader.supportedFeatures.deleteFileCorsXdr||!this._options.cors.allowXdr)))},_isAllowedExtension:function(e,t){var r=!1;return!e.length||(Uploader.each(e,function(e,n){if(Uploader.isString(n)){var o=new RegExp("\\."+n+"$","i");if(null!=t.match(o))return r=!0,!1}}),r)},_itemError:function(e,t,r){var n,o,i=this._options.messages[e],a=[],s=[].concat(t),l=s[0],u=this._getButtonId(r),d=this._getValidationBase(u);function c(e,t){i=i.replace(e,t)}return Uploader.each(d.allowedExtensions,function(e,t){Uploader.isString(t)&&a.push(t)}),n=a.join(", ").toLowerCase(),c("{file}",this._options.formatFileName(l)),c("{extensions}",n),c("{sizeLimit}",this._formatSize(d.sizeLimit)),c("{minSizeLimit}",this._formatSize(d.minSizeLimit)),null!==(o=i.match(/(\{\w+\})/g))&&Uploader.each(o,function(e,t){c(t,s[e])}),this._options.callbacks.onError(null,l,i,void 0),i},_manualRetry:function(e,t){if(this._onBeforeManualRetry(e))return this._netUploadedOrQueued++,this._uploadData.setStatus(e,Uploader.status.UPLOAD_RETRYING),t?t(e):this._handler.retry(e),!0},_maybeAllComplete:function(e,t){var r=this,n=this._getNotFinished();t===Uploader.status.UPLOAD_SUCCESSFUL?this._succeededSinceLastAllComplete.push(e):t===Uploader.status.UPLOAD_FAILED&&this._failedSinceLastAllComplete.push(e),0===n&&(this._succeededSinceLastAllComplete.length||this._failedSinceLastAllComplete.length)&&setTimeout(function(){r._onAllComplete(r._succeededSinceLastAllComplete,r._failedSinceLastAllComplete)},0)},_maybeHandleIos8SafariWorkaround:function(){var e=this;if(this._options.workarounds.ios8SafariUploads&&Uploader.ios800()&&Uploader.iosSafari())throw setTimeout(function(){window.alert(e._options.messages.unsupportedBrowserIos8Safari)},0),new Uploader.Error(this._options.messages.unsupportedBrowserIos8Safari)},_maybeParseAndSendUploadError:function(e,t,r,n){if(!r.success)if(n&&200!==n.status&&!r.error)this._options.callbacks.onError(e,t,"XHR returned response code "+n.status,n);else{var o=r.error?r.error:this._options.text.defaultResponseError;this._options.callbacks.onError(e,t,o,n)}},_maybeProcessNextItemAfterOnValidateCallback:function(e,t,r,n,o){var i=this;if(t.length>r)if(e||!this._options.validation.stopOnFirstInvalidFile)setTimeout(function(){var e=i._getValidationDescriptor(t[r]),a=i._getButtonId(t[r].file),s=i._getButton(a);i._handleCheckedCallback({name:"onValidate",callback:Uploader.bind(i._options.callbacks.onValidate,i,e,s),onSuccess:Uploader.bind(i._onValidateCallbackSuccess,i,t,r,n,o),onFailure:Uploader.bind(i._onValidateCallbackFailure,i,t,r,n,o),identifier:"Item '"+e.name+"', size: "+e.size})},0);else if(!e)for(;r<t.length;r++)i._fileOrBlobRejected(t[r].id)},_onAllComplete:function(e,t){this._totalProgress&&this._totalProgress.onAllComplete(e,t,this._preventRetries),this._options.callbacks.onAllComplete(Uploader.extend([],e),Uploader.extend([],t)),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[]},_onAutoRetry:function(e,t,r,n,o){var i=this;if(i._preventRetries[e]=r[i._options.retry.preventRetryResponseProperty],i._shouldAutoRetry(e,t,r)){var a=1e3*i._options.retry.autoAttemptDelay;return i._options.callbacks.onAutoRetry(e,t,i._autoRetries[e]),i._onBeforeAutoRetry(e,t),i._uploadData.setStatus(e,Uploader.status.UPLOAD_RETRYING),i._retryTimeouts[e]=setTimeout(function(){i.log("Starting retry for "+t+"..."),o?o(e):i._handler.retry(e)},a),!0}},_onBeforeAutoRetry:function(e,t){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+t+"...")},_onBeforeManualRetry:function(e){var t,r=this._currentItemLimit;return this._preventRetries[e]?(this.log("Retries are forbidden for id "+e,"warn"),!1):this._handler.isValid(e)?(t=this.getName(e),!1!==this._options.callbacks.onManualRetry(e,t)&&(r>0&&this._netUploadedOrQueued+1>r?(this._itemError("retryFailTooManyItems"),!1):(this.log("Retrying upload for '"+t+"' (id: "+e+")..."),!0))):(this.log("'"+e+"' is not a valid file ID","error"),!1)},_onCancel:function(e,t){this._netUploadedOrQueued--,clearTimeout(this._retryTimeouts[e]);var r=Uploader.indexOf(this._storedIds,e);!this._options.autoUpload&&r>=0&&this._storedIds.splice(r,1),this._uploadData.setStatus(e,Uploader.status.CANCELED)},_onComplete:function(e,t,r,n){return r.success?(r.thumbnailUrl&&(this._thumbnailUrls[e]=r.thumbnailUrl),this._netUploaded++,this._uploadData.setStatus(e,Uploader.status.UPLOAD_SUCCESSFUL)):(this._netUploadedOrQueued--,this._uploadData.setStatus(e,Uploader.status.UPLOAD_FAILED),!0===r[this._options.retry.preventRetryResponseProperty]&&(this._preventRetries[e]=!0)),this._maybeParseAndSendUploadError(e,t,r,n),!!r.success},_onDelete:function(e){this._uploadData.setStatus(e,Uploader.status.DELETING)},_onDeleteComplete:function(e,t,r){this.getName(e);r?this._handleDeleteFailed(e,t):this._handleDeleteSuccess(e)},_onInputChange:function(e){var t;if(Uploader.supportedFeatures.ajaxUploading){for(t=0;t<e.files.length;t++)this._annotateWithButtonId(e.files[t],e);this.addFiles(e.files)}else e.value.length>0&&this.addFiles(e);Uploader.each(this._buttons,function(e,t){t.reset()})},_onProgress:function(e,t,r,n){this._totalProgress&&this._totalProgress.onIndividualProgress(e,r,n)},_onSubmit:function(e,t){},_onSubmitCallbackSuccess:function(e,t){this._onSubmit.apply(this,arguments),this._uploadData.setStatus(e,Uploader.status.SUBMITTED),this._onSubmitted.apply(this,arguments),this._options.autoUpload?(this._options.callbacks.onSubmitted.apply(this,arguments),this._uploadFile(e)):(this._storeForLater(e),this._options.callbacks.onSubmitted.apply(this,arguments))},_onSubmitDelete:function(e,t,r){var n,o=this.getUuid(e);return t&&(n=Uploader.bind(t,this,e,o,r)),this._isDeletePossible()?(this._handleCheckedCallback({name:"onSubmitDelete",callback:Uploader.bind(this._options.callbacks.onSubmitDelete,this,e),onSuccess:n||Uploader.bind(this._deleteHandler.sendDelete,this,e,o,r),identifier:e}),!0):(this.log("Delete request ignored for ID "+e+", delete feature is disabled or request not possible due to CORS on a user agent that does not support pre-flighting.","warn"),!1)},_onSubmitted:function(e){},_onTotalProgress:function(e,t){this._options.callbacks.onTotalProgress(e,t)},_onUploadPrep:function(e){},_onUpload:function(e,t){this._uploadData.setStatus(e,Uploader.status.UPLOADING)},_onUploadChunk:function(e,t){},_onUploadChunkSuccess:function(e,t){!this._preventRetries[e]&&this._options.retry.enableAuto&&(this._autoRetries[e]=0)},_onUploadStatusChange:function(e,t,r){r===Uploader.status.PAUSED&&clearTimeout(this._retryTimeouts[e])},_onValidateBatchCallbackFailure:function(e){var t=this;Uploader.each(e,function(e,r){t._fileOrBlobRejected(r.id)})},_onValidateBatchCallbackSuccess:function(e,t,r,n,o){var i,a=this._currentItemLimit,s=this._netUploadedOrQueued;0===a||s<=a?t.length>0?this._handleCheckedCallback({name:"onValidate",callback:Uploader.bind(this._options.callbacks.onValidate,this,e[0],o),onSuccess:Uploader.bind(this._onValidateCallbackSuccess,this,t,0,r,n),onFailure:Uploader.bind(this._onValidateCallbackFailure,this,t,0,r,n),identifier:"Item '"+t[0].file.name+"', size: "+t[0].file.size}):this._itemError("noFilesError"):(this._onValidateBatchCallbackFailure(t),i=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,s).replace(/\{itemLimit\}/g,a),this._batchError(i))},_onValidateCallbackFailure:function(e,t,r,n){var o=t+1;this._fileOrBlobRejected(e[t].id,e[t].file.name),this._maybeProcessNextItemAfterOnValidateCallback(!1,e,o,r,n)},_onValidateCallbackSuccess:function(e,t,r,n){var o=this,i=t+1,a=this._getValidationDescriptor(e[t]);this._validateFileOrBlobData(e[t],a).then(function(){o._upload(e[t].id,r,n),o._maybeProcessNextItemAfterOnValidateCallback(!0,e,i,r,n)},function(){o._maybeProcessNextItemAfterOnValidateCallback(!1,e,i,r,n)})},_prepareItemsForUpload:function(e,t,r){if(0!==e.length){var n=this._getValidationDescriptors(e),o=this._getButtonId(e[0].file),i=this._getButton(o);this._handleCheckedCallback({name:"onValidateBatch",callback:Uploader.bind(this._options.callbacks.onValidateBatch,this,n,i),onSuccess:Uploader.bind(this._onValidateBatchCallbackSuccess,this,n,e,t,r,i),onFailure:Uploader.bind(this._onValidateBatchCallbackFailure,this,e),identifier:"batch validation"})}else this._itemError("noFilesError")},_preventLeaveInProgress:function(){var e=this;this._disposeSupport.attach(window,"beforeunload",function(t){if(e.getInProgress())return(t=t||window.event).returnValue=e._options.messages.onLeave,e._options.messages.onLeave})},_refreshSessionData:function(){var e=this,t=this._options.session;Uploader.Session&&null!=this._options.session.endpoint&&(this._session||(Uploader.extend(t,{cors:this._options.cors}),t.log=Uploader.bind(this.log,this),t.addFileRecord=Uploader.bind(this._addCannedFile,this),this._session=new Uploader.Session(t)),setTimeout(function(){e._session.refresh().then(function(t,r){e._sessionRequestComplete(),e._options.callbacks.onSessionRequestComplete(t,!0,r)},function(t,r){e._options.callbacks.onSessionRequestComplete(t,!1,r)})},0))},_sessionRequestComplete:function(){},_setSize:function(e,t){this._uploadData.updateSize(e,t),this._totalProgress&&this._totalProgress.onNewSize(e)},_shouldAutoRetry:function(e,t,r){var n=this._uploadData.retrieve({id:e});return!!(!this._preventRetries[e]&&this._options.retry.enableAuto&&n.status!==Uploader.status.PAUSED&&(void 0===this._autoRetries[e]&&(this._autoRetries[e]=0),this._autoRetries[e]<this._options.retry.maxAutoAttempts))&&(this._autoRetries[e]+=1,!0)},_storeForLater:function(e){this._storedIds.push(e)},_trackButton:function(e){var t;(t=Uploader.supportedFeatures.ajaxUploading?this._handler.getFile(e).qqButtonId:this._getButtonId(this._handler.getInput(e)))&&(this._buttonIdsForFileIds[e]=t)},_updateFormSupportAndParams:function(e){this._options.form.element=e,this._formSupport=Uploader.FormSupport&&new Uploader.FormSupport(this._options.form,Uploader.bind(this.uploadStoredFiles,this),Uploader.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm&&(this._paramsStore.addReadOnly(null,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&this.setEndpoint(this._formSupport.newEndpoint))},_upload:function(e,t,r){var n=this.getName(e);t&&this.setParams(t,e),r&&this.setEndpoint(r,e),this._handleCheckedCallback({name:"onSubmit",callback:Uploader.bind(this._options.callbacks.onSubmit,this,e,n),onSuccess:Uploader.bind(this._onSubmitCallbackSuccess,this,e,n),onFailure:Uploader.bind(this._fileOrBlobRejected,this,e,n),identifier:e})},_uploadFile:function(e){this._handler.upload(e)||this._uploadData.setStatus(e,Uploader.status.QUEUED)},_uploadStoredFiles:function(){for(var e,t,r=this;this._storedIds.length;)e=this._storedIds.shift(),this._uploadFile(e);(t=this.getUploads({status:Uploader.status.SUBMITTING}).length)&&(Uploader.log("Still waiting for "+t+" files to clear submit queue. Will re-parse stored IDs array shortly."),setTimeout(function(){r._uploadStoredFiles()},1e3))},_validateFileOrBlobData:function(e,t){var r=this,n=e.file instanceof Uploader.BlobProxy?e.file.referenceBlob:e.file,o=t.name,i=t.size,a=this._getButtonId(e.file),s=this._getValidationBase(a),l=new Uploader.Promise;return l.then(function(){},function(){r._fileOrBlobRejected(e.id,o)}),Uploader.isFileOrInput(n)&&!this._isAllowedExtension(s.allowedExtensions,o)?(this._itemError("typeError",o,n),l.failure()):this._options.validation.allowEmpty||0!==i?i>0&&s.sizeLimit&&i>s.sizeLimit?(this._itemError("sizeError",o,n),l.failure()):i>0&&i<s.minSizeLimit?(this._itemError("minSizeError",o,n),l.failure()):(Uploader.ImageValidation&&Uploader.supportedFeatures.imagePreviews&&Uploader.isFile(n)?new Uploader.ImageValidation(n,Uploader.bind(r.log,r)).validate(s.image).then(l.success,function(e){r._itemError(e+"ImageError",o,n),l.failure()}):l.success(),l):(this._itemError("emptyError",o,n),l.failure())},_wrapCallbacks:function(){var e,t,r;for(r in e=this,t=function(t,r,n){var o;try{return r.apply(e,n)}catch(r){o=r.message||r.toString(),e.log("Caught exception in '"+t+"' callback - "+o,"error")}},this._options.callbacks)!function(){var n,o;n=r,o=e._options.callbacks[n],e._options.callbacks[n]=function(){return t(n,o,arguments)}}()}}}(),function(){"use strict";Uploader.UploaderBasic=function(e){var t=this;this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,request:{customHeaders:{},endpoint:"/server/upload",filenameParam:"qqfilename",forceMultipart:!0,inputName:"qqfile",method:"POST",params:{},paramsInBody:!0,totalFileSizeName:"qqtotalfilesize",uuidName:"qquuid"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:!0,acceptFiles:null,image:{maxHeight:0,maxWidth:0,minHeight:0,minWidth:0},allowEmpty:!1},callbacks:{onSubmit:function(e,t){},onSubmitted:function(e,t){},onComplete:function(e,t,r,n){},onAllComplete:function(e,t){},onCancel:function(e,t){},onUpload:function(e,t){},onUploadChunk:function(e,t,r){},onUploadChunkSuccess:function(e,t,r,n){},onResume:function(e,t,r){},onProgress:function(e,t,r,n){},onTotalProgress:function(e,t){},onError:function(e,t,r,n){},onAutoRetry:function(e,t,r){},onManualRetry:function(e,t){},onValidateBatch:function(e){},onValidate:function(e){},onSubmitDelete:function(e){},onDelete:function(e){},onDeleteComplete:function(e,t,r){},onPasteReceived:function(e){},onStatusChange:function(e,t,r){},onSessionRequestComplete:function(e,t,r){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",maxHeightImageError:"Image is too tall.",maxWidthImageError:"Image is too wide.",minHeightImageError:"Image is not tall enough.",minWidthImageError:"Image is not wide enough.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be canceled.",unsupportedBrowserIos8Safari:"Unrecoverable error - this browser does not permit file uploading of any kind due to serious bugs in iOS8 Safari.  Please use iOS8 Chrome until Apple fixes these issues."},retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"Uploader-upload-button-hover",buttonFocus:"Uploader-upload-button-focus"},chunking:{enabled:!1,concurrent:{enabled:!1},mandatory:!1,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts"},partSize:2e6,success:{endpoint:null}},resume:{enabled:!1,recordsExpireIn:7,paramNames:{resuming:"qqresume"}},formatFileName:function(e){return e},text:{defaultResponseError:"Upload failure reason unknown",fileInputTitle:"file input",sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:!1,method:"DELETE",endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:!1,sendCredentials:!1,allowXdr:!1},blobs:{defaultName:"misc_data"},paste:{targetElement:null,defaultName:"pasted_image"},camera:{ios:!1,button:null},extraButtons:[],session:{endpoint:null,params:{},customHeaders:{},refreshOnReset:!0},form:{element:"Uploader-form",autoUpload:!1,interceptSubmit:!0},scaling:{customResizer:null,sendOriginal:!0,orient:!0,defaultType:null,defaultQuality:80,failureText:"Failed to scale",includeExif:!1,sizes:[]},workarounds:{iosEmptyVideos:!0,ios8SafariUploads:!0,ios8BrowserCrash:!1}},Uploader.extend(this._options,e,!0),this._buttons=[],this._extraButtonSpecs={},this._buttonIdsForFileIds=[],this._wrapCallbacks(),this._disposeSupport=new Uploader.DisposeSupport,this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData=this._createUploadDataTracker(),this._initFormSupportAndParams(),this._customHeadersStore=this._createStore(this._options.request.customHeaders),this._deleteFileCustomHeadersStore=this._createStore(this._options.deleteFile.customHeaders),this._deleteFileParamsStore=this._createStore(this._options.deleteFile.params),this._endpointStore=this._createStore(this._options.request.endpoint),this._deleteFileEndpointStore=this._createStore(this._options.deleteFile.endpoint),this._handler=this._createUploadHandler(),this._deleteHandler=Uploader.DeleteFileAjaxRequester&&this._createDeleteHandler(),this._options.button&&(this._defaultButtonId=this._createUploadButton({element:this._options.button,title:this._options.text.fileInputTitle}).getButtonId()),this._generateExtraButtonSpecs(),this._handleCameraAccess(),this._options.paste.targetElement&&(Uploader.PasteSupport?this._pasteHandler=this._createPasteHandler():this.log("Paste support module not found","error")),this._preventLeaveInProgress(),this._imageGenerator=Uploader.ImageGenerator&&new Uploader.ImageGenerator(Uploader.bind(this.log,this)),this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._scaler=Uploader.Scaler&&new Uploader.Scaler(this._options.scaling,Uploader.bind(this.log,this))||{},this._scaler.enabled&&(this._customNewFileHandler=Uploader.bind(this._scaler.handleNewFile,this._scaler)),Uploader.TotalProgress&&Uploader.supportedFeatures.progressBar&&(this._totalProgress=new Uploader.TotalProgress(Uploader.bind(this._onTotalProgress,this),function(e){var r=t._uploadData.retrieve({id:e});return r&&r.size||0})),this._currentItemLimit=this._options.validation.itemLimit},Uploader.UploaderBasic.prototype=Uploader.basePublicApi,Uploader.extend(Uploader.UploaderBasic.prototype,Uploader.basePrivateApi)}(),Uploader.AjaxRequester=function(e){"use strict";var t,r,n=[],o={},i={acceptHeader:null,validMethods:["PATCH","POST","PUT"],method:"POST",contentType:"application/x-www-form-urlencoded",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},mandatedParams:{},allowXRequestedWithAndCacheControl:!0,successfulResponseCodes:{DELETE:[200,202,204],PATCH:[200,201,202,203,204],POST:[200,201,202,203,204],PUT:[200,201,202,203,204],GET:[200]},cors:{expected:!1,sendCredentials:!1},log:function(e,t){},onSend:function(e){},onComplete:function(e,t,r){},onProgress:null};if(Uploader.extend(i,e),t=i.log,Uploader.indexOf(i.validMethods,i.method)<0)throw new Error("'"+i.method+"' is not a supported method for this type of request!");function a(e){return i.cors.expected&&void 0===e.withCredentials}function s(e,t){var r,n=o[e].xhr;return n||(t?n=t:i.cors.expected?((window.XMLHttpRequest||window.ActiveXObject)&&void 0===(r=Uploader.createXhrInstance()).withCredentials&&((r=new XDomainRequest).onload=function(){},r.onerror=function(){},r.ontimeout=function(){},r.onprogress=function(){}),n=r):n=Uploader.createXhrInstance(),o[e].xhr=n),n}function l(e){var t=Uploader.indexOf(n,e),r=i.maxConnections;delete o[e],n.splice(t,1),n.length>=r&&t<r&&d(n[r-1])}function u(e,r){var n,o=s(e),u=i.method,d=!0===r;l(e),d?t(u+" request for "+e+" has failed","error"):a(o)||(n=o.status,Uploader.indexOf(i.successfulResponseCodes[i.method],n)>=0)||(d=!0,t(u+" request for "+e+" has failed - response code "+o.status,"error")),i.onComplete(e,o,d)}function d(e,n){var l,d,c,p,h,f,g,m,U,y,v,S,_,b,w,C,x,P=s(e,n),A=i.method,I=(p=o[d=e].additionalParams,h=i.mandatedParams,i.paramsStore.get&&(c=i.paramsStore.get(d)),p&&Uploader.each(p,function(e,t){(c=c||{})[e]=t}),h&&Uploader.each(h,function(e,t){(c=c||{})[e]=t}),c),E=o[e].payload;return i.onSend(e),l=function(e,t,n){var a=i.endpointStore.get(e),s=o[e].addToPath;null!=s&&(a+="/"+s);r&&t&&(a=Uploader.obj2url(t,a));n&&(a=Uploader.obj2url(n,a));return a}(e,I,o[e].additionalQueryParams),a(P)?(P.onload=(m=e,function(){u(m)}),P.onerror=(g=e,function(){u(g,!0)})):P.onreadystatechange=(f=e,function(){4===s(f).readyState&&u(f)}),U=e,(y=i.onProgress)&&(s(U).upload.onprogress=function(e){e.lengthComputable&&y(U,e.loaded,e.total)}),P.open(A,l,!0),i.cors.expected&&i.cors.sendCredentials&&!a(P)&&(P.withCredentials=!0),S=s(v=e),_=i.customHeaders,b=o[v].additionalHeaders||{},w=i.method,C={},a(S)||(i.acceptHeader&&S.setRequestHeader("Accept",i.acceptHeader),i.allowXRequestedWithAndCacheControl&&(i.cors.expected&&Uploader.indexOf(["GET","POST","HEAD"],i.method)>=0&&(x=!1,Uploader.each(x,function(e,t){if(Uploader.indexOf(["Accept","Accept-Language","Content-Language","Content-Type"],t)<0)return x=!0,!1}),!x)||(S.setRequestHeader("X-Requested-With","XMLHttpRequest"),S.setRequestHeader("Cache-Control","no-cache"))),!i.contentType||"POST"!==w&&"PUT"!==w||S.setRequestHeader("Content-Type",i.contentType),Uploader.extend(C,Uploader.isFunction(_)?_(v):_),Uploader.extend(C,b),Uploader.each(C,function(e,t){S.setRequestHeader(e,t)})),t("Sending "+A+" request for "+e),E?P.send(E):r||!I?P.send():I&&i.contentType&&i.contentType.toLowerCase().indexOf("application/x-www-form-urlencoded")>=0?P.send(Uploader.obj2url(I,"")):I&&i.contentType&&i.contentType.toLowerCase().indexOf("application/json")>=0?P.send(JSON.stringify(I)):P.send(I),P}r="GET"===i.method||"DELETE"===i.method,Uploader.extend(this,{initTransport:function(e){var t,r,a,s,l,u;return{withPath:function(e){return t=e,this},withParams:function(e){return r=e,this},withQueryParams:function(e){return u=e,this},withHeaders:function(e){return a=e,this},withPayload:function(e){return s=e,this},withCacheBuster:function(){return l=!0,this},send:function(c){return l&&Uploader.indexOf(["GET","DELETE"],i.method)>=0&&(r.qqtimestamp=(new Date).getTime()),function(e,t,r,a,s,l,u){if(o[e]={addToPath:r,additionalParams:a,additionalQueryParams:s,additionalHeaders:l,payload:u},n.push(e)<=i.maxConnections)return d(e,t)}(e,c,t,r,u,a,s)}}},canceled:function(e){l(e)}})},Uploader.UploadHandler=function(e){"use strict";var t=e.proxy,r={},n=t.onCancel,o=t.getName;Uploader.extend(this,{add:function(e,t){r[e]=t,r[e].temp={}},cancel:function(e){var t=this,i=new Uploader.Promise;n(e,o(e),i).then(function(){t.isValid(e)&&(r[e].canceled=!0,t.expunge(e)),i.success()})},expunge:function(e){delete r[e]},getThirdPartyFileId:function(e){return r[e].key},isValid:function(e){return void 0!==r[e]},reset:function(){r={}},_getFileState:function(e){return r[e]},_setThirdPartyFileId:function(e,t){r[e].key=t},_wasCanceled:function(e){return!!r[e].canceled}})},Uploader.UploadHandlerController=function(e,t){"use strict";var r,n,o,i,a=this,s=!1,l=!1,u={paramsStore:{},maxConnections:3,chunking:{enabled:!1,multiple:{enabled:!1}},log:function(e,t){},onProgress:function(e,t,r,n){},onComplete:function(e,t,r,n){},onCancel:function(e,t){},onUploadPrep:function(e){},onUpload:function(e,t){},onUploadChunk:function(e,t,r){},onUploadChunkSuccess:function(e,t,r,n){},onAutoRetry:function(e,t,r,n){},onResume:function(e,t,r){},onUuidChanged:function(e,t){},getName:function(e){},setSize:function(e,t){},isQueued:function(e){},getIdsInProxyGroup:function(e){},getIdsInBatch:function(e){}},d={done:function(e,t,r,n){var i=o._getChunkData(e,t);o._getFileState(e).attemptingResume=!1,delete o._getFileState(e).temp.chunkProgress[t],o._getFileState(e).loaded+=i.size,u.onUploadChunkSuccess(e,o._getChunkDataForCallback(i),r,n)},finalize:function(e){var t=u.getSize(e),r=u.getName(e);n("All chunks have been uploaded for "+e+" - finalizing...."),o.finalizeChunks(e).then(function(i,a){n("Finalize successful for "+e);var s=h.normalizeResponse(i,!0);u.onProgress(e,r,t,t),o._maybeDeletePersistedChunkData(e),h.cleanup(e,s,a)},function(t,o){var i=h.normalizeResponse(t,!1);n("Problem finalizing chunks for file ID "+e+" - "+i.error,"error"),i.reset&&d.reset(e),u.onAutoRetry(e,r,i,o)||h.cleanup(e,i,o)})},handleFailure:function(e,t,r,i){var a=u.getName(t);n("Chunked upload request failed for "+t+", chunk "+e),o.clearCachedChunk(t,e);var s,p=h.normalizeResponse(r,!1);p.reset?d.reset(t):(s=Uploader.indexOf(o._getFileState(t).chunking.inProgress,e))>=0&&(o._getFileState(t).chunking.inProgress.splice(s,1),o._getFileState(t).chunking.remaining.unshift(e)),o._getFileState(t).temp.ignoreFailure||(l&&(o._getFileState(t).temp.ignoreFailure=!0,n(Uploader.format("Going to attempt to abort these chunks: {}. These are currently in-progress: {}.",JSON.stringify(Object.keys(o._getXhrs(t))),JSON.stringify(o._getFileState(t).chunking.inProgress))),Uploader.each(o._getXhrs(t),function(e,r){n(Uploader.format("Attempting to abort file {}.{}. XHR readyState {}. ",t,e,r.readyState)),r.abort(),r._cancelled=!0}),o.moveInProgressToRemaining(t),c.free(t,!0)),u.onAutoRetry(t,a,p,i)||h.cleanup(t,p,i))},hasMoreParts:function(e){return!!o._getFileState(e).chunking.remaining.length},nextPart:function(e){var t=o._getFileState(e).chunking.remaining.shift();return t>=o._getTotalChunks(e)&&(t=null),t},reset:function(e){n("Server or callback has ordered chunking effort to be restarted on next attempt for item ID "+e,"error"),o._maybeDeletePersistedChunkData(e),o.reevaluateChunking(e),o._getFileState(e).loaded=0},sendNext:function(e){var t=u.getSize(e),r=u.getName(e),i=d.nextPart(e),a=o._getChunkData(e,i),s=o._getFileState(e).attemptingResume,p=o._getFileState(e).chunking.inProgress||[];null==o._getFileState(e).loaded&&(o._getFileState(e).loaded=0),s&&!1===u.onResume(e,r,a)&&(d.reset(e),i=d.nextPart(e),a=o._getChunkData(e,i),s=!1),null==i&&0===p.length?d.finalize(e):(n(Uploader.format("Sending chunked upload request for item {}.{}, bytes {}-{} of {}.",e,i,a.start+1,a.end,t)),u.onUploadChunk(e,r,o._getChunkDataForCallback(a)),p.push(i),o._getFileState(e).chunking.inProgress=p,l&&c.open(e,i),l&&c.available()&&o._getFileState(e).chunking.remaining.length&&d.sendNext(e),0===a.blob.size?(n(Uploader.format("Chunk {} for file {} will not be uploaded, zero sized chunk.",i,e),"error"),d.handleFailure(i,e,"File is no longer available",null)):o.uploadChunk(e,i,s).then(function(t,r){n("Chunked upload request succeeded for "+e+", chunk "+i),o.clearCachedChunk(e,i);var a=o._getFileState(e).chunking.inProgress||[],s=h.normalizeResponse(t,!0),l=Uploader.indexOf(a,i);n(Uploader.format("Chunk {} for file {} uploaded successfully.",i,e)),d.done(e,i,s,r),l>=0&&a.splice(l,1),o._maybePersistChunkedState(e),d.hasMoreParts(e)||0!==a.length?d.hasMoreParts(e)?d.sendNext(e):n(Uploader.format("File ID {} has no more chunks to send and these chunk indexes are still marked as in-progress: {}",e,JSON.stringify(a))):d.finalize(e)},function(t,r){d.handleFailure(i,e,t,r)}).done(function(){o.clearXhr(e,i)}))}},c={_open:[],_openChunks:{},_waiting:[],available:function(){var e=u.maxConnections,t=0,r=0;return Uploader.each(c._openChunks,function(e,n){t++,r+=n.length}),e-(c._open.length-t+r)},free:function(e,t){var r,i=!t,a=Uploader.indexOf(c._waiting,e),s=Uploader.indexOf(c._open,e);delete c._openChunks[e],h.getProxyOrBlob(e)instanceof Uploader.BlobProxy&&(n("Generated blob upload has ended for "+e+", disposing generated blob."),delete o._getFileState(e).file),a>=0?c._waiting.splice(a,1):i&&s>=0&&(c._open.splice(s,1),(r=c._waiting.shift())>=0&&(c._open.push(r),h.start(r)))},getWaitingOrConnected:function(){var e=[];return Uploader.each(c._openChunks,function(t,r){r&&r.length&&e.push(parseInt(t))}),Uploader.each(c._open,function(t,r){c._openChunks[r]||e.push(parseInt(r))}),e=e.concat(c._waiting)},isUsingConnection:function(e){return Uploader.indexOf(c._open,e)>=0},open:function(e,t){return null==t&&c._waiting.push(e),!!c.available()&&(null==t?(c._waiting.pop(),c._open.push(e)):((r=c._openChunks[e]||[]).push(t),c._openChunks[e]=r),!0);var r},reset:function(){c._waiting=[],c._open=[]}},p=function(e,t){o._getFileState(e).loaded=0,n("Sending simple upload request for "+e),o.uploadFile(e).then(function(r,o){n("Simple upload request succeeded for "+e);var i=h.normalizeResponse(r,!0),a=u.getSize(e);u.onProgress(e,t,a,a),h.maybeNewUuid(e,i),h.cleanup(e,i,o)},function(r,o){n("Simple upload request failed for "+e);var i=h.normalizeResponse(r,!1);u.onAutoRetry(e,t,i,o)||h.cleanup(e,i,o)})},h={cancel:function(e){n("Cancelling "+e),u.paramsStore.remove(e),c.free(e)},cleanup:function(e,t,r){var n=u.getName(e);u.onComplete(e,n,t,r),o._getFileState(e)&&o._clearXhrs&&o._clearXhrs(e),c.free(e)},getProxyOrBlob:function(e){return o.getProxy&&o.getProxy(e)||o.getFile&&o.getFile(e)},initHandler:function(){var e=t?Uploader[t]:Uploader.traditional,r=Uploader.supportedFeatures.ajaxUploading?"Xhr":"Form";(o=new e[r+"UploadHandler"](u,{getDataByUuid:u.getDataByUuid,getName:u.getName,getSize:u.getSize,getUuid:u.getUuid,log:n,onCancel:u.onCancel,onProgress:u.onProgress,onUuidChanged:u.onUuidChanged}))._removeExpiredChunkingRecords&&o._removeExpiredChunkingRecords()},isDeferredEligibleForUpload:function(e){return u.isQueued(e)},maybeDefer:function(e,t){return t&&!o.getFile(e)&&t instanceof Uploader.BlobProxy?(u.onUploadPrep(e),n("Attempting to generate a blob on-demand for "+e),t.create().then(function(t){n("Generated an on-demand blob for "+e),o.updateBlob(e,t),u.setSize(e,t.size),o.reevaluateChunking(e),h.maybeSendDeferredFiles(e)},function(t){var o={};t&&(o.error=t),n(Uploader.format("Failed to generate blob for ID {}.  Error message: {}.",e,t),"error"),u.onComplete(e,u.getName(e),Uploader.extend(o,r),null),h.maybeSendDeferredFiles(e),c.free(e)}),!1):h.maybeSendDeferredFiles(e)},maybeSendDeferredFiles:function(e){var t=u.getIdsInProxyGroup(e),r=!1;return t&&t.length?(n("Maybe ready to upload proxy group file "+e),Uploader.each(t,function(t,n){if(h.isDeferredEligibleForUpload(n)&&o.getFile(n))r=n===e,h.now(n);else if(h.isDeferredEligibleForUpload(n))return!1})):(r=!0,h.now(e)),r},maybeNewUuid:function(e,t){void 0!==t.newUuid&&u.onUuidChanged(e,t.newUuid)},normalizeResponse:function(e,t){var r=e;return Uploader.isObject(e)||(r={},Uploader.isString(e)&&!t&&(r.error=e)),r.success=t,r},now:function(e){var t=u.getName(e);if(!a.isValid(e))throw new Uploader.Error(e+" is not a valid file ID to upload!");u.onUpload(e,t),s&&o._shouldChunkThisFile(e)?d.sendNext(e):p(e,t)},start:function(e){var t=h.getProxyOrBlob(e);return t?h.maybeDefer(e,t):(h.now(e),!0)}};Uploader.extend(this,{add:function(e,t){o.add.apply(this,arguments)},upload:function(e){return!!c.open(e)&&h.start(e)},retry:function(e){return l&&(o._getFileState(e).temp.ignoreFailure=!1),c.isUsingConnection(e)?h.start(e):a.upload(e)},cancel:function(e){var t=o.cancel(e);Uploader.isGenericPromise(t)?t.then(function(){h.cancel(e)}):!1!==t&&h.cancel(e)},cancelAll:function(){var e,t=c.getWaitingOrConnected();if(t.length)for(e=t.length-1;e>=0;e--)a.cancel(t[e]);c.reset()},getFile:function(e){return o.getProxy&&o.getProxy(e)?o.getProxy(e).referenceBlob:o.getFile&&o.getFile(e)},isProxied:function(e){return!(!o.getProxy||!o.getProxy(e))},getInput:function(e){if(o.getInput)return o.getInput(e)},reset:function(){n("Resetting upload handler"),a.cancelAll(),c.reset(),o.reset()},expunge:function(e){if(a.isValid(e))return o.expunge(e)},isValid:function(e){return o.isValid(e)},getResumableFilesData:function(){return o.getResumableFilesData?o.getResumableFilesData():[]},getThirdPartyFileId:function(e){if(a.isValid(e))return o.getThirdPartyFileId(e)},pause:function(e){return!!(a.isResumable(e)&&o.pause&&a.isValid(e)&&o.pause(e))&&(c.free(e),o.moveInProgressToRemaining(e),!0)},isResumable:function(e){return!!o.isResumable&&o.isResumable(e)}}),Uploader.extend(u,e),n=u.log,s=u.chunking.enabled&&Uploader.supportedFeatures.chunking,l=s&&u.chunking.concurrent.enabled,(i={})[u.preventRetryParam]=!0,r=i,h.initHandler()},Uploader.WindowReceiveMessage=function(e){"use strict";var t={};Uploader.extend({log:function(e,t){}},e),Uploader.extend(this,{receiveMessage:function(e,r){window.postMessage?t[e]=Uploader(window).attach("message",function(e){r(e.data)}):log("iframe message passing not supported in this browser!","error")},stopReceivingMessages:function(e){if(window.postMessage){var r=t[e];r&&r()}}})},Uploader.FormUploadHandler=function(e){"use strict";var t=e.options,r=this,n=e.proxy,o=Uploader.getUniqueId(),i={},a={},s={},l=t.isCors,u=t.inputName,d=n.getUuid,c=n.log,p=new Uploader.WindowReceiveMessage({log:c});function h(e){return e.split("_")[0]}Uploader.extend(this,new Uploader.UploadHandler(e)),Uploader.override(this,function(e){return{add:function(t,r){e.add(t,{input:r}),r.setAttribute("name",u),r.parentNode&&Uploader(r).remove()},expunge:function(t){!function(e){delete a[e],l&&(clearTimeout(s[e]),delete s[e],p.stopReceivingMessages(e));var t=document.getElementById(r._getIframeName(e));t&&(t.setAttribute("src","javascript:false;"),Uploader(t).remove())}(t),e.expunge(t)},isValid:function(t){return e.isValid(t)&&void 0!==r._getFileState(t).input}}}),Uploader.extend(this,{getInput:function(e){return r._getFileState(e).input},_attachLoadEvent:function(e,t){var n,o,u,f,g,m;l?(u=t,f=(o=e).id,g=h(f),m=d(g),i[m]=u,a[g]=Uploader(o).attach("load",function(){r.getInput(g)&&(c("Received iframe load event for CORS upload request (iframe name "+f+")"),s[f]=setTimeout(function(){var e="No valid message received from loaded iframe for iframe name "+f;c(e,"error"),u({error:e})},1e3))}),p.receiveMessage(f,function(e){c("Received the following window message: '"+e+"'"),h(f);var t,n=r._parseJsonResponse(e),o=n.uuid;o&&i[o]?(c("Handling response for iframe name "+f),clearTimeout(s[f]),delete s[f],r._detachLoadEvent(f),t=i[o],delete i[o],p.stopReceivingMessages(f),t(n)):o||c("'"+e+"' does not contain a UUID - ignoring.")})):a[e.id]=Uploader(e).attach("load",function(){if(c("Received response for "+e.id),e.parentNode){try{if(e.contentDocument&&e.contentDocument.body&&"false"==e.contentDocument.body.innerHTML)return}catch(e){c("Error when attempting to access iframe during handling of upload response ("+e.message+")","error"),n={success:!1}}t(n)}})},_createIframe:function(e){var t,n,o=r._getIframeName(e);return t=o,(n=Uploader.toElement("<iframe src='javascript:false;' name='"+t+"' />")).setAttribute("id",t),n.style.display="none",document.body.appendChild(n),n},_detachLoadEvent:function(e){void 0!==a[e]&&(a[e](),delete a[e])},_getIframeName:function(e){return e+"_"+o},_initFormForUpload:function(e){var t=e.method,r=e.endpoint,n=e.params,o=e.paramsInBody,i=e.targetName,a=Uploader.toElement("<form method='"+t+"' enctype='multipart/form-data'></form>"),s=r;return o?Uploader.obj2Inputs(n,a):s=Uploader.obj2url(n,r),a.setAttribute("action",s),a.setAttribute("target",i),a.style.display="none",document.body.appendChild(a),a},_parseJsonResponse:function(e){var t={};try{t=Uploader.parseJson(e)}catch(e){c("Error when attempting to parse iframe upload response ("+e.message+")","error")}return t}})},Uploader.XhrUploadHandler=function(e){"use strict";var t=this,r=e.options.namespace,n=e.proxy,o=e.options.chunking,i=e.options.resume,a=o&&e.options.chunking.enabled&&Uploader.supportedFeatures.chunking,s=i&&e.options.resume.enabled&&a&&Uploader.supportedFeatures.resume,l=n.getName,u=n.getSize,d=n.getUuid,c=n.getEndpoint,p=n.getDataByUuid,h=n.onUuidChanged,f=n.onProgress,g=n.log;function m(e){Uploader.each(t._getXhrs(e),function(r,n){var o=t._getAjaxRequester(e,r);n.onreadystatechange=null,n.upload.onprogress=null,n.abort(),o&&o.canceled&&o.canceled(e)})}Uploader.extend(this,new Uploader.UploadHandler(e)),Uploader.override(this,function(e){return{add:function(r,n){if(Uploader.isFile(n)||Uploader.isBlob(n))e.add(r,{file:n});else{if(!(n instanceof Uploader.BlobProxy))throw new Error("Passed obj is not a File, Blob, or proxy");e.add(r,{proxy:n})}t._initTempState(r),s&&t._maybePrepareForResume(r)},expunge:function(r){m(r),t._maybeDeletePersistedChunkData(r),t._clearXhrs(r),e.expunge(r)}}}),Uploader.extend(this,{clearCachedChunk:function(e,r){delete t._getFileState(e).temp.cachedChunks[r]},clearXhr:function(e,r){var n=t._getFileState(e).temp;n.xhrs&&delete n.xhrs[r],n.ajaxRequesters&&delete n.ajaxRequesters[r]},finalizeChunks:function(e,r){var n=t._getTotalChunks(e)-1,o=t._getXhr(e,n);return r?(new Uploader.Promise).success(r(o),o):(new Uploader.Promise).success({},o)},getFile:function(e){return t.isValid(e)&&t._getFileState(e).file},getProxy:function(e){return t.isValid(e)&&t._getFileState(e).proxy},getResumableFilesData:function(){var e=[];return t._iterateResumeRecords(function(r,n){t.moveInProgressToRemaining(null,n.chunking.inProgress,n.chunking.remaining);var o={name:n.name,remaining:n.chunking.remaining,size:n.size,uuid:n.uuid};n.key&&(o.key=n.key),e.push(o)}),e},isResumable:function(e){return!!o&&t.isValid(e)&&!t._getFileState(e).notResumable},moveInProgressToRemaining:function(e,r,n){var o=r||t._getFileState(e).chunking.inProgress,i=n||t._getFileState(e).chunking.remaining;o&&(g(Uploader.format("Moving these chunks from in-progress {}, to remaining.",JSON.stringify(o))),o.reverse(),Uploader.each(o,function(e,t){i.unshift(t)}),o.length=0)},pause:function(e){if(t.isValid(e))return g(Uploader.format("Aborting XHR upload for {} '{}' due to pause instruction.",e,l(e))),t._getFileState(e).paused=!0,m(e),!0},reevaluateChunking:function(e){if(o&&t.isValid(e)){var r,n,i=t._getFileState(e);if(delete i.chunking,i.chunking={},(r=t._getTotalChunks(e))>1||o.mandatory){for(i.chunking.enabled=!0,i.chunking.parts=r,i.chunking.remaining=[],n=0;n<r;n++)i.chunking.remaining.push(n);t._initTempState(e)}else i.chunking.enabled=!1}},updateBlob:function(e,r){t.isValid(e)&&(t._getFileState(e).file=r)},_clearXhrs:function(e){var r=t._getFileState(e).temp;Uploader.each(r.ajaxRequesters,function(e){delete r.ajaxRequesters[e]}),Uploader.each(r.xhrs,function(e){delete r.xhrs[e]})},_createXhr:function(e,r){return t._registerXhr(e,r,Uploader.createXhrInstance())},_getAjaxRequester:function(e,r){var n=null==r?-1:r;return t._getFileState(e).temp.ajaxRequesters[n]},_getChunkData:function(e,r){var n=o.partSize,i=u(e),a=t.getFile(e),s=n*r,l=s+n>=i?i:s+n,d=t._getTotalChunks(e),c=this._getFileState(e).temp.cachedChunks,p=c[r]||Uploader.sliceBlob(a,s,l);return c[r]=p,{part:r,start:s,end:l,count:d,blob:p,size:l-s}},_getChunkDataForCallback:function(e){return{partIndex:e.part,startByte:e.start+1,endByte:e.end,totalParts:e.count}},_getLocalStorageId:function(e){var t=l(e),n=u(e),i=o.partSize,a=c(e);return Uploader.format("Uploader{}resume{}-{}-{}-{}-{}",r,"5.0",t,n,i,a)},_getMimeType:function(e){return t.getFile(e).type},_getPersistableData:function(e){return t._getFileState(e).chunking},_getTotalChunks:function(e){if(o){var t=u(e),r=o.partSize;return Math.ceil(t/r)}},_getXhr:function(e,r){var n=null==r?-1:r;return t._getFileState(e).temp.xhrs[n]},_getXhrs:function(e){return t._getFileState(e).temp.xhrs},_iterateResumeRecords:function(e){s&&Uploader.each(localStorage,function(t,n){if(0===t.indexOf(Uploader.format("Uploader{}resume",r))){var o=JSON.parse(n);e(t,o)}})},_initTempState:function(e){t._getFileState(e).temp={ajaxRequesters:{},chunkProgress:{},xhrs:{},cachedChunks:{}}},_markNotResumable:function(e){t._getFileState(e).notResumable=!0},_maybeDeletePersistedChunkData:function(e){var r;return!!(s&&t.isResumable(e)&&(r=t._getLocalStorageId(e))&&localStorage.getItem(r))&&(localStorage.removeItem(r),!0)},_maybePrepareForResume:function(e){var r,n,o=t._getFileState(e);s&&void 0===o.key&&(r=t._getLocalStorageId(e),(n=localStorage.getItem(r))&&(n=JSON.parse(n),p(n.uuid)?t._markNotResumable(e):(g(Uploader.format("Identified file with ID {} and name of {} as resumable.",e,l(e))),h(e,n.uuid),o.key=n.key,o.chunking=n.chunking,o.loaded=n.loaded,o.attemptingResume=!0,t.moveInProgressToRemaining(e))))},_maybePersistChunkedState:function(e){var r,n,o=t._getFileState(e);if(s&&t.isResumable(e)){r=t._getLocalStorageId(e),n={name:l(e),size:u(e),uuid:d(e),key:o.key,chunking:o.chunking,loaded:o.loaded,lastUpdated:Date.now()};try{localStorage.setItem(r,JSON.stringify(n))}catch(t){g(Uploader.format("Unable to save resume data for '{}' due to error: '{}'.",e,t.toString()),"warn")}}},_registerProgressHandler:function(e,r,n){var o=t._getXhr(e,r),i=l(e),a={simple:function(t,r){var n=u(e);f(e,i,t===r?n:t>=n?n-1:t,n)},chunked:function(o,a){var s=t._getFileState(e).temp.chunkProgress,l=t._getFileState(e).loaded,d=o,c=a,p=u(e),h=d-(c-n),g=l;s[r]=h,Uploader.each(s,function(e,t){g+=t}),f(e,i,g,p)}};o.upload.onprogress=function(e){e.lengthComputable&&a[null==n?"simple":"chunked"](e.loaded,e.total)}},_registerXhr:function(e,r,n,o){var i=null==r?-1:r,a=t._getFileState(e).temp;return a.xhrs=a.xhrs||{},a.ajaxRequesters=a.ajaxRequesters||{},a.xhrs[i]=n,o&&(a.ajaxRequesters[i]=o),n},_removeExpiredChunkingRecords:function(){var e=i.recordsExpireIn;t._iterateResumeRecords(function(t,r){var n=new Date(r.lastUpdated);n.setDate(n.getDate()+e),n.getTime()<=Date.now()&&(g("Removing expired resume record with key "+t),localStorage.removeItem(t))})},_shouldChunkThisFile:function(e){var r=t._getFileState(e);return r.chunking||t.reevaluateChunking(e),r.chunking.enabled}})},Uploader.DeleteFileAjaxRequester=function(e){"use strict";var t,r={method:"DELETE",uuidParamName:"qquuid",endpointStore:{},maxConnections:3,customHeaders:function(e){return{}},paramsStore:{},cors:{expected:!1,sendCredentials:!1},log:function(e,t){},onDelete:function(e){},onDeleteComplete:function(e,t,r){}};Uploader.extend(r,e),t=Uploader.extend(this,new Uploader.AjaxRequester({acceptHeader:"application/json",validMethods:["POST","DELETE"],method:r.method,endpointStore:r.endpointStore,paramsStore:r.paramsStore,mandatedParams:"POST"===r.method.toUpperCase()?{_method:"DELETE"}:{},maxConnections:r.maxConnections,customHeaders:function(e){return r.customHeaders.get(e)},log:r.log,onSend:r.onDelete,onComplete:r.onDeleteComplete,cors:r.cors})),Uploader.extend(this,{sendDelete:function(e,n,o){var i=o||{};r.log("Submitting delete file request for "+e),"DELETE"===r.method?t.initTransport(e).withPath(n).withParams(i).send():(i[r.uuidParamName]=n,t.initTransport(e).withParams(i).send())}})},function(){function e(e,r,n,o,i){var a,s,l,u,d,c,p,h,f,g,m,U,y,v,S=e.naturalWidth,_=e.naturalHeight,b=o.width,w=o.height,C=n.getContext("2d"),x=new Uploader.Promise;return C.save(),o.resize?(s={blob:r,canvas:n,image:e,imageHeight:_,imageWidth:S,orientation:o.orientation,resize:o.resize,targetHeight:w,targetWidth:b},l=s.blob,u=s.image,d=s.imageHeight,c=s.imageWidth,p=s.orientation,h=new Uploader.Promise,f=s.resize,g=document.createElement("canvas"),m=g.getContext("2d"),U=s.canvas,y=s.targetHeight,v=s.targetWidth,t(g,c,d,p),U.height=y,U.width=v,m.drawImage(u,0,0),f({blob:l,height:y,image:u,sourceCanvas:g,targetCanvas:U,width:v}).then(function(){U.qqImageRendered&&U.qqImageRendered(),h.success()},h.failure),h):(Uploader.supportedFeatures.unlimitedScaledImageSize||(a=function(e){var t=5241e3;if(!Uploader.ios())throw new Uploader.Error("Downsampled dimensions can only be reliably calculated for iOS!");if(e.origHeight*e.origWidth>t)return{newHeight:Math.round(Math.sqrt(t*(e.origHeight/e.origWidth))),newWidth:Math.round(Math.sqrt(t*(e.origWidth/e.origHeight)))}}({origWidth:b,origHeight:w}))&&(Uploader.log(Uploader.format("Had to reduce dimensions due to device limitations from {}w / {}h to {}w / {}h",b,w,a.newWidth,a.newHeight),"warn"),b=a.newWidth,w=a.newHeight),t(n,b,w,o.orientation),Uploader.ios()?function(){var t,r,n,o,a;n=(t=e).naturalWidth,o=t.naturalHeight,a=document.createElement("canvas"),n*o>1048576&&(a.width=a.height=1,(r=a.getContext("2d")).drawImage(t,1-n,0),0===r.getImageData(0,0,1,1).data[3])&&(S/=2,_/=2);var s,l,u,d=1024,c=document.createElement("canvas"),p=i?function(e,t,r){var n,o,i,a=document.createElement("canvas"),s=0,l=r,u=r;for(a.width=1,a.height=r,(n=a.getContext("2d")).drawImage(e,0,0),o=n.getImageData(0,0,1,r).data;u>s;)0===o[4*(u-1)+3]?l=u:s=u,u=l+s>>1;return 0==(i=u/r)?1:i}(e,0,_):1,h=Math.ceil(d*b/S),f=Math.ceil(d*w/_/p),g=0,m=0;for(c.width=c.height=d,s=c.getContext("2d");g<_;){for(l=0,u=0;l<S;)s.clearRect(0,0,d,d),s.drawImage(e,-l,-g),C.drawImage(c,0,0,d,d,u,m,h,f),l+=d,u+=h;g+=d,m+=f}C.restore(),c=s=null}():C.drawImage(e,0,0,b,w),n.qqImageRendered&&n.qqImageRendered(),x.success(),x)}function t(e,t,r,n){switch(n){case 5:case 6:case 7:case 8:e.width=r,e.height=t;break;default:e.width=t,e.height=r}var o=e.getContext("2d");switch(n){case 2:o.translate(t,0),o.scale(-1,1);break;case 3:o.translate(t,r),o.rotate(Math.PI);break;case 4:o.translate(0,r),o.scale(1,-1);break;case 5:o.rotate(.5*Math.PI),o.scale(1,-1);break;case 6:o.rotate(.5*Math.PI),o.translate(0,-r);break;case 7:o.rotate(.5*Math.PI),o.translate(t,-r),o.scale(-1,1);break;case 8:o.rotate(-.5*Math.PI),o.translate(-t,0)}}function r(e,t){var r=this;window.Blob&&e instanceof Blob&&function(){var t=new Image,n=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!n)throw Error("No createObjectURL function found to create blob url");t.src=n.createObjectURL(e),r.blob=e,e=t}(),e.naturalWidth||e.naturalHeight||(e.onload=function(){var e=r.imageLoadListeners;e&&(r.imageLoadListeners=null,setTimeout(function(){for(var t=0,r=e.length;t<r;t++)e[t]()},0))},e.onerror=t,this.imageLoadListeners=[]),this.srcImage=e}r.prototype.render=function(t,r){r=r||{};var n,o,i,a,s,l,u,d,c,p=this,h=this.srcImage.naturalWidth,f=this.srcImage.naturalHeight,g=r.width,m=r.height,U=r.maxWidth,y=r.maxHeight,v=!this.blob||"image/jpeg"===this.blob.type,S=t.tagName.toLowerCase();this.imageLoadListeners?this.imageLoadListeners.push(function(){p.render(t,r)}):(g&&!m?m=f*g/h<<0:m&&!g?g=h*m/f<<0:(g=h,m=f),U&&g>U&&(m=f*(g=U)/h<<0),y&&m>y&&(g=h*(m=y)/f<<0),n={width:g,height:m},Uploader.each(r,function(e,t){n[e]=t}),"img"===S?(c=t.src,(o=p.srcImage,i=p.blob,a=n,s=v,l=document.createElement("canvas"),u=a.mime||"image/jpeg",d=new Uploader.Promise,e(o,i,l,a,s).then(function(){d.success(l.toDataURL(u,a.quality||.8))}),d).then(function(e){t.src=e,c===t.src&&t.onload()})):"canvas"===S&&e(this.srcImage,this.blob,t,n,v),"function"==typeof this.onrender&&this.onrender(t))},Uploader.MegaPixImage=r}(),Uploader.ImageGenerator=function(e){"use strict";function t(e){return"img"===e.tagName.toLowerCase()}function r(e){return"canvas"===e.tagName.toLowerCase()}function n(e){var t=e.split("/"),r=t[t.length-1].split("?")[0],n=Uploader.getExtension(r);switch(n=n&&n.toLowerCase()){case"jpeg":case"jpg":return"image/jpeg";case"png":return"image/png";case"bmp":return"image/bmp";case"gif":return"image/gif";case"tiff":case"tif":return"image/tiff"}}function o(e){var t,r,n,o=document.createElement("a");return o.href=e,t=o.protocol,n=o.port,r=o.hostname,t.toLowerCase()!==window.location.protocol.toLowerCase()||(r.toLowerCase()!==window.location.hostname.toLowerCase()||n!==window.location.port&&!Uploader.ie())}function i(n,o){var i,a,s,l,u=t(n)||r(n);return t(n)?(l=o,(s=n).onload=function(){s.onload=null,s.onerror=null,l.success(s)},s.onerror=function(){s.onload=null,s.onerror=null,e("Problem drawing thumbnail!","error"),l.failure(s,"Problem drawing thumbnail!")}):r(n)?(a=o,(i=n).qqImageRendered=function(){a.success(i)}):(o.failure(n),e(Uploader.format("Element container of type {} is not supported!",n.tagName),"error")),u}function a(e,t,r,a,s){var l=new Image,u=new Uploader.Promise;i(l,u),o(e)&&(l.crossOrigin="anonymous"),l.src=e,u.then(function(){i(t,r),new Uploader.MegaPixImage(l).render(t,{maxWidth:a,maxHeight:a,mime:n(e),resize:s})},r.failure)}function s(e,t,r,n){i(t,r),Uploader(t).css({maxWidth:n+"px",maxHeight:n+"px"}),t.src=e}function l(e,n,l){var u,d=new Uploader.Promise,c=l.scale,p=c?l.maxSize:null;return c&&t(n)?(u=document.createElement("canvas")).getContext&&u.getContext("2d")?o(e)&&void 0===(new Image).crossOrigin?s(e,n,d,p):a(e,n,d,p):s(e,n,d,p):r(n)?a(e,n,d,p):i(n,d)&&(n.src=e),d}Uploader.extend(this,{generate:function(t,r,n){return Uploader.isString(t)?(e("Attempting to update thumbnail based on server response."),l(t,r,n||{})):(e("Attempting to draw client-side image preview."),o=t,a=r,s=n||{},u=new Uploader.Promise,d=new Uploader.Identify(o,e),c=s.maxSize,p=null==s.orient||s.orient,h=function(){a.onerror=null,a.onload=null,e("Could not render preview, file may be too large!","error"),u.failure(a,"Browser cannot render image!")},d.isPreviewable().then(function(t){var r={parse:function(){return(new Uploader.Promise).success()}},n=p?new Uploader.Exif(o,e):r,l=new Uploader.MegaPixImage(o,h);i(a,u)&&n.parse().then(function(e){var r=e&&e.Orientation;l.render(a,{maxWidth:c,maxHeight:c,orientation:r,mime:t,resize:s.customResizeFunction})},function(r){e(Uploader.format("EXIF data could not be parsed ({}).  Assuming orientation = 1.",r)),l.render(a,{maxWidth:c,maxHeight:c,mime:t,resize:s.customResizeFunction})})},function(){e("Not previewable"),u.failure(a,"Not previewable")}),u);var o,a,s,u,d,c,p,h}}),this._testing={},this._testing.isImg=t,this._testing.isCanvas=r,this._testing.isCrossOrigin=o,this._testing.determineMimeOfFileName=n},Uploader.Exif=function(e,t){"use strict";var r=[274],n={274:{name:"Orientation",bytes:2}};function o(e){for(var t=0,r=0;e.length>0;)t+=parseInt(e.substring(0,2),16)*Math.pow(2,r),e=e.substring(2,e.length),r+=8;return t}function i(){var t=new Uploader.Promise;return Uploader.readBlobToHex(e,0,6).then(function(r){0!==r.indexOf("ffd8")?t.failure("Not a valid JPEG!"):function t(r,n){var o=r,i=n;return void 0===o&&(o=2,i=new Uploader.Promise),Uploader.readBlobToHex(e,o,4).then(function(e){var r,n=/^ffe([0-9])/.exec(e);n?"1"!==n[1]?(r=parseInt(e.slice(4,8),16),t(o+r+2,i)):i.success(o):i.failure("No EXIF header to be found!")}),i}().then(function(e){t.success(e)},function(e){t.failure(e)})}),t}Uploader.extend(this,{parse:function(){var a=new Uploader.Promise,s=function(e){t(Uploader.format("EXIF header parse failed: '{}' ",e)),a.failure(e)};return i().then(function(i){var l,u;t(Uploader.format("Moving forward with EXIF header parsing for '{}'",void 0===e.name?"blob":e.name)),(l=i,u=new Uploader.Promise,Uploader.readBlobToHex(e,l+10,2).then(function(e){u.success("4949"===e)}),u).then(function(l){var u,d,c;t(Uploader.format("EXIF Byte order is {} endian",l?"little":"big")),(u=i,d=l,c=new Uploader.Promise,Uploader.readBlobToHex(e,u+18,2).then(function(e){if(d)return c.success(o(e));c.success(parseInt(e,16))}),c).then(function(u){var d,c,p,h;t(Uploader.format("Found {} APP1 directory entries",u)),(d=i,c=u,p=d+20,h=12*c,Uploader.readBlobToHex(e,p,h)).then(function(e){var i,s,u,d,c=function(e){for(var t=[],r=0;r+24<=e.length;)t.push(e.slice(r,r+24)),r+=24;return t}(e),p=(i=l,s=c,u=Uploader.extend([],r),d={},Uploader.each(s,function(e,t){var r,a,s,l=t.slice(0,4),c=i?o(l):parseInt(l,16),p=u.indexOf(c);if(p>=0&&(a=n[c].name,s=n[c].bytes,r=t.slice(16,16+2*s),d[a]=i?o(r):parseInt(r,16),u.splice(p,1)),0===u.length)return!1}),d);t("Successfully parsed some EXIF tags"),a.success(p)},s)},s)},s)},s),a}}),this._testing={},this._testing.parseLittleEndian=o},Uploader.Identify=function(e,t){"use strict";Uploader.extend(this,{isPreviewable:function(){var r=this,n=new Uploader.Promise,o=!1,i=void 0===e.name?"blob":e.name;return t(Uploader.format("Attempting to determine if {} can be rendered in this browser",i)),t("First pass: check type attribute of blob object."),this.isPreviewableSync()?(t("Second pass: check for magic bytes in file header."),Uploader.readBlobToHex(e,0,4).then(function(e){Uploader.each(r.PREVIEWABLE_MIME_TYPES,function(t,r){if(i=e,a=!1,s=[].concat(r),Uploader.each(s,function(e,t){if(0===i.indexOf(t))return a=!0,!1}),a)return("image/tiff"!==t||Uploader.supportedFeatures.tiffPreviews)&&(o=!0,n.success(t)),!1;var i,a,s}),t(Uploader.format("'{}' is {} able to be rendered in this browser",i,o?"":"NOT")),o||n.failure()},function(){t("Error reading file w/ name '"+i+"'.  Not able to be rendered in this browser."),n.failure()})):n.failure(),n},isPreviewableSync:function(){var r=e.type,n=Uploader.indexOf(Object.keys(this.PREVIEWABLE_MIME_TYPES),r)>=0,o=!1,i=void 0===e.name?"blob":e.name;return n&&(o="image/tiff"!==r||Uploader.supportedFeatures.tiffPreviews),!o&&t(i+" is not previewable in this browser per the blob's type attr"),o}})},Uploader.Identify.prototype.PREVIEWABLE_MIME_TYPES={"image/jpeg":"ffd8ff","image/gif":"474946","image/png":"89504e","image/bmp":"424d","image/tiff":["49492a00","4d4d002a"]},Uploader.ImageValidation=function(e,t){"use strict";this.validate=function(r){var n,o,i,a=new Uploader.Promise;return t("Attempting to validate image."),o=r,i=!1,Uploader.each(o,function(e,t){if(t>0)return i=!0,!1}),i?(n=new Uploader.Promise,new Uploader.Identify(e,t).isPreviewable().then(function(){var r=new Image,o=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;o?(r.onerror=function(){t("Cannot determine dimensions for image.  May be too large.","error"),n.failure()},r.onload=function(){n.success({width:this.width,height:this.height})},r.src=o.createObjectURL(e)):(t("No createObjectURL function available to generate image URL!","error"),n.failure())},n.failure),n).then(function(e){var t,n,o,i=(t=r,n=e,Uploader.each(t,function(e,t){if(t>0){var r=/(max|min)(Width|Height)/.exec(e),i=r[2].charAt(0).toLowerCase()+r[2].slice(1),a=n[i];switch(r[1]){case"min":if(a<t)return o=e,!1;break;case"max":if(a>t)return o=e,!1}}}),o);i?a.failure(i):a.success()},a.success):a.success(),a}},Uploader.Session=function(e){"use strict";var t={endpoint:null,params:{},customHeaders:{},cors:{},addFileRecord:function(e){},log:function(e,t){}};function r(e,r,n,o){var i=!1;(r=r&&function(e){if(Uploader.isArray(e))return!0;t.log("Session response is not an array.","error")}(e))&&Uploader.each(e,function(e,r){if(null==r.uuid)i=!0,t.log(Uploader.format("Session response item {} did not include a valid UUID - ignoring.",e),"error");else if(null==r.name)i=!0,t.log(Uploader.format("Session response item {} did not include a valid name - ignoring.",e),"error");else try{return t.addFileRecord(r),!0}catch(e){i=!0,t.log(e.message,"error")}return!1}),o[r&&!i?"success":"failure"](e,n)}Uploader.extend(t,e,!0),this.refresh=function(){var e=new Uploader.Promise,n=Uploader.extend({},t);return new Uploader.SessionAjaxRequester(Uploader.extend(n,{onComplete:function(t,n,o){r(t,n,o,e)}})).queryServer(),e}},Uploader.SessionAjaxRequester=function(e){"use strict";var t,r={endpoint:null,customHeaders:{},params:{},cors:{expected:!1,sendCredentials:!1},onComplete:function(e,t,r){},log:function(e,t){}};Uploader.extend(r,e),t=Uploader.extend(this,new Uploader.AjaxRequester({acceptHeader:"application/json",validMethods:["GET"],method:"GET",endpointStore:{get:function(){return r.endpoint}},customHeaders:r.customHeaders,log:r.log,onComplete:function(e,t,n){var o=null;if(null!=t.responseText)try{o=Uploader.parseJson(t.responseText)}catch(e){r.log("Problem parsing session response: "+e.message,"error"),n=!0}r.onComplete(o,!n,t)},cors:r.cors})),Uploader.extend(this,{queryServer:function(){var e=Uploader.extend({},r.params);r.log("Session query request."),t.initTransport("sessionRefresh").withParams(e).withCacheBuster().send()}})},Uploader.Scaler=function(e,t){"use strict";var r=e.customResizer,n=e.sendOriginal,o=e.orient,i=e.defaultType,a=e.defaultQuality/100,s=e.failureText,l=e.includeExif,u=this._getSortedSizes(e.sizes);Uploader.extend(this,{enabled:Uploader.supportedFeatures.scaling&&u.length>0,getFileRecords:function(e,d,c){var p=this,h=[],f=c.blob?c.blob:c;return new Uploader.Identify(f,t).isPreviewableSync()?(Uploader.each(u,function(e,n){var u=p._determineOutputType({defaultType:i,requestedType:n.type,refType:f.type});h.push({uuid:Uploader.getUniqueId(),name:p._getName(d,{name:n.name,type:u,refType:f.type}),blob:new Uploader.BlobProxy(f,Uploader.bind(p._generateScaledImage,p,{customResizeFunction:r,maxSize:n.maxSize,orient:o,type:u,quality:a,failedText:s,includeExif:l,log:t}))})}),h.push({uuid:e,name:d,size:f.size,blob:n?f:null})):h.push({uuid:e,name:d,size:f.size,blob:f}),h},handleNewFile:function(e,t,r,n,o,i,a,s){e.qqButtonId||e.blob&&e.blob.qqButtonId;var l,u=[],d=null,c=s.addFileToHandler,p=s.uploadData,h=s.paramsStore,f=Uploader.getUniqueId();Uploader.each(this.getFileRecords(r,t,e),function(e,t){var r,n=t.size;t.blob instanceof Uploader.BlobProxy&&(n=-1),r=p.addFile({uuid:t.uuid,name:t.name,size:n,batchId:i,proxyGroupId:f}),t.blob instanceof Uploader.BlobProxy?u.push(r):d=r,t.blob?(c(r,t.blob),o.push({id:r,file:t.blob})):p.setStatus(r,Uploader.status.REJECTED)}),null!==d&&(Uploader.each(u,function(e,t){var r={qqparentuuid:p.retrieve({id:d}).uuid,qqparentsize:p.retrieve({id:d}).size};r[a]=p.retrieve({id:t}).uuid,p.setParentId(t,d),h.addReadOnly(t,r)}),u.length&&((l={})[a]=p.retrieve({id:d}).uuid,h.addReadOnly(d,l)))}})},Uploader.extend(Uploader.Scaler.prototype,{scaleImage:function(e,t,r){"use strict";if(!Uploader.supportedFeatures.scaling)throw new Uploader.Error("Scaling is not supported in this browser!");var n=new Uploader.Promise,o=r.log,i=r.getFile(e),a=r.uploadData.retrieve({id:e}),s=a&&a.name,l=a&&a.uuid,u={customResizer:t.customResizer,sendOriginal:!1,orient:t.orient,defaultType:t.type||null,defaultQuality:t.quality,failedToScaleText:"Unable to scale",sizes:[{name:"",maxSize:t.maxSize}]},d=new Uploader.Scaler(u,o);return Uploader.Scaler&&Uploader.supportedFeatures.imagePreviews&&i?Uploader.bind(function(){var t=d.getFileRecords(l,s,i)[0];t&&t.blob instanceof Uploader.BlobProxy?t.blob.create().then(n.success,n.failure):(o(e+" is not a scalable image!","error"),n.failure())},this)():(n.failure(),o("Could not generate requested scaled image for "+e+".  Scaling is either not possible in this browser, or the file could not be located.","error")),n},_determineOutputType:function(e){"use strict";var t=e.requestedType,r=e.defaultType,n=e.refType;return r||t?t&&Uploader.indexOf(Object.keys(Uploader.Identify.prototype.PREVIEWABLE_MIME_TYPES),t)>=0?"image/tiff"===t?Uploader.supportedFeatures.tiffPreviews?t:r:t:r:"image/jpeg"!==n?"image/png":n},_getName:function(e,t){"use strict";var r=e.lastIndexOf("."),n=t.type||"image/png",o=t.refType,i="",a=Uploader.getExtension(e),s="";return t.name&&t.name.trim().length&&(s=" ("+t.name+")"),r>=0?(i=e.substr(0,r),o!==n&&(a=n.split("/")[1]),i+=s+"."+a):i=e+s,i},_getSortedSizes:function(e){"use strict";return(e=Uploader.extend([],e)).sort(function(e,t){return e.maxSize>t.maxSize?1:e.maxSize<t.maxSize?-1:0})},_generateScaledImage:function(e,t){"use strict";var r=this,n=e.customResizeFunction,o=e.log,i=e.maxSize,a=e.orient,s=e.type,l=e.quality,u=e.failedText,d=e.includeExif&&"image/jpeg"===t.type&&"image/jpeg"===s,c=new Uploader.Promise,p=new Uploader.ImageGenerator(o),h=document.createElement("canvas");return o("Attempting to generate scaled version for "+t.name),p.generate(t,h,{maxSize:i,orient:a,customResizeFunction:n}).then(function(){var e=h.toDataURL(s,l),n=function(){o("Success generating scaled version for "+t.name);var r=Uploader.dataUriToBlob(e);c.success(r)};d?r._insertExifHeader(t,e,o).then(function(t){e=t,n()},function(){o("Problem inserting EXIF header into scaled image.  Using scaled image w/out EXIF data.","error"),n()}):n()},function(){o("Failed attempt to generate scaled version for "+t.name,"error"),c.failure(u)}),c},_insertExifHeader:function(e,t,r){"use strict";var n=new FileReader,o=new Uploader.Promise,i="";return n.onload=function(){i=n.result,o.success(Uploader.ExifRestorer.restore(i,t))},n.onerror=function(){r("Problem reading "+e.name+" during attempt to transfer EXIF data to scaled version.","error"),o.failure()},n.readAsDataURL(e),o},_dataUriToBlob:function(e){"use strict";var t,r,n,o;return t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURI(e.split(",")[1]),r=e.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(t.length),o=new Uint8Array(n),Uploader.each(t,function(e,t){o[e]=t.charCodeAt(0)}),this._createBlob(n,r)},_createBlob:function(e,t){"use strict";var r=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,n=r&&new r;return n?(n.append(e),n.getBlob(t)):new Blob([e],{type:t})}}),Uploader.ExifRestorer=(iE={KEY_STR:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode64:function(e){var t,r,n,o,i,a="",s="",l="",u=0;do{n=(t=e[u++])>>2,o=(3&t)<<4|(r=e[u++])>>4,i=(15&r)<<2|(s=e[u++])>>6,l=63&s,isNaN(r)?i=l=64:isNaN(s)&&(l=64),a=a+this.KEY_STR.charAt(n)+this.KEY_STR.charAt(o)+this.KEY_STR.charAt(i)+this.KEY_STR.charAt(l),t=r=s="",n=o=i=l=""}while(u<e.length);return a},restore:function(e,t){var r="data:image/jpeg;base64,";if(!e.match(r))return t;var n=this.decode64(e.replace(r,"")),o=this.slice2Segments(n),i=this.exifManipulation(t,o);return r+this.encode64(i)},exifManipulation:function(e,t){var r=this.getExifArray(t),n=this.insertExif(e,r);return new Uint8Array(n)},getExifArray:function(e){for(var t,r=0;r<e.length;r++)if(255==(t=e[r])[0]&225==t[1])return t;return[]},insertExif:function(e,t){var r=e.replace("data:image/jpeg;base64,",""),n=this.decode64(r),o=n.indexOf(255,3),i=n.slice(0,o),a=n.slice(o),s=i;return s=(s=s.concat(t)).concat(a)},slice2Segments:function(e){for(var t=0,r=[];!(255==e[t]&218==e[t+1]);){if(255==e[t]&216==e[t+1])t+=2;else{var n=t+(256*e[t+2]+e[t+3])+2,o=e.slice(t,n);r.push(o),t=n}if(t>e.length)break}return r},decode64:function(e){var t,r,n,o,i="",a="",s=0,l=[];if(/[^A-Za-z0-9\+\/\=]/g.exec(e))throw new Error("There were invalid base64 characters in the input text.  Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='");e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{t=this.KEY_STR.indexOf(e.charAt(s++))<<2|(n=this.KEY_STR.indexOf(e.charAt(s++)))>>4,r=(15&n)<<4|(o=this.KEY_STR.indexOf(e.charAt(s++)))>>2,i=(3&o)<<6|(a=this.KEY_STR.indexOf(e.charAt(s++))),l.push(t),64!=o&&l.push(r),64!=a&&l.push(i),t=r=i="",n=o=a=""}while(s<e.length);return l}},iE),Uploader.TotalProgress=function(e,t){"use strict";var r={},n=0,o=0,i=-1,a=-1,s=function(t,r){t===i&&r===a||e(t,r),i=t,a=r},l=function(e){var n=t(e);n>0&&(u(e,0,n),r[e]={loaded:0,total:n})},u=function(e,t,i){var a=r[e]?r[e].loaded:0,l=r[e]?r[e].total:0;-1===t&&-1===i?(n-=a,o-=l):(t&&(n+=t-a),i&&(o+=i-l)),s(n,o)};Uploader.extend(this,{onAllComplete:function(e,t,r){var n,i,a;(0===t.length||(n=t,i=r,a=!0,Uploader.each(n,function(e,t){if(Uploader.indexOf(i,t)>=0)return a=!1,!1}),a))&&(s(o,o),this.reset())},onStatusChange:function(e,t,n){var o;n===Uploader.status.CANCELED||n===Uploader.status.REJECTED?(u(o=e,-1,-1),delete r[o]):n===Uploader.status.SUBMITTING&&l(e)},onIndividualProgress:function(e,t,n){u(e,t,n),r[e]={loaded:t,total:n}},onNewSize:function(e){l(e)},reset:function(){r={},n=0,o=0}})},Uploader.PasteSupport=function(e){"use strict";var t,r;t={targetElement:null,callbacks:{log:function(e,t){},pasteReceived:function(e){}}},Uploader.extend(t,e),r=Uploader(t.targetElement).attach("paste",function(e){var r=e.clipboardData;r&&Uploader.each(r.items,function(e,r){if((o=r).type&&0===o.type.indexOf("image/")){var n=r.getAsFile();t.callbacks.pasteReceived(n)}var o})}),Uploader.extend(this,{reset:function(){r&&r()}})},Uploader.FormSupport=function(e,t,r){"use strict";var n,o,i,a,s=this,l=e.interceptSubmit,u=e.element,d=e.autoUpload;function c(e,t){if(!e.checkValidity||e.checkValidity())return!0;r("Form did not pass validation checks - will not upload.","error"),t()}Uploader.extend(this,{newEndpoint:null,newAutoUpload:d,attachedToForm:!1,getFormInputsAsObject:function(){return null==u?null:s._form2Obj(u)}}),(n=u)&&(Uploader.isString(n)&&(n=document.getElementById(n)),n&&(r("Attaching to form element."),(a=n).getAttribute("action")&&(s.newEndpoint=a.getAttribute("action")),l&&(i=(o=n).submit,Uploader(o).attach("submit",function(e){(e=e||window.event).preventDefault?e.preventDefault():e.returnValue=!1,c(o,i)&&t()}),o.submit=function(){c(o,i)&&t()}))),u=n,this.attachedToForm=!!u},Uploader.extend(Uploader.FormSupport.prototype,{_form2Obj:function(e){"use strict";var t={},r=function(e){return t=e.type,Uploader.indexOf(["checkbox","radio"],t.toLowerCase())>=0&&!e.checked||e.disabled&&"hidden"!==e.type.toLowerCase();var t};return Uploader.each(e.elements,function(e,n){if((Uploader.isInput(n,!0)||"textarea"===n.tagName.toLowerCase())&&(s=n.type,Uploader.indexOf(["button","image","reset","submit"],s.toLowerCase())<0)&&!r(n))t[n.name]=n.value;else if("select"===n.tagName.toLowerCase()&&!r(n)){var o=(i=n,a=null,Uploader.each(Uploader(i).children(),function(e,t){if("option"===t.tagName.toLowerCase()&&t.selected)return a=t.value,!1}),a);null!==o&&(t[n.name]=o)}var i,a,s}),t}}),Uploader.CryptoJS=(NG=Math,PG={},QG=PG.lib={},RG=QG.Base=function(){function e(){}return{extend:function(t){e.prototype=this;var r=new e;return t&&r.mixIn(t),r.hasOwnProperty("init")||(r.init=function(){r.$super.init.apply(this,arguments)}),r.init.prototype=r,r.$super=this,r},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),SG=QG.WordArray=RG.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||UG).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,o=e.sigBytes;if(this.clamp(),n%4)for(var i=0;i<o;i++){var a=r[i>>>2]>>>24-i%4*8&255;t[n+i>>>2]|=a<<24-(n+i)%4*8}else if(r.length>65535)for(i=0;i<o;i+=4)t[n+i>>>2]=r[i>>>2];else t.push.apply(t,r);return this.sigBytes+=o,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=NG.ceil(t/4)},clone:function(){var e=RG.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(4294967296*NG.random()|0);return new SG.init(t,e)}}),TG=PG.enc={},UG=TG.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new SG.init(r,t/2)}},VG=TG.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push(String.fromCharCode(i))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new SG.init(r,t)}},WG=TG.Utf8={stringify:function(e){try{return decodeURIComponent(escape(VG.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return VG.parse(unescape(encodeURIComponent(e)))}},XG=QG.BufferedBlockAlgorithm=RG.extend({reset:function(){this._data=new SG.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=WG.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,r=t.words,n=t.sigBytes,o=this.blockSize,i=n/(4*o),a=(i=e?NG.ceil(i):NG.max((0|i)-this._minBufferSize,0))*o,s=NG.min(4*a,n);if(a){for(var l=0;l<a;l+=o)this._doProcessBlock(r,l);var u=r.splice(0,a);t.sigBytes-=s}return new SG.init(u,s)},clone:function(){var e=RG.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),QG.Hasher=XG.extend({cfg:RG.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){XG.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new ZG.HMAC.init(e,r).finalize(t)}}}),ZG=PG.algo={},PG),mI=Uploader.CryptoJS,oI=mI.lib.WordArray,mI.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var o=[],i=0;i<r;i+=3)for(var a=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,s=0;s<4&&i+.75*s<r;s++)o.push(n.charAt(a>>>6*(3-s)&63));var l=n.charAt(64);if(l)for(;o.length%4;)o.push(l);return o.join("")},parse:function(e){var t=e.length,r=this._map,n=r.charAt(64);if(n){var o=e.indexOf(n);-1!=o&&(t=o)}for(var i=[],a=0,s=0;s<t;s++)if(s%4){var l=r.indexOf(e.charAt(s-1))<<s%4*2,u=r.indexOf(e.charAt(s))>>>6-s%4*2;i[a>>>2]|=(l|u)<<24-a%4*8,a++}return oI.create(i,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},NI=Uploader.CryptoJS,PI=NI.lib.Base,RI=NI.enc.Utf8,NI.algo.HMAC=PI.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=RI.parse(t));var r=e.blockSize,n=4*r;t.sigBytes>n&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),i=this._iKey=t.clone(),a=o.words,s=i.words,l=0;l<r;l++)a[l]^=1549556828,s[l]^=909522486;o.sigBytes=i.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}}),hJ=Uploader.CryptoJS,iJ=hJ.lib,jJ=iJ.WordArray,kJ=iJ.Hasher,lJ=hJ.algo,mJ=[],nJ=lJ.SHA1=kJ.extend({_doReset:function(){this._hash=new jJ.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],o=r[1],i=r[2],a=r[3],s=r[4],l=0;l<80;l++){if(l<16)mJ[l]=0|e[t+l];else{var u=mJ[l-3]^mJ[l-8]^mJ[l-14]^mJ[l-16];mJ[l]=u<<1|u>>>31}var d=(n<<5|n>>>27)+s+mJ[l];d+=l<20?1518500249+(o&i|~o&a):l<40?1859775393+(o^i^a):l<60?(o&i|o&a|i&a)-1894007588:(o^i^a)-899497514,s=a,a=i,i=o<<30|o>>>2,o=n,n=d}r[0]=r[0]+n|0,r[1]=r[1]+o|0,r[2]=r[2]+i|0,r[3]=r[3]+a|0,r[4]=r[4]+s|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(n+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=kJ.clone.call(this);return e._hash=this._hash.clone(),e}}),hJ.SHA1=kJ._createHelper(nJ),hJ.HmacSHA1=kJ._createHmacHelper(nJ),function(e){var t=Uploader.CryptoJS,r=t.lib,n=r.WordArray,o=r.Hasher,i=t.algo,a=[],s=[];!function(){function t(t){for(var r=e.sqrt(t),n=2;n<=r;n++)if(!(t%n))return!1;return!0}function r(e){return 4294967296*(e-(0|e))|0}for(var n=2,o=0;o<64;)t(n)&&(o<8&&(a[o]=r(e.pow(n,.5))),s[o]=r(e.pow(n,1/3)),o++),n++}();var l=[],u=i.SHA256=o.extend({_doReset:function(){this._hash=new n.init(a.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],o=r[1],i=r[2],a=r[3],u=r[4],d=r[5],c=r[6],p=r[7],h=0;h<64;h++){if(h<16)l[h]=0|e[t+h];else{var f=l[h-15],g=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,m=l[h-2],U=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;l[h]=g+l[h-7]+U+l[h-16]}var y=n&o^n&i^o&i,v=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),S=p+((u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25))+(u&d^~u&c)+s[h]+l[h];p=c,c=d,d=u,u=a+S|0,a=i,i=o,o=n,n=S+(v+y)|0}r[0]=r[0]+n|0,r[1]=r[1]+o|0,r[2]=r[2]+i|0,r[3]=r[3]+a|0,r[4]=r[4]+u|0,r[5]=r[5]+d|0,r[6]=r[6]+c|0,r[7]=r[7]+p|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,o=8*t.sigBytes;return r[o>>>5]|=128<<24-o%32,r[14+(o+64>>>9<<4)]=e.floor(n/4294967296),r[15+(o+64>>>9<<4)]=n,t.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=o._createHelper(u),t.HmacSHA256=o._createHmacHelper(u)}(Math),function(){if("function"==typeof ArrayBuffer){var e=Uploader.CryptoJS.lib.WordArray,t=e.init;(e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var r=e.byteLength,n=[],o=0;o<r;o++)n[o>>>2]|=e[o]<<24-o%4*8;t.call(this,n,r)}else t.apply(this,arguments)}).prototype=e}}(),Uploader.s3=Uploader.s3||{},Uploader.s3.util=Uploader.s3.util||function(){"use strict";return{ALGORITHM_PARAM_NAME:"x-amz-algorithm",AWS_PARAM_PREFIX:"x-amz-meta-",CREDENTIAL_PARAM_NAME:"x-amz-credential",DATE_PARAM_NAME:"x-amz-date",REDUCED_REDUNDANCY_PARAM_NAME:"x-amz-storage-class",REDUCED_REDUNDANCY_PARAM_VALUE:"REDUCED_REDUNDANCY",SERVER_SIDE_ENCRYPTION_PARAM_NAME:"x-amz-server-side-encryption",SERVER_SIDE_ENCRYPTION_PARAM_VALUE:"AES256",SESSION_TOKEN_PARAM_NAME:"x-amz-security-token",V4_ALGORITHM_PARAM_VALUE:"AWS4-HMAC-SHA256",V4_SIGNATURE_PARAM_NAME:"x-amz-signature",CASE_SENSITIVE_PARAM_NAMES:["Cache-Control","Content-Disposition","Content-Encoding","Content-MD5"],UNSIGNABLE_REST_HEADER_NAMES:["Cache-Control","Content-Disposition","Content-Encoding","Content-MD5"],UNPREFIXED_PARAM_NAMES:["Cache-Control","Content-Disposition","Content-Encoding","Content-MD5","x-amz-server-side-encryption","x-amz-server-side-encryption-aws-kms-key-id","x-amz-server-side-encryption-customer-algorithm","x-amz-server-side-encryption-customer-key","x-amz-server-side-encryption-customer-key-MD5"],getBucket:function(e){var t;return Uploader.each([/^(?:https?:\/\/)?([a-z0-9.\-_]+)\.s3(?:-[a-z0-9\-]+)?\.amazonaws\.com/i,/^(?:https?:\/\/)?s3(?:-[a-z0-9\-]+)?\.amazonaws\.com\/([a-z0-9.\-_]+)/i,/^(?:https?:\/\/)?([a-z0-9.\-_]+)/i],function(r,n){var o=n.exec(e);if(o)return t=o[1],!1}),t},_getPrefixedParamName:function(e){return Uploader.indexOf(Uploader.s3.util.UNPREFIXED_PARAM_NAMES,e)>=0?e:Uploader.s3.util.AWS_PARAM_PREFIX+e},getPolicy:function(e){var t={},r=[],n=e.bucket,o=e.date,i=e.clockDrift,a=e.key,s=e.accessKey,l=e.acl,u=e.type,d=e.expectedStatus,c=e.sessionToken,p=e.params,h=Uploader.s3.util.getSuccessRedirectAbsoluteUrl(e.successRedirectUrl),f=e.minFileSize,g=e.maxFileSize,m=e.reducedRedundancy,U=e.region,y=e.serverSideEncryption,v=e.signatureVersion;return t.expiration=Uploader.s3.util.getPolicyExpirationDate(o,i),r.push({acl:l}),r.push({bucket:n}),u&&r.push({"Content-Type":u}),d&&r.push({success_action_status:d.toString()}),h&&r.push({success_action_redirect:h}),m&&(r.push({}),r[r.length-1][Uploader.s3.util.REDUCED_REDUNDANCY_PARAM_NAME]=Uploader.s3.util.REDUCED_REDUNDANCY_PARAM_VALUE),c&&(r.push({}),r[r.length-1][Uploader.s3.util.SESSION_TOKEN_PARAM_NAME]=c),y&&(r.push({}),r[r.length-1][Uploader.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_NAME]=Uploader.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_VALUE),2===v?r.push({key:a}):4===v&&(r.push({}),r[r.length-1][Uploader.s3.util.ALGORITHM_PARAM_NAME]=Uploader.s3.util.V4_ALGORITHM_PARAM_VALUE,r.push({}),r[r.length-1].key=a,r.push({}),r[r.length-1][Uploader.s3.util.CREDENTIAL_PARAM_NAME]=Uploader.s3.util.getV4CredentialsString({date:o,key:s,region:U}),r.push({}),r[r.length-1][Uploader.s3.util.DATE_PARAM_NAME]=Uploader.s3.util.getV4PolicyDate(o,i)),Uploader.each(p,function(e,t){var n=Uploader.s3.util._getPrefixedParamName(e),o={};Uploader.indexOf(Uploader.s3.util.UNPREFIXED_PARAM_NAMES,n)>=0?o[n]=t:o[n]=encodeURIComponent(t),r.push(o)}),t.conditions=r,Uploader.s3.util.enforceSizeLimits(t,f,g),t},refreshPolicyCredentials:function(e,t){var r=!1;Uploader.each(e.conditions,function(e,n){Uploader.each(n,function(e,o){e===Uploader.s3.util.SESSION_TOKEN_PARAM_NAME&&(n[e]=t,r=!0)})}),r||(e.conditions.push({}),e.conditions[e.conditions.length-1][Uploader.s3.util.SESSION_TOKEN_PARAM_NAME]=t)},generateAwsParams:function(e,t){var r,n={},o=e.params,i=new Uploader.Promise,a=e.sessionToken,s=e.clockDrift,l=e.type,u=e.key,d=e.accessKey,c=e.acl,p=e.expectedStatus,h=Uploader.s3.util.getSuccessRedirectAbsoluteUrl(e.successRedirectUrl),f=e.reducedRedundancy,g=e.region,m=e.serverSideEncryption,U=e.signatureVersion,y=new Date,v=e.log;return e.date=y,r=Uploader.s3.util.getPolicy(e),n.key=u,l&&(n["Content-Type"]=l),p&&(n.success_action_status=p),h&&(n.success_action_redirect=h),f&&(n[Uploader.s3.util.REDUCED_REDUNDANCY_PARAM_NAME]=Uploader.s3.util.REDUCED_REDUNDANCY_PARAM_VALUE),m&&(n[Uploader.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_NAME]=Uploader.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_VALUE),a&&(n[Uploader.s3.util.SESSION_TOKEN_PARAM_NAME]=a),n.acl=c,Uploader.each(o,function(e,t){var r=Uploader.s3.util._getPrefixedParamName(e);Uploader.indexOf(Uploader.s3.util.UNPREFIXED_PARAM_NAMES,r)>=0?n[r]=t:n[r]=encodeURIComponent(t)}),2===U?n.AWSAccessKeyId=d:4===U&&(n[Uploader.s3.util.ALGORITHM_PARAM_NAME]=Uploader.s3.util.V4_ALGORITHM_PARAM_VALUE,n[Uploader.s3.util.CREDENTIAL_PARAM_NAME]=Uploader.s3.util.getV4CredentialsString({date:y,key:d,region:g}),n[Uploader.s3.util.DATE_PARAM_NAME]=Uploader.s3.util.getV4PolicyDate(y,s)),t(r).then(function(t,r,o){n.policy=t.policy,2===e.signatureVersion?(n.signature=t.signature,r&&(n.AWSAccessKeyId=r)):4===e.signatureVersion&&(n[Uploader.s3.util.V4_SIGNATURE_PARAM_NAME]=t.signature),o&&(n[Uploader.s3.util.SESSION_TOKEN_PARAM_NAME]=o),i.success(n)},function(e){v("Policy signing failed.  "+(e=e||"Can't continue further with request to S3 as we did not receive a valid signature and policy from the server."),"error"),i.failure(e)}),i},enforceSizeLimits:function(e,t,r){var n=t<0?0:t,o=r<=0?9007199254740992:r;(t>0||r>0)&&e.conditions.push(["content-length-range",n.toString(),o.toString()])},getPolicyExpirationDate:function(e,t){var r=new Date(e.getTime()+t);return Uploader.s3.util.getPolicyDate(r,5)},getCredentialsDate:function(e){return e.getUTCFullYear()+""+("0"+(e.getUTCMonth()+1)).slice(-2)+("0"+e.getUTCDate()).slice(-2)},getPolicyDate:function(e,t){var r,n,o=t||0;return e.setMinutes(e.getMinutes()+(o||0)),Date.prototype.toISOString?e.toISOString():(r=function(e){return 1===(n=String(e)).length&&(n="0"+n),n},e.getUTCFullYear()+"-"+r(e.getUTCMonth()+1)+"-"+r(e.getUTCDate())+"T"+r(e.getUTCHours())+":"+r(e.getUTCMinutes())+":"+r(e.getUTCSeconds())+"."+String((e.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z")},parseIframeResponse:function(e){var t=(e.contentDocument||e.contentWindow.document).location.search,r=/bucket=(.+)&key=(.+)&etag=(.+)/.exec(t);if(r)return{bucket:r[1],key:r[2],etag:r[3].replace(/%22/g,"")}},getSuccessRedirectAbsoluteUrl:function(e){if(e){var t,r=document.createElement("div");return Uploader.ie7()?(r.innerHTML="<a href='"+e+"'></a>",(t=r.firstChild).href):((t=document.createElement("a")).href=e,t.href=t.href,t.href)}},getV4CredentialsString:function(e){return e.key+"/"+Uploader.s3.util.getCredentialsDate(e.date)+"/"+e.region+"/s3/aws4_request"},getV4PolicyDate:function(e,t){var r=new Date(e.getTime()+t);return Uploader.s3.util.getCredentialsDate(r)+"T"+("0"+r.getUTCHours()).slice(-2)+("0"+r.getUTCMinutes()).slice(-2)+("0"+r.getUTCSeconds()).slice(-2)+"Z"},encodeQueryStringParam:function(e){var t=encodeURIComponent(e);return(t=(t=t.replace(/[!'()]/g,escape)).replace(/\*/g,"%2A")).replace(/%20/g,"+")},uriEscape:function(e){var t=encodeURIComponent(e);return t=(t=t.replace(/[^A-Za-z0-9_.~\-%]+/g,escape)).replace(/[*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})},uriEscapePath:function(e){var t=[];return Uploader.each(e.split("/"),function(e,r){t.push(Uploader.s3.util.uriEscape(r))}),t.join("/")}}}(),function(){"use strict";Uploader.nonTraditionalBasePublicApi={setUploadSuccessParams:function(e,t){this._uploadSuccessParamsStore.set(e,t)},setUploadSuccessEndpoint:function(e,t){this._uploadSuccessEndpointStore.set(e,t)}},Uploader.nonTraditionalBasePrivateApi={_onComplete:function(e,t,r,n){var o,i,a=!!r.success,s=this,l=arguments,u=this._uploadSuccessEndpointStore.get(e),d=this._options.uploadSuccess.customHeaders,c=this._options.uploadSuccess.method,p=this._options.cors,h=new Uploader.Promise,f=this._uploadSuccessParamsStore.get(e),g=this._paramsStore.get(e),m=function(t){delete s._failedSuccessRequestCallbacks[e],Uploader.extend(r,t),Uploader.UploaderBasic.prototype._onComplete.apply(s,l),h.success(t)},U=function(i){var a=o;Uploader.extend(r,i),r&&r.reset&&(a=null),a?s._failedSuccessRequestCallbacks[e]=a:delete s._failedSuccessRequestCallbacks[e],s._onAutoRetry(e,t,r,n,a)||(Uploader.UploaderBasic.prototype._onComplete.apply(s,l),h.failure(i))};return a&&u?(i=new Uploader.UploadSuccessAjaxRequester({endpoint:u,method:c,customHeaders:d,cors:p,log:Uploader.bind(this.log,this)}),Uploader.extend(f,s._getEndpointSpecificParams(e,r,n),!0),g&&Uploader.extend(f,g,!0),(o=Uploader.bind(function(){i.sendSuccessRequest(e,f).then(m,U)},s))(),h):Uploader.UploaderBasic.prototype._onComplete.apply(this,arguments)},_manualRetry:function(e){var t=this._failedSuccessRequestCallbacks[e];return Uploader.UploaderBasic.prototype._manualRetry.call(this,e,t)}}}(),function(){"use strict";Uploader.s3.UploaderBasic=function(e){var t={request:{accessKey:null,clockDrift:0},objectProperties:{acl:"private",bucket:Uploader.bind(function(e){return Uploader.s3.util.getBucket(this.getEndpoint(e))},this),host:Uploader.bind(function(e){return/(?:http|https):\/\/(.+)(?:\/.+)?/.exec(this._endpointStore.get(e))[1]},this),key:"uuid",reducedRedundancy:!1,region:"us-east-1",serverSideEncryption:!1},credentials:{accessKey:null,secretKey:null,expiration:null,sessionToken:null},signature:{customHeaders:{},endpoint:null,version:2},uploadSuccess:{endpoint:null,method:"POST",params:{},customHeaders:{}},iframeSupport:{localBlankPagePath:null},chunking:{partSize:5242880},cors:{allowXdr:!0},callbacks:{onCredentialsExpired:function(){}}};Uploader.extend(t,e,!0),this.setCredentials(t.credentials,!0)||(this._currentCredentials.accessKey=t.request.accessKey),this._aclStore=this._createStore(t.objectProperties.acl),Uploader.UploaderBasic.call(this,t),this._uploadSuccessParamsStore=this._createStore(this._options.uploadSuccess.params),this._uploadSuccessEndpointStore=this._createStore(this._options.uploadSuccess.endpoint),this._failedSuccessRequestCallbacks={},this._cannedKeys={},this._cannedBuckets={},this._buckets={},this._hosts={}},Uploader.extend(Uploader.s3.UploaderBasic.prototype,Uploader.basePublicApi),Uploader.extend(Uploader.s3.UploaderBasic.prototype,Uploader.basePrivateApi),Uploader.extend(Uploader.s3.UploaderBasic.prototype,Uploader.nonTraditionalBasePublicApi),Uploader.extend(Uploader.s3.UploaderBasic.prototype,Uploader.nonTraditionalBasePrivateApi),Uploader.extend(Uploader.s3.UploaderBasic.prototype,{getBucket:function(e){return null==this._cannedBuckets[e]?this._buckets[e]:this._cannedBuckets[e]},getKey:function(e){return null==this._cannedKeys[e]?this._handler.getThirdPartyFileId(e):this._cannedKeys[e]},reset:function(){Uploader.UploaderBasic.prototype.reset.call(this),this._failedSuccessRequestCallbacks=[],this._buckets={},this._hosts={}},setCredentials:function(e,t){if(e&&e.secretKey){if(!e.accessKey)throw new Uploader.Error("Invalid credentials: no accessKey");if(!e.expiration)throw new Uploader.Error("Invalid credentials: no expiration");return this._currentCredentials=Uploader.extend({},e),Uploader.isString(e.expiration)&&(this._currentCredentials.expiration=new Date(e.expiration)),!0}if(!t)throw new Uploader.Error("Invalid credentials parameter!");this._currentCredentials={}},setAcl:function(e,t){this._aclStore.set(e,t)},_createUploadHandler:function(){var e=this,t={aclStore:this._aclStore,getBucket:Uploader.bind(this._determineBucket,this),getHost:Uploader.bind(this._determineHost,this),getKeyName:Uploader.bind(this._determineKeyName,this),iframeSupport:this._options.iframeSupport,objectProperties:this._options.objectProperties,signature:this._options.signature,clockDrift:this._options.request.clockDrift,validation:{minSizeLimit:this._options.validation.minSizeLimit,maxSizeLimit:this._options.validation.sizeLimit}};return Uploader.override(this._endpointStore,function(e){return{get:function(t){var r=e.get(t);return r.indexOf("http")<0?"http://"+r:r}}}),Uploader.override(this._paramsStore,function(e){return{get:function(t){var r=e.get(t),n={};return Uploader.each(r,function(e,t){var r=e;Uploader.indexOf(Uploader.s3.util.CASE_SENSITIVE_PARAM_NAMES,r)<0&&(r=r.toLowerCase()),n[r]=Uploader.isFunction(t)?t():t}),n}}}),t.signature.credentialsProvider={get:function(){return e._currentCredentials},onExpired:function(){var t=new Uploader.Promise,r=e._options.callbacks.onCredentialsExpired();return Uploader.isGenericPromise(r)?r.then(function(r){try{e.setCredentials(r),t.success()}catch(r){e.log("Invalid credentials returned from onCredentialsExpired callback! ("+r.message+")","error"),t.failure("onCredentialsExpired did not return valid credentials.")}},function(r){e.log("onCredentialsExpired callback indicated failure! ("+r+")","error"),t.failure("onCredentialsExpired callback failed.")}):(e.log("onCredentialsExpired callback did not return a promise!","error"),t.failure("Unexpected return value for onCredentialsExpired.")),t}},Uploader.UploaderBasic.prototype._createUploadHandler.call(this,t,"s3")},_determineObjectPropertyValue:function(e,t){var r=this._options.objectProperties[t],n=new Uploader.Promise,o=this;return Uploader.isFunction(r)?(r=r(e),Uploader.isGenericPromise(r)?n=r:n.success(r)):Uploader.isString(r)&&n.success(r),n.then(function(r){o["_"+t+"s"][e]=r},function(r){Uploader.log("Problem determining "+t+" for ID "+e+" ("+r+")","error")}),n},_determineBucket:function(e){return this._determineObjectPropertyValue(e,"bucket")},_determineHost:function(e){return this._determineObjectPropertyValue(e,"host")},_determineKeyName:function(e,t){var r=new Uploader.Promise,n=this._options.objectProperties.key,o=Uploader.getExtension(t),i=r.failure,a=function(e,t){var n=e;void 0!==t&&(n+="."+t),r.success(n)};switch(n){case"uuid":a(this.getUuid(e),o);break;case"filename":a(t);break;default:Uploader.isFunction(n)?this._handleKeynameFunction(n,e,a,i):(this.log(n+" is not a valid value for the s3.keyname option!","error"),i())}return r},_handleKeynameFunction:function(e,t,r,n){var o=this,i=function(e){r(e)},a=function(e){o.log(Uploader.format("Failed to retrieve key name for {}.  Reason: {}",t,e||"null"),"error"),n(e)},s=e.call(this,t);Uploader.isGenericPromise(s)?s.then(i,a):null==s?a():i(s)},_getEndpointSpecificParams:function(e,t,r){var n={key:this.getKey(e),uuid:this.getUuid(e),name:this.getName(e),bucket:this.getBucket(e)};return r&&r.getResponseHeader("ETag")?n.etag=r.getResponseHeader("ETag"):t.etag&&(n.etag=t.etag),n},_onSubmitDelete:function(e,t){var r={key:this.getKey(e),bucket:this.getBucket(e)};return Uploader.UploaderBasic.prototype._onSubmitDelete.call(this,e,t,r)},_addCannedFile:function(e){var t;if(null==e.s3Key)throw new Uploader.Error("Did not find s3Key property in server session response.  This is required!");return t=Uploader.UploaderBasic.prototype._addCannedFile.apply(this,arguments),this._cannedKeys[t]=e.s3Key,this._cannedBuckets[t]=e.s3Bucket,t}})}(),window.Uint8ClampedArray||(window.Uint8ClampedArray=function(){}),Uploader.s3.RequestSigner=function(e){"use strict";var t,r,n=this,o={},i={expectingPolicy:!1,method:"POST",signatureSpec:{drift:0,credentialsProvider:{},endpoint:null,customHeaders:{},version:2},maxConnections:3,endpointStore:{},paramsStore:{},cors:{expected:!1,sendCredentials:!1},log:function(e,t){}},a=function(e,t,r){var n=e.getHeaders();4===i.signatureSpec.version?n.Authorization=Uploader.s3.util.V4_ALGORITHM_PARAM_VALUE+" Credential="+i.signatureSpec.credentialsProvider.get().accessKey+"/"+Uploader.s3.util.getCredentialsDate(e.getRequestDate())+"/"+i.signatureSpec.region+"/s3/aws4_request,SignedHeaders="+e.getSignedHeaders()+",Signature="+t:n.Authorization="AWS "+i.signatureSpec.credentialsProvider.get().accessKey+":"+t,r.success(n,e.getEndOfUrl())},s={getStringToSign:function(e){return Uploader.format("{}\n{}\n{}\n\n{}/{}/{}",e.method,e.contentMd5||"",e.contentType||"",e.headersStr||"\n",e.bucket,e.endOfUrl)},signApiRequest:function(e,t,n){var o=Uploader.CryptoJS.enc.Utf8.parse(t),i=Uploader.CryptoJS.HmacSHA1(o,r.get().secretKey),s=Uploader.CryptoJS.enc.Base64.stringify(i);a(e,s,n)},signPolicy:function(e,t,n,o){var i=JSON.stringify(e),a=Uploader.CryptoJS.enc.Utf8.parse(i),s=Uploader.CryptoJS.enc.Base64.stringify(a),l=Uploader.CryptoJS.HmacSHA1(s,r.get().secretKey),u=Uploader.CryptoJS.enc.Base64.stringify(l);t.success({policy:s,signature:u},n,o)}},l={getCanonicalQueryString:function(e){var t,r,n,o=e.indexOf("?"),i="";return o>=0&&(t={},n=e.substr(o+1).split("&"),Uploader.each(n,function(e,r){var n=r.split("="),o=n[1];null==o&&(o=""),t[encodeURIComponent(n[0])]=encodeURIComponent(o)}),(r=Object.keys(t).sort()).forEach(function(e,n){i+=e+"="+t[e],n<r.length-1&&(i+="&")})),i},getCanonicalRequest:function(e){return Uploader.format("{}\n{}\n{}\n{}\n{}\n{}",e.method,l.getCanonicalUri(e.endOfUrl),l.getCanonicalQueryString(e.endOfUrl),e.headersStr||"\n",l.getSignedHeaders(e.headerNames),e.hashedContent)},getCanonicalUri:function(e){var t=e,r=e.indexOf("?");return r>0&&(t=e.substr(0,r)),"/"+t},getEncodedHashedPayload:function(e){var t,r=new Uploader.Promise;return Uploader.isBlob(e)?((t=new FileReader).onloadend=function(e){if(e.target.readyState===FileReader.DONE)if(e.target.error)r.failure(e.target.error);else{var t=Uploader.CryptoJS.lib.WordArray.create(e.target.result);r.success(Uploader.CryptoJS.SHA256(t).toString())}},t.readAsArrayBuffer(e)):(e=e||"",r.success(Uploader.CryptoJS.SHA256(e).toString())),r},getScope:function(e,t){return Uploader.s3.util.getCredentialsDate(e)+"/"+t+"/s3/aws4_request"},getStringToSign:function(e){var t=l.getCanonicalRequest(e),r=Uploader.s3.util.getV4PolicyDate(e.date,e.drift),n=Uploader.CryptoJS.SHA256(t).toString(),o=l.getScope(e.date,i.signatureSpec.region),a="AWS4-HMAC-SHA256\n{}\n{}\n{}";return{hashed:Uploader.format(a,r,o,n),raw:Uploader.format(a,r,o,t)}},getSignedHeaders:function(e){var t="";return e.forEach(function(r,n){t+=r.toLowerCase(),n<e.length-1&&(t+=";")}),t},signApiRequest:function(e,t,n){var o,i,s,l,u=r.get().secretKey,d=/.+\n.+\n(\d+)\/(.+)\/s3\/.+\n(.+)/.exec(t);o=Uploader.CryptoJS.HmacSHA256(d[1],"AWS4"+u),i=Uploader.CryptoJS.HmacSHA256(d[2],o),s=Uploader.CryptoJS.HmacSHA256("s3",i),l=Uploader.CryptoJS.HmacSHA256("aws4_request",s),a(e,Uploader.CryptoJS.HmacSHA256(t,l),n)},signPolicy:function(e,t,n,o){var i,a,s,l,u,d,c=JSON.stringify(e),p=Uploader.CryptoJS.enc.Utf8.parse(c),h=Uploader.CryptoJS.enc.Base64.stringify(p),f=r.get().secretKey,g=(d=null,Uploader.each(e.conditions,function(e,t){var r=t["x-amz-credential"];if(r)return d=r,!1}),d);i=/.+\/(.+)\/(.+)\/s3\/aws4_request/.exec(g),a=Uploader.CryptoJS.HmacSHA256(i[1],"AWS4"+f),s=Uploader.CryptoJS.HmacSHA256(i[2],a),l=Uploader.CryptoJS.HmacSHA256("s3",s),u=Uploader.CryptoJS.HmacSHA256("aws4_request",l),t.success({policy:h,signature:Uploader.CryptoJS.HmacSHA256(h,u).toString()},n,o)}};function u(e,t,r,n,o){var a,u,d,c,p;t.signatureConstructor?(o&&((a=t.signatureConstructor.getHeaders())[Uploader.s3.util.SESSION_TOKEN_PARAM_NAME]=o,t.signatureConstructor.withHeaders(a)),t.signatureConstructor.getToSign(e).then(function(e){var n,o,a;n=t.signatureConstructor,o=e.stringToSign,a=r,4===i.signatureSpec.version?l.signApiRequest(n,o,a):s.signApiRequest(n,o,a)},function(e){r.failure(e)})):(o&&Uploader.s3.util.refreshPolicyCredentials(t,o),u=t,d=r,c=n,p=o,4===i.signatureSpec.version?l.signPolicy(u,d,c,p):s.signPolicy(u,d,c,p))}Uploader.extend(i,e,!0),r=i.signatureSpec.credentialsProvider,t=Uploader.extend(this,new Uploader.AjaxRequester({acceptHeader:"application/json",method:i.method,contentType:"application/json; charset=utf-8",endpointStore:{get:function(){return i.signatureSpec.endpoint}},paramsStore:i.paramsStore,maxConnections:i.maxConnections,customHeaders:i.signatureSpec.customHeaders,log:i.log,onComplete:function(e,t,r){var n,s,l=t.responseText,u=o[e],d=u.promise,c=u.signatureConstructor;if(delete o[e],l)try{s=Uploader.parseJson(l)}catch(e){i.log("Error attempting to parse signature response: "+e,"error")}s&&s.error?(r=!0,n=s.error):s&&s.invalid?(r=!0,n="Invalid policy document or request headers!"):s?i.expectingPolicy&&!s.policy?(r=!0,n="Response does not include the base64 encoded policy!"):s.signature||(r=!0,n="Response does not include the signature!"):(r=!0,n="Received an empty or invalid response from the server!"),r?(n&&i.log(n,"error"),d.failure(n)):c?a(c,s.signature,d):d.success(s)},cors:i.cors})),Uploader.extend(this,{getSignature:function(e,n){var a,s=n,l=n.signatureConstructor,d=new Uploader.Promise;return 4===i.signatureSpec.version&&(a={v4:!0}),r.get().secretKey&&Uploader.CryptoJS?r.get().expiration.getTime()>Date.now()?u(e,n,d):r.onExpired().then(function(){u(e,n,d,r.get().accessKey,r.get().sessionToken)},function(e){i.log("Attempt to update expired credentials apparently failed! Unable to sign request.  ","error"),d.failure("Unable to sign request - expired credentials.")}):(i.log("Submitting S3 signature request for "+e),l?l.getToSign(e).then(function(r){s={headers:r.stringToSignRaw},t.initTransport(e).withParams(s).withQueryParams(a).send()},function(e){i.log("Failed to construct signature. ","error"),d.failure("Failed to construct signature.")}):t.initTransport(e).withParams(s).withQueryParams(a).send(),o[e]={promise:d,signatureConstructor:l}),d},constructStringToSign:function(e,t,o,a){var u,d,c,p,h,f={};return{withHeaders:function(e){return f=e,this},withUploadId:function(e){return u=e,this},withContent:function(e){return d=e,this},withContentType:function(e){return c=e,this},withPartNum:function(e){return p=e,this},getToSign:function(g){var m=r.get().sessionToken,U=new Uploader.Promise,y=new Date(Date.now()+i.signatureSpec.drift);return f["x-amz-date"]=y.toUTCString(),m&&(f[Uploader.s3.util.SESSION_TOKEN_PARAM_NAME]=m),function(e,t,r){var o,a,u,d=new Uploader.Promise,c="POST",p=[],h="",f=new Date,g=function(e){var r,n=[];return Uploader.each(e.headers,function(e){p.push(e)}),p.sort(),Uploader.each(p,function(t,o){Uploader.indexOf(Uploader.s3.util.UNSIGNABLE_REST_HEADER_NAMES,o)<0?h+=o.toLowerCase()+":"+e.headers[o].trim()+"\n":"Content-MD5"===o?r=e.headers[o]:n.unshift(t)}),Uploader.each(n,function(e,t){p.splice(t,1)}),a={bucket:e.bucket,contentMd5:r,contentType:e.contentType,date:f,drift:i.signatureSpec.drift,endOfUrl:o,hashedContent:e.hashedContent,headerNames:p,headersStr:h,method:c},u=2===t?s.getStringToSign(a):l.getStringToSign(a),{date:f,endOfUrl:o,signedHeaders:4===t?l.getSignedHeaders(a.headerNames):null,toSign:4===t?u.hashed:u,toSignRaw:4===t?u.raw:u}};switch(r.type){case n.REQUEST_TYPE.MULTIPART_ABORT:c="DELETE",o=Uploader.format("uploadId={}",r.uploadId);break;case n.REQUEST_TYPE.MULTIPART_INITIATE:o="uploads";break;case n.REQUEST_TYPE.MULTIPART_COMPLETE:o=Uploader.format("uploadId={}",r.uploadId);break;case n.REQUEST_TYPE.MULTIPART_UPLOAD:c="PUT",o=Uploader.format("partNumber={}&uploadId={}",r.partNum,r.uploadId)}return o=r.key+"?"+o,4===t?l.getEncodedHashedPayload(r.content).then(function(e){r.headers["x-amz-content-sha256"]=e,r.headers.Host=r.host,r.headers["x-amz-date"]=Uploader.s3.util.getV4PolicyDate(f,i.signatureSpec.drift),r.hashedContent=e,d.success(g(r))},function(e){d.failure(e)}):d.success(g(r)),d}(0,i.signatureSpec.version,{bucket:t,content:d,contentType:c,headers:f,host:o,key:a,partNum:p,type:e,uploadId:u}).then(function(e){h=e,U.success({headers:(c&&(f["Content-Type"]=c),delete f.Host,f),date:h.date,endOfUrl:h.endOfUrl,signedHeaders:h.signedHeaders,stringToSign:h.toSign,stringToSignRaw:h.toSignRaw})},function(e){U.failure(e)}),U},getHeaders:function(){return Uploader.extend({},f)},getEndOfUrl:function(){return h&&h.endOfUrl},getRequestDate:function(){return h&&h.date},getSignedHeaders:function(){return h&&h.signedHeaders}}}})},Uploader.s3.RequestSigner.prototype.REQUEST_TYPE={MULTIPART_INITIATE:"multipart_initiate",MULTIPART_COMPLETE:"multipart_complete",MULTIPART_ABORT:"multipart_abort",MULTIPART_UPLOAD:"multipart_upload"},Uploader.UploadSuccessAjaxRequester=function(e){"use strict";var t,r=[],n={method:"POST",endpoint:null,maxConnections:3,customHeaders:{},paramsStore:{},cors:{expected:!1,sendCredentials:!1},log:function(e,t){}};Uploader.extend(n,e),t=Uploader.extend(this,new Uploader.AjaxRequester({acceptHeader:"application/json",method:n.method,endpointStore:{get:function(){return n.endpoint}},paramsStore:n.paramsStore,maxConnections:n.maxConnections,customHeaders:n.customHeaders,log:n.log,onComplete:function(e,t,o){var i,a=r[e],s=t.responseText,l={success:!0},u={success:!1};delete r[e],n.log(Uploader.format("Received the following response body to an upload success request for id {}: {}",e,s));try{i=Uploader.parseJson(s),o||i&&(i.error||!1===i.success)?(n.log("Upload success request was rejected by the server.","error"),a.failure(Uploader.extend(i,u))):(n.log("Upload success was acknowledged by the server."),a.success(Uploader.extend(i,l)))}catch(t){o?(n.log(Uploader.format("Your server indicated failure in its upload success request response for id {}!",e),"error"),a.failure(u)):(n.log("Upload success was acknowledged by the server."),a.success(l))}},cors:n.cors})),Uploader.extend(this,{sendSuccessRequest:function(e,o){var i=new Uploader.Promise;return n.log("Submitting upload success request/notification for "+e),t.initTransport(e).withParams(o).send(),r[e]=i,i}})},Uploader.s3.InitiateMultipartAjaxRequester=function(e){"use strict";var t,r,n={},o={filenameParam:"qqfilename",method:"POST",endpointStore:null,paramsStore:null,signatureSpec:null,aclStore:null,reducedRedundancy:!1,serverSideEncryption:!1,maxConnections:3,getContentType:function(e){},getBucket:function(e){},getHost:function(e){},getKey:function(e){},getName:function(e){},log:function(e,t){}};Uploader.extend(o,e),r=new Uploader.s3.RequestSigner({endpointStore:o.endpointStore,signatureSpec:o.signatureSpec,cors:o.cors,log:o.log}),t=Uploader.extend(this,new Uploader.AjaxRequester({method:o.method,contentType:null,endpointStore:o.endpointStore,maxConnections:o.maxConnections,allowXRequestedWithAndCacheControl:!1,log:o.log,onComplete:function(e,t,r){var i,a,s,l,u,d=n[e],c=(new DOMParser).parseFromString(t.responseText,"application/xml");delete n[e],r?(u=t.status,(a=c.getElementsByTagName("Message")).length>0&&(l=a[0].textContent)):(i=c.getElementsByTagName("UploadId")).length>0?s=i[0].textContent:l="Upload ID missing from request",void 0===s?(l?o.log(Uploader.format("Specific problem detected initiating multipart upload request for {}: '{}'.",e,l),"error"):o.log(Uploader.format("Unexplained error with initiate multipart upload request for {}.  Status code {}.",e,u),"error"),d.failure("Problem initiating upload request.",t)):(o.log(Uploader.format("Initiate multipart upload request successful for {}.  Upload ID is {}",e,s)),d.success(s,t))},successfulResponseCodes:{POST:[200]}})),Uploader.extend(this,{send:function(e){var i,a,s,l,u,d,c,p=new Uploader.Promise;return(i=e,s=o.getBucket(i),l=o.getHost(i),u={},d=new Uploader.Promise,c=o.getKey(i),u["x-amz-acl"]=o.aclStore.get(i),o.reducedRedundancy&&(u[Uploader.s3.util.REDUCED_REDUNDANCY_PARAM_NAME]=Uploader.s3.util.REDUCED_REDUNDANCY_PARAM_VALUE),o.serverSideEncryption&&(u[Uploader.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_NAME]=Uploader.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_VALUE),u[Uploader.s3.util.AWS_PARAM_PREFIX+o.filenameParam]=encodeURIComponent(o.getName(i)),Uploader.each(o.paramsStore.get(i),function(e,t){Uploader.indexOf(Uploader.s3.util.UNPREFIXED_PARAM_NAMES,e)>=0?u[e]=t:u[Uploader.s3.util.AWS_PARAM_PREFIX+e]=encodeURIComponent(t)}),a=r.constructStringToSign(r.REQUEST_TYPE.MULTIPART_INITIATE,s,l,c).withContentType(o.getContentType(i)).withHeaders(u),r.getSignature(i,{signatureConstructor:a}).then(d.success,d.failure),d).then(function(r,i){o.log("Submitting S3 initiate multipart upload request for "+e),n[e]=p,t.initTransport(e).withPath(i).withHeaders(r).send()},p.failure),p}})},Uploader.s3.CompleteMultipartAjaxRequester=function(e){"use strict";var t,r,n={},o={method:"POST",contentType:"text/xml",endpointStore:null,signatureSpec:null,maxConnections:3,getBucket:function(e){},getHost:function(e){},getKey:function(e){},log:function(e,t){}};Uploader.extend(o,e),r=new Uploader.s3.RequestSigner({endpointStore:o.endpointStore,signatureSpec:o.signatureSpec,cors:o.cors,log:o.log}),t=Uploader.extend(this,new Uploader.AjaxRequester({method:o.method,contentType:"application/xml; charset=UTF-8",endpointStore:o.endpointStore,maxConnections:o.maxConnections,allowXRequestedWithAndCacheControl:!1,log:o.log,onComplete:function(e,t,r){var i=n[e],a=new DOMParser,s=o.getBucket(e),l=(o.getKey(e),a.parseFromString(t.responseText,"application/xml")),u=l.getElementsByTagName("Bucket"),d=l.getElementsByTagName("Key");delete n[e],o.log(Uploader.format("Complete response status {}, body = {}",t.status,t.responseText)),r?o.log(Uploader.format("Complete Multipart Upload request for {} failed with status {}.",e,t.status),"error"):u.length&&d.length?u[0].textContent!==s&&(r=!0,o.log(Uploader.format("Wrong bucket in response to Complete Multipart Upload request for {}.",e),"error")):(r=!0,o.log(Uploader.format("Missing bucket and/or key in response to Complete Multipart Upload request for {}.",e),"error")),r?i.failure("Problem combining the file parts!",t):i.success({},t)},successfulResponseCodes:{POST:[200]}})),Uploader.extend(this,{send:function(e,i,a){var s,l,u,d,c,p,h,f,g,m=new Uploader.Promise,U=(s=a,l=document.implementation.createDocument(null,"CompleteMultipartUpload",null),s.sort(function(e,t){return e.part-t.part}),Uploader.each(s,function(e,t){var r=t.part,n=t.etag,o=l.createElement("Part"),i=l.createElement("PartNumber"),a=l.createTextNode(r),s=l.createTextNode(n),u=l.createElement("ETag");u.appendChild(s),i.appendChild(a),o.appendChild(i),o.appendChild(u),Uploader(l).children()[0].appendChild(o)}),(new XMLSerializer).serializeToString(l));return(u=e,d=i,c=U,p=new Uploader.Promise,h=o.getBucket(u),f=o.getHost(u),g=r.constructStringToSign(r.REQUEST_TYPE.MULTIPART_COMPLETE,h,f,o.getKey(u)).withUploadId(d).withContent(c).withContentType("application/xml; charset=UTF-8"),r.getSignature(u,{signatureConstructor:g}).then(p.success,p.failure),p).then(function(r,i){o.log("Submitting S3 complete multipart upload request for "+e),n[e]=m,delete r["Content-Type"],t.initTransport(e).withPath(i).withHeaders(r).withPayload(U).send()},m.failure),m}})},Uploader.s3.AbortMultipartAjaxRequester=function(e){"use strict";var t,r,n={method:"DELETE",endpointStore:null,signatureSpec:null,maxConnections:3,getBucket:function(e){},getHost:function(e){},getKey:function(e){},log:function(e,t){}};Uploader.extend(n,e),r=new Uploader.s3.RequestSigner({endpointStore:n.endpointStore,signatureSpec:n.signatureSpec,cors:n.cors,log:n.log}),t=Uploader.extend(this,new Uploader.AjaxRequester({validMethods:["DELETE"],method:n.method,contentType:null,endpointStore:n.endpointStore,maxConnections:n.maxConnections,allowXRequestedWithAndCacheControl:!1,log:n.log,onComplete:function(e,t,r){var o,i=(new DOMParser).parseFromString(t.responseText,"application/xml"),a=i.getElementsByTagName("Error");n.log(Uploader.format("Abort response status {}, body = {}",t.status,t.responseText)),r?n.log(Uploader.format("Abort Multipart Upload request for {} failed with status {}.",e,t.status),"error"):a.length?(r=!0,o=i.getElementsByTagName("Message")[0].textContent,n.log(Uploader.format("Failed to Abort Multipart Upload request for {}.  Error: {}",e,o),"error")):n.log(Uploader.format("Abort MPU request succeeded for file ID {}.",e))},successfulResponseCodes:{DELETE:[204]}})),Uploader.extend(this,{send:function(e,o){var i,a,s,l,u,d;(i=e,a=o,s=new Uploader.Promise,l=n.getBucket(i),u=n.getHost(i),d=r.constructStringToSign(r.REQUEST_TYPE.MULTIPART_ABORT,l,u,n.getKey(i)).withUploadId(a),r.getSignature(i,{signatureConstructor:d}).then(s.success,s.failure),s).then(function(r,o){n.log("Submitting S3 Abort multipart upload request for "+e),t.initTransport(e).withPath(o).withHeaders(r).send()})}})},Uploader.s3.XhrUploadHandler=function(e,t){"use strict";var r=t.getName,n=t.log,o=e.clockDrift,i=e.getBucket,a=e.getHost,s=e.getKeyName,l=e.filenameParam,u=e.paramsStore,d=e.endpointStore,c=e.aclStore,p=e.objectProperties.reducedRedundancy,h=e.objectProperties.region,f=e.objectProperties.serverSideEncryption,g=e.validation,m=Uploader.extend({region:h,drift:o},e.signature),U=this,y=e.signature.credentialsProvider,v={combine:function(e){var t=U._getPersistableData(e).uploadId,r=U._getPersistableData(e).etags,n=new Uploader.Promise;return S.completeMultipart.send(e,t,r).then(n.success,function(t,r){n.failure(b.done(e,r).response,r)}),n},done:function(e,t,r){var n;b.response.parse(e,t).success&&(n=t.getResponseHeader("ETag"),U._getPersistableData(e).etags||(U._getPersistableData(e).etags=[]),U._getPersistableData(e).etags.push({part:r+1,etag:n}))},initHeaders:function(e,t,r){var n=b.bucket.getName(e),o=b.host.getName(e),i=b.key.urlSafe(e),a=new Uploader.Promise,s=S.restSignature.constructStringToSign(S.restSignature.REQUEST_TYPE.MULTIPART_UPLOAD,n,o,i).withPartNum(t+1).withContent(r).withUploadId(U._getPersistableData(e).uploadId);return S.restSignature.getSignature(e+"."+t,{signatureConstructor:s}).then(a.success,a.failure),a},put:function(t,r){var o=U._createXhr(t,r),i=U._getChunkData(t,r),a=e.endpointStore.get(t),s=new Uploader.Promise;return v.initHeaders(t,r,i.blob).then(function(e,l){if(o._cancelled)n(Uploader.format("Upload of item {}.{} cancelled. Upload will not start after successful signature request.",t,r)),s.failure({error:"Chunk upload cancelled"});else{var u=a+"/"+l;U._registerProgressHandler(t,r,i.size),b.track(t,o,r).then(s.success,s.failure),o.open("PUT",u,!0);var d=!1;Uploader.each(e,function(e,t){"Content-Type"===e&&(d=!0),o.setRequestHeader(e,t)}),d||o.setRequestHeader("Content-Type",""),o.send(i.blob)}},function(){s.failure({error:"Problem signing the chunk!"},o)}),s},send:function(e,t){var r=new Uploader.Promise;return v.setup(e).then(function(){v.put(e,t).then(r.success,r.failure)},function(e,t){r.failure({error:e},t)}),r},setup:function(e){var t=new Uploader.Promise,r=U._getPersistableData(e).uploadId,n=new Uploader.Promise;return r?r instanceof Uploader.Promise?r.then(function(e){t.success(e)}):t.success(r):(U._getPersistableData(e).uploadId=n,S.initiateMultipart.send(e).then(function(r){U._getPersistableData(e).uploadId=r,n.success(r),t.success(r)},function(r,o){U._getPersistableData(e).uploadId=null,t.failure(r,o),n.failure(r,o)})),t}},S={abortMultipart:new Uploader.s3.AbortMultipartAjaxRequester({endpointStore:d,signatureSpec:m,cors:e.cors,log:n,getBucket:function(e){return b.bucket.getName(e)},getHost:function(e){return b.host.getName(e)},getKey:function(e){return b.key.urlSafe(e)}}),completeMultipart:new Uploader.s3.CompleteMultipartAjaxRequester({endpointStore:d,signatureSpec:m,cors:e.cors,log:n,getBucket:function(e){return b.bucket.getName(e)},getHost:function(e){return b.host.getName(e)},getKey:function(e){return b.key.urlSafe(e)}}),initiateMultipart:new Uploader.s3.InitiateMultipartAjaxRequester({filenameParam:l,endpointStore:d,paramsStore:u,signatureSpec:m,aclStore:c,reducedRedundancy:p,serverSideEncryption:f,cors:e.cors,log:n,getContentType:function(e){return U._getMimeType(e)},getBucket:function(e){return b.bucket.getName(e)},getHost:function(e){return b.host.getName(e)},getKey:function(e){return b.key.urlSafe(e)},getName:function(e){return r(e)}}),policySignature:new Uploader.s3.RequestSigner({expectingPolicy:!0,signatureSpec:m,cors:e.cors,log:n}),restSignature:new Uploader.s3.RequestSigner({endpointStore:d,signatureSpec:m,cors:e.cors,log:n})},_={initParams:function(e){var t=u.get(e);return t[l]=r(e),Uploader.s3.util.generateAwsParams({endpoint:d.get(e),clockDrift:o,params:t,type:U._getMimeType(e),bucket:b.bucket.getName(e),key:U.getThirdPartyFileId(e),accessKey:y.get().accessKey,sessionToken:y.get().sessionToken,acl:c.get(e),expectedStatus:200,minFileSize:g.minSizeLimit,maxFileSize:g.maxSizeLimit,reducedRedundancy:p,region:h,serverSideEncryption:f,signatureVersion:m.version,log:n},Uploader.bind(S.policySignature.getSignature,this,e))},send:function(e){var t=new Uploader.Promise,r=U._createXhr(e),o=U.getFile(e);return U._registerProgressHandler(e),b.track(e,r).then(t.success,t.failure),_.setup(e,r,o).then(function(t){n("Sending upload request for "+e),r.send(t)},t.failure),t},setup:function(e,t,r){var n=new FormData,o=d.get(e),i=new Uploader.Promise;return _.initParams(e).then(function(e){t.open("POST",o,!0),Uploader.obj2FormData(e,n),n.append("file",r),i.success(n)},function(e){i.failure({error:e})}),i}},b={bucket:{promise:function(e){var t=new Uploader.Promise,r=U._getFileState(e).bucket;return r?t.success(r):i(e).then(function(r){U._getFileState(e).bucket=r,t.success(r)},t.failure),t},getName:function(e){return U._getFileState(e).bucket}},host:{promise:function(e){var t=new Uploader.Promise,r=U._getFileState(e).host;return r?t.success(r):a(e).then(function(r){U._getFileState(e).host=r,t.success(r)},t.failure),t},getName:function(e){return U._getFileState(e).host}},done:function(e,t){var r=b.response.parse(e,t),o=!0!==r.success;return o&&b.response.shouldReset(r.code)&&(n("This is an unrecoverable error, we must restart the upload entirely on the next retry attempt.","error"),r.reset=!0),{success:!o,response:r}},key:{promise:function(e){var t=new Uploader.Promise,n=U.getThirdPartyFileId(e);return null==n?(U._setThirdPartyFileId(e,t),s(e,r(e)).then(function(r){U._setThirdPartyFileId(e,r),t.success(r)},function(r){U._setThirdPartyFileId(e,null),t.failure(r)})):Uploader.isGenericPromise(n)?n.then(t.success,t.failure):t.success(n),t},urlSafe:function(e){var t=U.getThirdPartyFileId(e);return Uploader.s3.util.uriEscapePath(t)}},response:{parse:function(e,t){var r,o={};try{n(Uploader.format("Received response status {} with body: {}",t.status,t.responseText)),200===t.status?o.success=!0:(r=b.response.parseError(t.responseText))&&(o.error=r.message,o.code=r.code)}catch(e){n("Error when attempting to parse xhr response text ("+e.message+")","error")}return o},parseError:function(e){var t,r,n=(new DOMParser).parseFromString(e,"application/xml"),o={};if(n.getElementsByTagName("Error").length)return t=n.getElementsByTagName("Code"),(r=n.getElementsByTagName("Message")).length&&(o.message=r[0].textContent),t.length&&(o.code=t[0].textContent),o},shouldReset:function(e){return"EntityTooSmall"===e||"InvalidPart"===e||"InvalidPartOrder"===e||"NoSuchUpload"===e}},start:function(e,t){var r=new Uploader.Promise;return b.key.promise(e).then(function(){b.bucket.promise(e).then(function(){b.host.promise(e).then(function(){null==t?_.send(e).then(r.success,r.failure):v.send(e,t).then(r.success,r.failure)})})},function(e){r.failure({error:e})}),r},track:function(e,t,r){var n=new Uploader.Promise;return t.onreadystatechange=function(){var o;4===t.readyState&&(null==r?(o=b.done(e,t),n[o.success?"success":"failure"](o.response,t)):(v.done(e,t,r),o=b.done(e,t),n[o.success?"success":"failure"](o.response,t)))},n}};Uploader.extend(this,{uploadChunk:b.start,uploadFile:b.start}),Uploader.extend(this,new Uploader.XhrUploadHandler({options:Uploader.extend({namespace:"s3"},e),proxy:Uploader.extend({getEndpoint:e.endpointStore.get},t)})),Uploader.override(this,function(e){return{expunge:function(t){var r=U._getPersistableData(t)&&U._getPersistableData(t).uploadId,n=U._maybeDeletePersistedChunkData(t);void 0!==r&&n&&S.abortMultipart.send(t,r),e.expunge(t)},finalizeChunks:function(e){return v.combine(e)},_getLocalStorageId:function(t){return e._getLocalStorageId(t)+"-"+b.bucket.getName(t)}}})},Uploader.s3.FormUploadHandler=function(e,t){"use strict";var r=this,n=e.clockDrift,o=t.onUuidChanged,i=t.getName,a=t.getUuid,s=t.log,l=e.getBucket,u=e.getKeyName,d=e.filenameParam,c=e.paramsStore,p=e.endpointStore,h=e.aclStore,f=e.objectProperties.reducedRedundancy,g=e.objectProperties.region,m=e.objectProperties.serverSideEncryption,U=e.validation,y=e.signature,v=e.iframeSupport.localBlankPagePath,S=e.signature.credentialsProvider,_=new Uploader.s3.RequestSigner({signatureSpec:y,cors:e.cors,log:s});if(void 0===v)throw new Error("successRedirectEndpoint MUST be defined if you intend to use browsers that do not support the File API!");function b(t,o){var a=new Uploader.Promise,l=e.endpointStore.get(t);i(t);return function(e){var t=c.get(e);return t[d]=i(e),Uploader.s3.util.generateAwsParams({endpoint:p.get(e),clockDrift:n,params:t,bucket:r._getFileState(e).bucket,key:r.getThirdPartyFileId(e),accessKey:S.get().accessKey,sessionToken:S.get().sessionToken,acl:h.get(e),minFileSize:U.minSizeLimit,maxFileSize:U.maxSizeLimit,successRedirectUrl:v,reducedRedundancy:f,region:g,serverSideEncryption:m,signatureVersion:y.version,log:s},Uploader.bind(_.getSignature,this,e))}(t).then(function(e){var t=r._initFormForUpload({method:"POST",endpoint:l,params:e,paramsInBody:!0,targetName:o.name});a.success(t)},function(e){a.failure(e),C(t,o)}),a}function w(t){var n=r._createIframe(t),o=r.getInput(t),i=new Uploader.Promise;return b(t,n).then(function(a){a.appendChild(o),r._attachLoadEvent(n,function(o){s("iframe loaded"),o?!1===o.success&&(s("Amazon likely rejected the upload request","error"),i.failure(o)):((o={}).success=function(t,n){e.endpointStore.get(t);var o,i=r._getFileState(t).bucket;try{if((n.contentDocument||n.contentWindow.document).body.innerHTML,(o=Uploader.s3.util.parseIframeResponse(n)).bucket===i&&o.key===Uploader.s3.util.encodeQueryStringParam(r.getThirdPartyFileId(t)))return!0;s("Response from AWS included an unexpected bucket or key name.","error")}catch(e){s("Error when attempting to parse form upload response ("+e.message+")","error")}return!1}(t,n),!1===o.success?(s("A success response was received by Amazon, but it was invalid in some way.","error"),i.failure(o)):(Uploader.extend(o,Uploader.s3.util.parseIframeResponse(n)),i.success(o))),C(t,n)}),s("Sending upload request for "+t),a.submit(),Uploader(a).remove()},i.failure),i}function C(e,t){r._detachLoadEvent(e),t&&Uploader(t).remove()}Uploader.extend(this,new Uploader.FormUploadHandler({options:{isCors:!1,inputName:"file"},proxy:{onCancel:e.onCancel,onUuidChanged:o,getName:i,getUuid:a,log:s}})),Uploader.extend(this,{uploadFile:function(e){var t=i(e),n=new Uploader.Promise;return r.getThirdPartyFileId(e)?r._getFileState(e).bucket?w(e).then(n.success,n.failure):l(e).then(function(t){r._getFileState(e).bucket=t,w(e).then(n.success,n.failure)}):u(e,t).then(function(t){l(e).then(function(o){r._getFileState(e).bucket=o,r._setThirdPartyFileId(e,t),w(e).then(n.success,n.failure)},function(e){n.failure({error:e})})},function(e){n.failure({error:e})}),n}})},function(){"use strict";var e,t,r,n=new Date("2060-10-22"),o=2,i=4,a=5,s=10,l=20,u=30,d=[i,u],c=[0,o,s],p=["maxConcurrentParts","logging","cloudfront","encodeFilename","computeContentMd5","allowS3ExistenceOptimization","onlyRetryForSameFileName","timeUrl","cryptoMd5Method","cryptoHexEncodedHash256","awsRegion","awsSignatureVersion","evaporateChanged"],h={33:"%21",39:"%27",40:"%28",41:"%29",42:"%2A"},f=function(n){if(this.config=R({readableStreams:!1,readableStreamPartMethod:null,bucket:null,logging:!1,maxConcurrentParts:5,partSize:6291456,retryBackoffPower:2,maxRetryBackoffSecs:300,progressIntervalMS:1e3,cloudfront:!1,s3Acceleration:!1,mockLocalStorage:!1,encodeFilename:!0,computeContentMd5:!0,allowS3ExistenceOptimization:!1,onlyRetryForSameFileName:!1,timeUrl:null,cryptoMd5Method:function(e){var t=forge.md.md5.create();return t.update(e),forge.util.encode64(t.digest())},cryptoHexEncodedHash256:function(e){var t=forge.md.sha256.create();return t.update(e),t.digest().toHex()},aws_key:null,awsRegion:"us-west-1",awsSignatureVersion:"4",sendCanonicalRequestToSignerUrl:!1,s3FileCacheHoursAgo:null,signParams:{},signHeaders:{},customAuthMethod:void 0,maxFileSize:null,signResponseHandler:null,xhrWithCredentials:!1,localTimeOffset:void 0,evaporateChanged:function(){},abortCompletionThrottlingMs:1e3},n),"undefined"!=typeof window&&window.console&&((t=window.console).d=t.log,t.w=window.console.warn?t.warn:t.d,t.e=window.console.error?t.error:t.d),this._instantiationError=this.validateEvaporateOptions(),"string"!=typeof this._instantiationError){delete this._instantiationError,this.config.logging||(t={d:function(){},w:function(){},e:function(){}});var o=new Date;if(e=new Date(o.setHours(o.getHours()-(this.config.s3FileCacheHoursAgo||-100))),"number"==typeof n.localTimeOffset)this.localTimeOffset=n.localTimeOffset;else{var i=this;f.getLocalTimeOffset(this.config).then(function(e){i.localTimeOffset=e})}this.pendingFiles={},this.queuedFiles=[],this.filesInProcess=[],r=new D(this.config.mockLocalStorage)}else this.supported=!1};function g(e,t,r){this.fileTotalBytesUploaded=0,this.s3Parts=[],this.partsOnS3=[],this.partsInProcess=[],this.partsToUpload=[],this.numParts=-1,this.con=R({},t),this.evaporate=r,this.localTimeOffset=r.localTimeOffset,this.deferredCompletion=E(),R(this,e),this.id=decodeURIComponent(this.con.bucket+"/"+this.name),this.signParams=t.signParams}function m(e,t){this.fileUpload=e,this.con=e.con,this.attempts=1,this.localTimeOffset=this.fileUpload.localTimeOffset,this.awsDeferred=E(),this.started=E(),this.awsUrl=function(e){var t;e.aws_url?t=[e.aws_url]:(e.s3Acceleration?(t=["https://",e.bucket,".s3-accelerate"],e.cloudfront=!0):(t=["https://",e.cloudfront?e.bucket+".":"","s3"],"us-east-1"!==e.awsRegion&&t.push("-",e.awsRegion)),t.push(".amazonaws.com"));return t.join("")}(this.con),this.awsHost=x(this.awsUrl).hostname;var r=R({},t);e.contentType&&(r.contentType=e.contentType),this.updateRequest(r)}function U(e,t){m.call(this,e,t)}function y(e,t,r){r>-1&&(this.maxRetries=r),m.call(this,e,t)}function v(e,t){var r={method:"POST",path:"?uploads",step:"initiate",x_amz_headers:e.xAmzHeadersAtInitiate,not_signed_headers:e.notSignedHeadersAtInitiate,response_match:"<UploadId>(.+)</UploadId>"};U.call(this,e,r),this.awsKey=t}function S(e){e.info("will attempt to complete upload");var t={method:"POST",contentType:"application/xml; charset=UTF-8",path:"?uploadId="+e.uploadId,x_amz_headers:e.xAmzHeadersCommon||e.xAmzHeadersAtComplete,step:"complete"};U.call(this,e,t)}function _(e,t){this.awsKey=t,e.info("will attempt to verify existence of the file");var r={method:"HEAD",path:"",x_amz_headers:e.xAmzHeadersCommon,success404:!0,step:"head_object"};y.call(this,e,r)}function b(e){y.call(this,e),this.updateRequest(this.setupRequest(0))}function w(e,t){this.part=t,this.partNumber=t.partNumber,this.start=(this.partNumber-1)*e.con.partSize,this.end=Math.min(this.partNumber*e.con.partSize,e.sizeBytes);var r={method:"PUT",path:"?partNumber="+this.partNumber+"&uploadId="+e.uploadId,step:"upload #"+this.partNumber,x_amz_headers:e.xAmzHeadersCommon||e.xAmzHeadersAtUpload,contentSha256:"UNSIGNED-PAYLOAD",onProgress:this.onProgress.bind(this)};m.call(this,e,r)}function C(e){e.info("will attempt to abort the upload"),e.abortParts();var t={method:"DELETE",path:"?uploadId="+e.uploadId,x_amz_headers:e.xAmzHeadersCommon,success404:!0,step:"abort"};m.call(this,e,t)}function x(e){var t,r=e||"/";try{t=new URL(r)}catch(e){(t=document.createElement("a")).href=r}return{protocol:t.protocol,hostname:t.hostname,pathname:t.pathname.replace(/(^\/?)/,"/"),port:t.port,search:"?"===t.search[0]?t.search.substr(1):t.search,hash:t.hash,host:t.host}}function P(e){return e?new Date(e).toISOString():""}function A(e){var t=I(e.responseText,"Code"),r=I(e.responseText,"Message");return t.length?["AWS Code: ",t,", Message:",r].join(""):""}function I(e,t){var r=e.match(["<",t,">(.+)</",t,">"].join(""));return r?r[1]:""}function E(){var e,t={};return e=new Promise(function(e,r){t={resolve:e,reject:r}}),{resolve:t.resolve,reject:t.reject,promise:e}}function R(e,t,r){function n(e,t){if("object"==typeof t)for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])}return e=e||{},n(t=t||{},r=r||{}),n(e,t),e}function T(t){var o=JSON.parse(r.getItem("awsUploads")||"{}");if(t){for(var i in o)if(o.hasOwnProperty(i)){var a=o[i];new Date(a.completedAt||n)<e&&delete o[i]}r.setItem("awsUploads",JSON.stringify(o))}return o}function B(e){return[e.file.name,e.file.type,P(e.file.lastModified),e.sizeBytes].join("-")}function F(e,t){var n=T();n[e]=t,r.setItem("awsUploads",JSON.stringify(n))}function k(e,t){var r=e.indexOf(t);if(r>-1)return e.splice(r,1),!0}function D(e){var t=D.supported();this.cacheStore=e?{}:t?localStorage:void 0}f.create=function(e){var t=R({},e);return f.getLocalTimeOffset(t).then(function(e){return t.localTimeOffset=e,new Promise(function(e,r){var n=new f(t);!0===n.supported?e(n):r(n._instantiationError)})})},f.getLocalTimeOffset=function(e){return new Promise(function(r,n){if("number"==typeof e.localTimeOffset)return r(e.localTimeOffset);if(e.timeUrl){var o=new XMLHttpRequest;o.open("GET",e.timeUrl+"?requestTime="+(new Date).getTime()),o.onreadystatechange=function(){if(4===o.readyState&&200===o.status){var e=new Date(Date.parse(o.responseText))-new Date;t.d("localTimeOffset is",e,"ms"),r(e)}},o.onerror=function(e){t.e("xhr error timeUrl",e),n("Fetching offset time failed with status: "+e.status)},o.send()}else r(0)})},f.prototype.config={},f.prototype.localTimeOffset=0,f.prototype.supported=!1,f.prototype._instantiationError=void 0,f.prototype.evaporatingCount=0,f.prototype.pendingFiles={},f.prototype.filesInProcess=[],f.prototype.queuedFiles=[],f.prototype.startNextFile=function(e){if(this.queuedFiles.length&&!(this.evaporatingCount>=this.config.maxConcurrentParts)){var r=this.queuedFiles.shift();0===r.status?(t.d("Starting",decodeURIComponent(r.name),"reason:",e),this.evaporatingCnt(1),r.start()):(t.d("Requeued",decodeURIComponent(r.name),"status:",r.status,"reason:",e),this.queuedFiles.push(r))}},f.prototype.fileCleanup=function(e){k(this.queuedFiles,e),k(this.filesInProcess,e)&&this.evaporatingCnt(-1),e.done(),this.consumeRemainingSlots()},f.prototype.queueFile=function(e){this.filesInProcess.push(e),this.queuedFiles.push(e),1===this.filesInProcess.length&&this.startNextFile("first file")},f.prototype.add=function(e,t){var r,n=this;return new Promise(function(o,i){var a,s,l,u=R(t,{});if(p.forEach(function(e){delete u[e]}),r=R(n.config,u),void 0===e||void 0===e.file)return i("Missing file");if(r.maxFileSize&&e.file.size>r.maxFileSize)return i("File size too large. Maximum size allowed is "+r.maxFileSize);if(void 0===e.name)return i("Missing attribute: name");r.encodeFilename&&(e.name=(a=e.name,s=a.split("/"),l=[],s.forEach(function(e){for(var t=[],r=encodeURIComponent(e),n=0;n<r.length;n++)t.push(h[r.charCodeAt(n)]||r.charAt(n));l.push(t.join(""))}),l.join("/")));var d=new g(R({started:function(){},uploadInitiated:function(){},progress:function(){},complete:function(){},cancelled:function(){},paused:function(){},resumed:function(){},pausing:function(){},nameChanged:function(){},info:function(){},warn:function(){},error:function(){},beforeSigner:void 0,xAmzHeadersAtInitiate:{},notSignedHeadersAtInitiate:{},xAmzHeadersCommon:null,xAmzHeadersAtUpload:{},xAmzHeadersAtComplete:{}},e,{status:0,priority:0,loadedBytes:0,sizeBytes:e.file.size,eTag:""}),r,n),c=d.id;n.pendingFiles[c]=d,n.queueFile(d),d.deferredCompletion.promise.then(function(){n.fileCleanup(d),o(decodeURIComponent(d.name))},function(e){n.fileCleanup(d),i(e)})})},f.prototype.cancel=function(e){return void 0===e?this._cancelAll():this._cancelOne(e)},f.prototype._cancelAll=function(){t.d("Canceling all file uploads");var e=[];for(var r in this.pendingFiles)if(this.pendingFiles.hasOwnProperty(r)){var n=this.pendingFiles[r];c.indexOf(n.status)>-1&&e.push(n.stop())}return e.length||e.push(Promise.reject("No files to cancel.")),Promise.all(e)},f.prototype._cancelOne=function(e){var t=[];return this.pendingFiles[e]?t.push(this.pendingFiles[e].stop()):t.push(Promise.reject("File does not exist")),Promise.all(t)},f.prototype.pause=function(e,t){var r=void 0!==(t=t||{}).force&&t.force;return void 0===e?this._pauseAll(r):this._pauseOne(e,r)},f.prototype._pauseAll=function(e){t.d("Pausing all file uploads");var r=[];for(var n in this.pendingFiles)if(this.pendingFiles.hasOwnProperty(n)){var o=this.pendingFiles[n];c.indexOf(o.status)>-1&&this._pause(o,e,r)}return Promise.all(r)},f.prototype._pauseOne=function(e,t){var r=[],n=this.pendingFiles[e];return void 0===n?r.push(Promise.reject("Cannot pause a file that has not been added.")):n.status===i&&r.push(Promise.reject("Cannot pause a file that is already paused.")),r.length||this._pause(n,t,r),Promise.all(r)},f.prototype._pause=function(e,t,r){r.push(e.pause(t)),k(this.filesInProcess,e),k(this.queuedFiles,e)},f.prototype.resume=function(e){return void 0===e?this._resumeAll():this._resumeOne(e)},f.prototype._resumeAll=function(){for(var e in t.d("Resuming all file uploads"),this.pendingFiles)if(this.pendingFiles.hasOwnProperty(e)){var r=this.pendingFiles[e];d.indexOf(r.status)>-1&&this.resumeFile(r)}return Promise.resolve()},f.prototype._resumeOne=function(e){var t=this.pendingFiles[e],r=[];return void 0===t?r.push(Promise.reject("Cannot pause a file that does not exist.")):-1===d.indexOf(t.status)?r.push(Promise.reject("Cannot resume a file that has not been paused.")):this.resumeFile(t),Promise.all(r)},f.prototype.resumeFile=function(e){e.resume(),this.queueFile(e)},f.prototype.forceRetry=function(){},f.prototype.consumeRemainingSlots=function(){var e=this.config.maxConcurrentParts-this.evaporatingCount;if(e)for(var t=0;t<this.filesInProcess.length;t++){var r=this.filesInProcess[t].consumeSlots();if(!(r<0)&&!(e-=r))return}},f.prototype.validateEvaporateOptions=function(){if(this.supported=!("undefined"==typeof File||"undefined"==typeof Promise),!this.supported)return"S3 uploader requires support for File and Promise";if(this.config.readableStreams){if("function"!=typeof this.config.readableStreamPartMethod)return"Option readableStreamPartMethod is required when readableStreams is set."}else if("undefined"==typeof Blob||void 0===(Blob.prototype.webkitSlice||Blob.prototype.mozSlice||Blob.prototype.slice))return"S3 uploader requires support for Blob [webkitSlice || mozSlice || slice]";if(!this.config.signerUrl&&"function"!=typeof this.config.customAuthMethod)return"Option signerUrl is required unless customAuthMethod is present.";if(!this.config.bucket)return"The AWS 'bucket' option must be present.";if(this.config.computeContentMd5){if(this.supported=void 0!==FileReader.prototype.readAsArrayBuffer,!this.supported)return"The browser's FileReader object does not support readAsArrayBuffer";if("function"!=typeof this.config.cryptoMd5Method)return"Option computeContentMd5 has been set but cryptoMd5Method is not defined.";if("4"===this.config.awsSignatureVersion&&"function"!=typeof this.config.cryptoHexEncodedHash256)return"Option awsSignatureVersion is 4 but cryptoHexEncodedHash256 is not defined."}else if("4"===this.config.awsSignatureVersion)return"Option awsSignatureVersion is 4 but computeContentMd5 is not enabled.";return!0},f.prototype.evaporatingCnt=function(e){this.evaporatingCount=Math.max(0,this.evaporatingCount+e),this.config.evaporateChanged(this,this.evaporatingCount)},g.prototype.con=void 0,g.prototype.evaporate=void 0,g.prototype.localTimeOffset=0,g.prototype.id=void 0,g.prototype.status=0,g.prototype.numParts=-1,g.prototype.fileTotalBytesUploaded=0,g.prototype.partsInProcess=[],g.prototype.partsToUpload=[],g.prototype.s3Parts=[],g.prototype.partsOnS3=[],g.prototype.deferredCompletion=void 0,g.prototype.abortedByUser=!1,g.prototype.progressInterval=void 0,g.prototype.startTime=void 0,g.prototype.loaded=0,g.prototype.totalUploaded=0,g.prototype.updateLoaded=function(e){this.loaded+=e,this.fileTotalBytesUploaded+=e},g.prototype.progessStats=function(){if(0===this.fileTotalBytesUploaded)return{speed:0,readableSpeed:"",loaded:0,totalUploaded:0,remainingSize:this.sizeBytes,secondsLeft:-1,fileSize:this.sizeBytes};this.totalUploaded+=this.loaded;var e=(new Date-this.startTime)/1e3,t=this.totalUploaded/e,r=this.sizeBytes-this.fileTotalBytesUploaded,n={speed:t,readableSpeed:function(e){var t=0;for(;e>=1024;)e/=1024,++t;return[e.toFixed(2).replace(".00",""),["B","Kb","Mb","Gb","Tb","Pb","Eb","Zb","Yb"][t]].join(" ")}(t),loaded:this.loaded,totalUploaded:this.fileTotalBytesUploaded,remainingSize:r,secondsLeft:-1,fileSize:this.sizeBytes};return t>0&&(n.secondsLeft=Math.round(r/t)),n},g.prototype.onProgress=function(){-1===[l,i].indexOf(this.status)&&(this.progress(this.fileTotalBytesUploaded/this.sizeBytes,this.progessStats()),this.loaded=0)},g.prototype.startMonitor=function(){clearInterval(this.progressInterval),this.startTime=new Date,this.loaded=0,this.totalUploaded=0,this.onProgress(),this.progressInterval=setInterval(this.onProgress.bind(this),this.con.progressIntervalMS)},g.prototype.stopMonitor=function(){clearInterval(this.progressInterval)},g.prototype.startNextFile=function(e){this.evaporate.startNextFile(e)},g.prototype.evaporatingCnt=function(e){this.evaporate.evaporatingCnt(e)},g.prototype.consumeRemainingSlots=function(){this.evaporate.consumeRemainingSlots()},g.prototype.getRemainingSlots=function(){var e=this.evaporate.evaporatingCount;return!this.partsInProcess.length&&e>0&&(e-=1),this.con.maxConcurrentParts-e},g.prototype.lastPartSatisfied=Promise.resolve("onStart"),g.prototype.start=function(){if(this.status=o,this.startMonitor(),this.started(this.id),this.uploadId)return t.d("resuming FileUpload ",this.id),this.consumeSlots();var e=this.name;this.getUnfinishedFileUpload();var r=this.con.computeContentMd5&&this.con.allowS3ExistenceOptimization&&void 0!==this.firstMd5Digest&&void 0!==this.eTag;if(this.uploadId){if(r)return this.reuseS3Object(e).then(this.deferredCompletion.resolve).catch(this.uploadFileFromScratch.bind(this));this.resumeInterruptedUpload().then(this._uploadComplete.bind(this)).catch(this.uploadFileFromScratch.bind(this))}else this.uploadFileFromScratch("")},g.prototype.uploadFileFromScratch=function(e){if(-1!==c.indexOf(this.status))return t.d(e),this.uploadId=void 0,this.uploadFile(this.name).then(this._uploadComplete.bind(this)).catch(this._abortUpload.bind(this))},g.prototype._uploadComplete=function(){this.completeUpload().then(this.deferredCompletion.resolve)},g.prototype.stop=function(){t.d("stopping FileUpload ",this.id),this.setStatus(a),this.info("Canceling uploads..."),this.abortedByUser=!0;var e=this;return this.abortUpload().then(function(){throw"User aborted the upload"}).catch(function(t){e.deferredCompletion.reject(t)})},g.prototype.pause=function(e){t.d("pausing FileUpload, force:",!!e,this.id);var r=[];return this.info("Pausing uploads..."),this.status=u,e?this.abortParts(!0):(r=this.partsInProcess.map(function(e){return this.s3Parts[e].awsRequest.awsDeferred.promise},this),this.pausing()),Promise.all(r).then(function(){this.stopMonitor(),this.status=i,this.startNextFile("pause"),this.paused()}.bind(this))},g.prototype.resume=function(){this.status=0,this.resumed()},g.prototype.done=function(){clearInterval(this.progressInterval),this.startNextFile("file done"),this.partsOnS3=[],this.s3Parts=[]},g.prototype._startCompleteUpload=function(e){return function(){(e?this.completeUpload():Promise.resolve()).then(this.deferredCompletion.resolve.bind(this))}},g.prototype._abortUpload=function(){if(!this.abortedByUser){var e=this;this.abortUpload().then(function(){e.deferredCompletion.reject("File upload aborted due to a part failing to upload")},this.deferredCompletion.reject.bind(this))}},g.prototype.abortParts=function(e){var t=this;this.partsInProcess.slice(0).forEach(function(r){var n=t.s3Parts[r];n&&(n.awsRequest.abort(),e&&(n.status=0),k(t.partsInProcess,n.partNumber),t.partsToUpload.length&&t.evaporatingCnt(-1))})},g.prototype.makeParts=function(e){this.numParts=Math.ceil(this.sizeBytes/this.con.partSize)||1;var t=[],r=this;function n(e){k(r.partsToUpload,e.partNumber),k(r.partsInProcess,e.partNumber),r.partsToUpload.length&&r.evaporatingCnt(-1)}function o(e){return function(){n(e),r.partsToUpload.length&&r.consumeRemainingSlots(),r.partsToUpload.length<r.con.maxConcurrentParts&&r.startNextFile("part resolve")}}function i(e){return function(){n(e)}}for(var a=e?1:this.numParts,s=1;s<=a;s++){var l=this.s3Parts[s];if(void 0!==l){if(3===l.status)continue}else l=this.makePart(s,0,this.sizeBytes);l.awsRequest=new w(this,l),l.awsRequest.awsDeferred.promise.then(o(l),i(l)),this.partsToUpload.push(s),t.push(this.s3Parts[s].awsRequest.awsDeferred.promise)}return t},g.prototype.makePart=function(e,t,r){var n={status:t,loadedBytes:0,loadedBytesPrevious:null,isEmpty:0===r,md5_digest:null,partNumber:e};return this.s3Parts[e]=n,n},g.prototype.setStatus=function(e){this.status=e},g.prototype.createUploadFile=function(){this.status!==l&&F(B(this),{awsKey:this.name,bucket:this.con.bucket,uploadId:this.uploadId,fileSize:this.sizeBytes,fileType:this.file.type,lastModifiedDate:P(this.file.lastModified),partSize:this.con.partSize,signParams:this.con.signParams,createdAt:(new Date).toISOString()})},g.prototype.updateUploadFile=function(e){var t=B(this);F(t,R({},T()[t],e))},g.prototype.completeUploadFile=function(e){var t=T(),n=t[B(this)];void 0!==n&&(n.completedAt=(new Date).toISOString(),n.eTag=this.eTag,n.firstMd5Digest=this.firstMd5Digest,t[B(this)]=n,r.setItem("awsUploads",JSON.stringify(t))),this.complete(e,this.name,this.progessStats()),this.setStatus(3),this.onProgress()},g.prototype.removeUploadFile=function(){var e,t;void 0!==this.file&&(e=B(this),delete(t=T())[e],r.setItem("awsUploads",JSON.stringify(t)))},g.prototype.getUnfinishedFileUpload=function(){var e=T(!0)[B(this)];this.canRetryUpload(e)&&(this.uploadId=e.uploadId,this.name=e.awsKey,this.eTag=e.eTag,this.firstMd5Digest=e.firstMd5Digest,this.signParams=e.signParams)},g.prototype.canRetryUpload=function(t){if(void 0===t)return!1;var r=new Date(t.completedAt||n);return this.con.partSize===t.partSize&&r>e&&this.con.bucket===t.bucket&&(!this.con.onlyRetryForSameFileName||this.name===t.awsKey)},g.prototype.partSuccess=function(e,r){var n=r.part;if(t.d(r.request.step,"ETag:",e),n.isEmpty||'"d41d8cd98f00b204e9800998ecf8427e"'!==e)return n.eTag=e,n.status=3,this.partsOnS3.push(n),!0;n.status=s,r.resetLoadedBytes();var o=["eTag matches MD5 of 0 length blob for part #",r.partNumber,"Retrying part."].join(" ");t.w(o),this.warn(o)},g.prototype.listPartsSuccess=function(e,t){this.info("uploadId",this.uploadId,"is not complete. Fetching parts from part marker",e.partNumberMarker),t=t.replace(/(\r\n|\n|\r)/gm,"");for(var r=/<Part>(.+?)<\/Part\>/g;;){var n=(r.exec(t)||[])[1];if(!n)break;var o=parseInt(I(n,"Size"),10);this.fileTotalBytesUploaded+=o,this.partsOnS3.push({eTag:I(n,"ETag").replace(/&quot;/g,'"'),partNumber:parseInt(I(n,"PartNumber"),10),size:o,LastModified:I(n,"LastModified")})}return"true"===I(t,"IsTruncated")?I(t,"NextPartNumberMarker"):void 0},g.prototype.makePartsfromPartsOnS3=function(){-1!==c.indexOf(this.status)&&(this.nameChanged(this.name),this.partsOnS3.forEach(function(e){var t=this.makePart(e.partNumber,3,e.size);t.eTag=e.eTag,t.loadedBytes=e.size,t.loadedBytesPrevious=e.size,t.finishedUploadingAt=e.LastModified}.bind(this)))},g.prototype.completeUpload=function(){var e=this;return new S(this).send().then(function(t){e.eTag=I(t.responseText,"ETag").replace(/&quot;/g,'"'),e.completeUploadFile(t)})},g.prototype.getCompletedPayload=function(){var e=[];return e.push("<CompleteMultipartUpload>"),this.s3Parts.forEach(function(t,r){r>0&&["<Part><PartNumber>",r,"</PartNumber><ETag>",t.eTag,"</ETag></Part>"].forEach(function(t){e.push(t)})}),e.push("</CompleteMultipartUpload>"),e.join("")},g.prototype.consumeSlots=function(){if(0===this.partsToUpload.length)return-1;if(this.partsToUpload.length!==this.partsInProcess.length&&this.status===o){var e=Math.min(this.getRemainingSlots(),this.partsToUpload.length);if(!e)return-1;for(var t=0,r=0;r<this.partsToUpload.length;r++){var n=this.s3Parts[this.partsToUpload[r]];if(n.status!==o&&this.canStartPart(n)){this.partsInProcess.length&&this.partsToUpload.length>1&&this.evaporatingCnt(1),this.partsInProcess.push(n.partNumber);var i=n.awsRequest;if(this.lastPartSatisfied.then(i.delaySend.bind(i)),this.lastPartSatisfied=i.getStartedPromise(),(t+=1)===e)break}}var a=this.partsToUpload.length===this.partsInProcess.length,s=this.getRemainingSlots();return a&&s>0&&this.startNextFile("consume slots"),s}return 0},g.prototype.canStartPart=function(e){return-1===this.partsInProcess.indexOf(e.partNumber)&&!e.awsRequest.errorExceptionStatus()},g.prototype.uploadFile=function(e){this.removeUploadFile();var t=this;return new v(t,e).send().then(function(){return t.uploadInitiated(t.uploadId),t.partsToUpload=[],t.uploadParts().then(function(){},function(e){throw e})})},g.prototype.uploadParts=function(){if(this.loaded=0,this.totalUploaded=0,-1===c.indexOf(this.status))return Promise.reject("Part uploading stopped because the file was canceled");var e=this.makeParts();return this.setStatus(o),this.startTime=new Date,this.consumeSlots(),Promise.all(e)},g.prototype.abortUpload=function(){return new Promise(function(e,t){void 0!==this.uploadId?new C(this).send().then(e,t):e()}.bind(this)).then(function(){this.setStatus(l),this.cancelled(),this.removeUploadFile()}.bind(this),this.deferredCompletion.reject.bind(this))},g.prototype.resumeInterruptedUpload=function(){return new b(this).send().then(this.uploadParts.bind(this))},g.prototype.reuseS3Object=function(e){var r=this;this.makeParts(1),this.partsToUpload=[];var n=this.s3Parts[1];function o(t){throw r.name=e,t}return n.awsRequest.getPartMd5Digest().then(function(){if(r.firstMd5Digest===n.md5_digest)return new _(r,e).send().then(function(e){t.d("headObject found matching object on S3."),r.completeUploadFile(e),r.nameChanged(r.name)}).catch(o);o(r.con.allowS3ExistenceOptimization?"File's first part MD5 digest does not match what was stored.":"allowS3ExistenceOptimization is not enabled.")})},m.prototype.fileUpload=void 0,m.prototype.con=void 0,m.prototype.awsUrl=void 0,m.prototype.awsHost=void 0,m.prototype.authorize=function(){},m.prototype.localTimeOffset=0,m.prototype.awsDeferred=void 0,m.prototype.started=void 0,m.prototype.getPath=function(){var e="/"+this.con.bucket+"/"+this.fileUpload.name;return(this.con.cloudfront||this.awsUrl.indexOf("cloudfront")>-1)&&(e="/"+this.fileUpload.name),e},m.prototype.updateRequest=function(e){this.request=e;var r=function(e,t){var r=e.con;function n(e){this.request=e}function o(e){n.call(this,e)}function i(e){this._cr=void 0,n.call(this,e)}return n.prototype.request={},n.prototype.error=function(){},n.prototype.authorizationString=function(){},n.prototype.stringToSign=function(){},n.prototype.canonicalRequest=function(){},n.prototype.setHeaders=function(){},n.prototype.datetime=function(e){return new Date((new Date).getTime()+e)},n.prototype.dateString=function(e){return this.datetime(e).toISOString().slice(0,19).replace(/-|:/g,"")+"Z"},o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype.authorizationString=function(){return["AWS ",r.aws_key,":",this.request.auth].join("")},o.prototype.stringToSign=function(){var n,o="",i=[];for(var a in this.request.x_amz_headers)this.request.x_amz_headers.hasOwnProperty(a)&&i.push(a);return i.sort(),i.forEach(function(e){o+=e+":"+this.request.x_amz_headers[e]+"\n"}.bind(this)),n=this.request.method+"\n"+(this.request.md5_digest||"")+"\n"+(this.request.contentType||"")+"\n\n"+o+(r.cloudfront?"/"+r.bucket:"")+e.getPath()+this.request.path,t.d("V2 stringToSign:",n),n},o.prototype.dateString=function(e){return this.datetime(e).toUTCString()},o.prototype.getPayload=function(){return Promise.resolve()},i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype._cr=void 0,i.prototype.payload=null,i.prototype.error=function(){this._cr=void 0},i.prototype.getPayload=function(){return e.getPayload().then(function(e){this.payload=e}.bind(this))},i.prototype.authorizationString=function(){var e=[],t=this.credentialString(),n=this.canonicalHeaders();return e.push(["AWS4-HMAC-SHA256 Credential=",r.aws_key,"/",t].join("")),e.push("SignedHeaders="+n.signedHeaders),e.push("Signature="+this.request.auth),e.join(", ")},i.prototype.stringToSign=function(){var e=[];e.push("AWS4-HMAC-SHA256"),e.push(this.request.dateString),e.push(this.credentialString()),e.push(r.cryptoHexEncodedHash256(this.canonicalRequest()));var n=e.join("\n");return t.d("V4 stringToSign:",n),n},i.prototype.credentialString=function(){var e=[];return e.push(this.request.dateString.slice(0,8)),e.push(r.awsRegion),e.push("s3"),e.push("aws4_request"),e.join("/")},i.prototype.canonicalQueryString=function(){var t,r,n=e.request.query_string||"",o=x([e.awsUrl,this.request.path,n].join("")).search,i=o.length?o.split("&"):[],a=[];for(r=0;r<i.length;r++)t=i[r].split("="),a.push({name:encodeURIComponent(t[0]),value:t.length>1?encodeURIComponent(t[1]):null});var s=a.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),l=[];for(r=0;r<s.length;r++)t=s[r].value?[s[r].name,s[r].value].join("="):s[r].name+"=",l.push(t);return l.join("&")},i.prototype.getPayloadSha256Content=function(){var e=this.request.contentSha256||r.cryptoHexEncodedHash256(this.payload||"");return t.d(this.request.step,"getPayloadSha256Content:",e),e},i.prototype.canonicalHeaders=function(){var t,r=[],n=[];function o(e,t){var o=e.toLowerCase();n.push(o),r[o]=t.replace(/\s+/g," ")}this.request.md5_digest&&o("Content-Md5",this.request.md5_digest),o("Host",e.awsHost),this.request.contentType&&o("Content-Type",this.request.contentType||"");var i=this.request.x_amz_headers||{};for(var a in i)i.hasOwnProperty(a)&&o(a,i[a]);var s=n.sort(function(e,t){return e<t?-1:e>t?1:0}),l=[],u=[],d=this.request.not_signed_headers||[],c=[];for(t=0;t<d.length;t++)u.push(d[t].toLowerCase());for(t=0;t<s.length;t++){var p=s[t];l.push([p,r[p]].join(":")),-1===u.indexOf(p)&&c.push(p)}return{canonicalHeaders:l.join("\n"),signedHeaders:c.join(";")}},i.prototype.canonicalRequest=function(){if(void 0!==this._cr)return this._cr;var r=[];r.push(this.request.method),r.push(x([e.awsUrl,e.getPath(),this.request.path].join("")).pathname),r.push(this.canonicalQueryString()||"");var n=this.canonicalHeaders();return r.push(n.canonicalHeaders+"\n"),r.push(n.signedHeaders),r.push(this.getPayloadSha256Content()),this._cr=r.join("\n"),t.d(this.request.step,"V4 CanonicalRequest:",this._cr),this._cr},i.prototype.setHeaders=function(e){e.setRequestHeader("x-amz-content-sha256",this.getPayloadSha256Content())},"4"===r.awsSignatureVersion?i:o}(this,t);this.signer=new r(e)},m.prototype.success=function(){this.awsDeferred.resolve(this.currentXhr)},m.prototype.backOffWait=function(){return 1===this.attempts?0:1e3*Math.min(this.con.maxRetryBackoffSecs,Math.pow(this.con.retryBackoffPower,this.attempts-2))},m.prototype.error=function(e){if(!this.errorExceptionStatus()&&(this.signer.error(),t.d(this.request.step,"error:",this.fileUpload.id,e),void 0===this.errorHandler(e))){this.fileUpload.warn("Error in ",this.request.step,e),this.fileUpload.setStatus(s);var r=this,n=this.backOffWait();this.attempts+=1,setTimeout(function(){r.errorExceptionStatus()||r.trySend()},n)}},m.prototype.errorHandler=function(){},m.prototype.errorExceptionStatus=function(){return!1},m.prototype.getPayload=function(){return Promise.resolve(null)},m.prototype.success_status=function(e){return e.status>=200&&e.status<=299||this.request.success404&&404===e.status},m.prototype.stringToSign=function(){return encodeURIComponent(this.signer.stringToSign())},m.prototype.canonicalRequest=function(){return this.signer.canonicalRequest()},m.prototype.signResponse=function(e,t,r){var n=this;return new Promise(function(o){if("function"==typeof n.con.signResponseHandler)return n.con.signResponseHandler(e,t,r).then(o);o(e)})},m.prototype.sendRequestToAWS=function(){var e=this;return new Promise(function(t,r){var n=new XMLHttpRequest;e.currentXhr=n;var o=[e.awsUrl,e.getPath(),e.request.path].join(""),i={};for(var a in e.request.query_string&&(o+=e.request.query_string),R(i,e.request.not_signed_headers),R(i,e.request.x_amz_headers),n.onreadystatechange=function(){if(4===n.readyState)if(e.success_status(n))e.request.response_match&&void 0===n.response.match(new RegExp(e.request.response_match))?r("AWS response does not match set pattern: "+e.request.response_match):t();else{var o=n.responseText?A(n):" ";o+="status:"+n.status,r(o)}},n.open(e.request.method,o),n.setRequestHeader("Authorization",e.signer.authorizationString()),i)i.hasOwnProperty(a)&&n.setRequestHeader(a,i[a]);e.signer.setHeaders(n),e.request.contentType&&n.setRequestHeader("Content-Type",e.request.contentType),e.request.md5_digest&&n.setRequestHeader("Content-MD5",e.request.md5_digest),n.onerror=function(e){var t=e.responseText?A(e):"transport error";r(t)},"function"==typeof e.request.onProgress&&(n.upload.onprogress=e.request.onProgress),e.getPayload().then(n.send.bind(n),r),setTimeout(function(){e.started.resolve("request sent "+e.request.step)},20),e.signer.payload=null,e.payloadPromise=void 0})},m.prototype.authorize=function(){return this.request.dateString=this.signer.dateString(this.localTimeOffset),this.request.x_amz_headers=R(this.request.x_amz_headers,{"x-amz-date":this.request.dateString}),this.signer.getPayload().then(function(){return function(e){var t=e.fileUpload,r=t.con,n=e.request;function o(){this.request=n}function i(){o.call(this)}if(o.prototype=Object.create(o.prototype),o.prototype.request={},o.makeSignParamsObject=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&("function"==typeof e[r]?t[r]=e[r]():t[r]=e[r]);return t},o.prototype.authorize=function(){return new Promise(function(i,a){var s=new XMLHttpRequest;e.currentXhr=s;var l=e.stringToSign(),u=[r.signerUrl,"?to_sign=",l,"&datetime=",n.dateString];r.sendCanonicalRequestToSignerUrl&&(u.push("&canonical_request="),u.push(encodeURIComponent(e.canonicalRequest()))),u=u.join("");var d=o.makeSignParamsObject(t.signParams);for(var c in d)d.hasOwnProperty(c)&&(u+="&"+encodeURIComponent(c)+"="+encodeURIComponent(d[c]));r.xhrWithCredentials&&(s.withCredentials=!0),s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status){var r=s.response.replace(/['"]+/g,"");e.signResponse(r,l,n.dateString).then(i)}else{if([401,403].indexOf(s.status)>-1){var o="status:"+s.status;return t.deferredCompletion.reject("Permission denied "+o),a(o)}a("Signature fetch returned status: "+s.status)}},s.onerror=function(e){a("authorizedSend transport error: "+e.responseText)},s.open("GET",u);var p=o.makeSignParamsObject(r.signHeaders);for(var h in p)p.hasOwnProperty(h)&&s.setRequestHeader(h,p[h]);"function"==typeof t.beforeSigner&&t.beforeSigner(s,u),s.send()})},i.prototype=Object.create(o.prototype),i.prototype.authorize=function(){return r.customAuthMethod(o.makeSignParamsObject(t.signParams),o.makeSignParamsObject(r.signHeaders),e.stringToSign(),n.dateString,e.canonicalRequest()).catch(function(e){throw t.deferredCompletion.reject(e),e})},"function"==typeof r.customAuthMethod)return new i;return new o}(this).authorize()}.bind(this))},m.prototype.authorizationSuccess=function(e){t.d(this.request.step,"signature:",e),this.request.auth=e},m.prototype.trySend=function(){var e=this;return this.authorize().then(function(t){e.authorizationSuccess(t),e.fileUpload.status!==l&&e.sendRequestToAWS().then(e.success.bind(e),e.error.bind(e))},e.error.bind(e))},m.prototype.send=function(){return this.trySend(),this.awsDeferred.promise},U.prototype=Object.create(m.prototype),U.prototype.constructor=U,U.prototype.errorExceptionStatus=function(){return[l,a].indexOf(this.fileUpload.status)>-1},y.prototype=Object.create(U.prototype),y.prototype.constructor=y,y.prototype.maxRetries=1,y.prototype.errorHandler=function(e){if(this.attempts>this.maxRetries){var r=["MaxRetries exceeded. Will re-upload file id ",this.fileUpload.id,", ",e].join("");return t.w(r),this.awsDeferred.reject(r),!0}},y.prototype.rejectedSuccess=function(){var e=Array.prototype.slice.call(arguments,1).join("");return this.awsDeferred.reject(e),!1},v.prototype=Object.create(U.prototype),v.prototype.constructor=v,v.prototype.success=function(){var e=this.currentXhr.response.match(new RegExp(this.request.response_match));this.fileUpload.uploadId=e[1],this.fileUpload.awsKey=this.awsKey,t.d("InitiateMultipartUpload ID is",this.fileUpload.uploadId),this.fileUpload.createUploadFile(),this.awsDeferred.resolve(this.currentXhr)},S.prototype=Object.create(U.prototype),S.prototype.constructor=S,S.prototype.getPayload=function(){return Promise.resolve(this.fileUpload.getCompletedPayload())},_.prototype=Object.create(y.prototype),_.prototype.constructor=_,_.prototype.awsKey=void 0,_.prototype.success=function(){(this.currentXhr.getResponseHeader("Etag")===this.fileUpload.eTag||this.rejectedSuccess("uploadId ",this.fileUpload.id," found on S3 but the Etag doesn't match."))&&this.awsDeferred.resolve(this.currentXhr)},b.prototype=Object.create(y.prototype),b.prototype.constructor=b,b.prototype.awsKey=void 0,b.prototype.partNumberMarker=0,b.prototype.setupRequest=function(e){var r=["setupRequest() for uploadId:",this.fileUpload.uploadId,"for part marker:",e].join(" ");t.d(r),this.fileUpload.info(r),this.awsKey=this.fileUpload.name,this.partNumberMarker=e;var n={method:"GET",path:["?uploadId=",this.fileUpload.uploadId].join(""),query_string:"&part-number-marker="+e,x_amz_headers:this.fileUpload.xAmzHeadersCommon,step:"get upload parts",success404:!0};return this.request=n,n},b.prototype.success=function(){if(404!==this.currentXhr.status){var e=this.fileUpload.listPartsSuccess(this,this.currentXhr.responseText);if(e){var t=this.setupRequest(e);this.updateRequest(t),this.trySend()}else this.fileUpload.makePartsfromPartsOnS3(),this.awsDeferred.resolve(this.currentXhr)}else this.rejectedSuccess("uploadId ",this.fileUpload.id," not found on S3.")&&this.awsDeferred.resolve(this.currentXhr)},w.prototype=Object.create(m.prototype),w.prototype.constructor=w,w.prototype.part=1,w.prototype.payloadPromise=void 0,w.prototype.start=0,w.prototype.end=0,w.prototype.partNumber=void 0,w.prototype.getPartMd5Digest=function(){var e=this,r=this.part;return new Promise(function(t,n){e.con.computeContentMd5&&!r.md5_digest?e.getPayload().then(function(r){var n=e.con.cryptoMd5Method(r);1===e.partNumber&&e.con.computeContentMd5&&void 0===e.fileUpload.firstMd5Digest&&(e.fileUpload.firstMd5Digest=n,e.fileUpload.updateUploadFile({firstMd5Digest:n})),t(n)},n):t(r.md5_digest)}).then(function(r){r&&(t.d(e.request.step,"MD5 digest:",r),e.request.md5_digest=r,e.part.md5_digest=r)})},w.prototype.sendRequestToAWS=function(){return this.stalledInterval=setInterval(this.stalledPartMonitor(),12e4),this.stalledPartMonitor(),m.prototype.sendRequestToAWS.call(this)},w.prototype.send=function(){if(3!==this.part.status&&-1===[l,i,a].indexOf(this.fileUpload.status)){t.d("uploadPart #",this.partNumber,1===this.attempts?"submitting":"retrying"),this.part.status=o,this.attempts+=1,this.part.loadedBytesPrevious=null;var e=this;return this.getPartMd5Digest().then(function(){t.d("Sending",e.request.step),m.prototype.send.call(e)})}},w.prototype.success=function(){clearInterval(this.stalledInterval);var e=this.currentXhr.getResponseHeader("ETag");this.currentXhr=null,this.fileUpload.partSuccess(e,this)&&this.awsDeferred.resolve(this.currentXhr)},w.prototype.onProgress=function(e){if(e.loaded>0){var t=e.loaded-this.part.loadedBytes;t&&(this.part.loadedBytes=e.loaded,this.fileUpload.updateLoaded(t))}},w.prototype.stalledPartMonitor=function(){var e=this.part.loadedBytes,r=this;return function(){clearInterval(r.stalledInterval),-1===[o,s,u,i].indexOf(r.fileUpload.status)&&r.part.status!==l&&r.part.loadedBytes<this.size&&(e===r.part.loadedBytes?(t.w("Part stalled. Will abort and retry:",r.partNumber,decodeURIComponent(r.fileUpload.name)),r.abort(),r.errorExceptionStatus()||r.delaySend()):r.stalledInterval=setInterval(r.stalledPartMonitor(),12e4))}},w.prototype.resetLoadedBytes=function(){this.fileUpload.updateLoaded(-this.part.loadedBytes),this.part.loadedBytes=0,this.fileUpload.onProgress()},w.prototype.errorExceptionStatus=function(){return[a,l,i,u].indexOf(this.fileUpload.status)>-1},w.prototype.delaySend=function(){var e=this.backOffWait();this.attempts+=1,setTimeout(this.send.bind(this),e)},w.prototype.errorHandler=function(e){if(clearInterval(this.stalledInterval),e.match(/status:404/)){var r="404 error on part PUT. The part and the file will abort. "+e;return t.w(r),this.fileUpload.error(r),this.part.status=l,this.awsDeferred.reject(r),!0}return this.resetLoadedBytes(),this.part.status=s,this.errorExceptionStatus()||this.delaySend(),!0},w.prototype.abort=function(){this.currentXhr&&this.currentXhr.abort(),this.resetLoadedBytes(),this.attempts=1},w.size=0,w.prototype.streamToArrayBuffer=function(e){return new Promise(function(t,r){if(!e.readable)return t([]);var n=new Uint8Array(Math.min(this.con.partSize,this.end-this.start)),o=0;function i(e){1!==e.byteLength&&(n.set(e,o),o+=e.byteLength)}function a(e){e?r(e):t(n),l()}function s(){t(n),l()}function l(){n=null,e.removeListener("data",i),e.removeListener("end",a),e.removeListener("error",a),e.removeListener("close",s)}e.on("data",i),e.on("end",a),e.on("error",a),e.on("close",s)}.bind(this))},w.prototype.getPayload=function(){return void 0===this.payloadPromise&&(this.payloadPromise=this.con.readableStreams?this.payloadFromStream():this.payloadFromBlob()),this.payloadPromise},w.prototype.payloadFromStream=function(){var e=this.con.readableStreamPartMethod(this.fileUpload.file,this.start,this.end-1);return new Promise(function(t,r){this.streamToArrayBuffer(e).then(function(e){t(e)}.bind(this),r)}.bind(this))},w.prototype.payloadFromBlob=function(){var e=this.fileUpload.file,t=e[e.slice?"slice":e.mozSlice?"mozSlice":"webkitSlice"](this.start,this.end);return this.con.computeContentMd5?new Promise(function(e){var r=new FileReader;r.onloadend=function(){var t=this.result&&void 0!==this.result.buffer?new Uint8Array(this.result.buffer):this.result;e(t)},r.readAsArrayBuffer(t)}):Promise.resolve(t)},w.prototype.stalledInterval=-1,w.prototype.getStartedPromise=function(){return this.started.promise},C.prototype=Object.create(m.prototype),C.prototype.constructor=C,C.prototype.maxRetries=1,C.prototype.success=function(){this.fileUpload.setStatus(l),this.awsDeferred.resolve(this.currentXhr)},C.prototype.errorHandler=function(e){if(this.attempts>this.maxRetries){var r="Error aborting upload, Exceeded retries deleting the file upload: "+e;return t.w(r),this.fileUpload.error(r),this.awsDeferred.reject(r),!0}},D.prototype.supported=!1,D.prototype.cacheStore=void 0,D.prototype.getItem=function(e){if(this.cacheStore)return this.cacheStore[e]},D.prototype.setItem=function(e,t){this.cacheStore&&(this.cacheStore[e]=t)},D.prototype.removeItem=function(e){if(this.cacheStore)return delete this.cacheStore[e]},D.supported=function(){if("undefined"==typeof window)return!1;if(!("localStorage"in window))return!1;try{var e="___test";localStorage[e]="OK";var t=localStorage[e];return delete localStorage[e],"OK"===t}catch(e){return!1}},t={d:function(){},w:function(){},e:function(){}},"undefined"!=typeof module&&module.exports?module.exports=f:"undefined"!=typeof window&&(window.Evaporate=f)}(),Uploader.s3.UploaderMultipart=Evaporate}(window),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.forge=t():e.forge=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=10)}([function(e,t){e.exports={options:{usePureJavaScript:!1}}},function(e,t,r){var n=r(0);e.exports=n.md=n.md||{},n.md.algorithms=n.md.algorithms||{}},function(e,t,r){function n(e){if(8!==e&&16!==e&&24!==e&&32!==e)throw new Error("Only 8, 16, 24, or 32 bits supported: "+e)}function o(e){if(this.data="",this.read=0,"string"==typeof e)this.data=e;else if(a.isArrayBuffer(e)||a.isArrayBufferView(e)){var t=new Uint8Array(e);try{this.data=String.fromCharCode.apply(null,t)}catch(e){for(var r=0;r<t.length;++r)this.putByte(t[r])}}else(e instanceof o||"object"==typeof e&&"string"==typeof e.data&&"number"==typeof e.read)&&(this.data=e.data,this.read=e.read);this._constructedStringLength=0}var i=r(0),a=e.exports=i.util=i.util||{};!function(){if("undefined"!=typeof process&&process.nextTick)return a.nextTick=process.nextTick,void("function"==typeof setImmediate?a.setImmediate=setImmediate:a.setImmediate=a.nextTick);if("function"==typeof setImmediate)return a.setImmediate=function(){return setImmediate.apply(void 0,arguments)},void(a.nextTick=function(e){return setImmediate(e)});if(a.setImmediate=function(e){setTimeout(e,0)},"undefined"!=typeof window&&"function"==typeof window.postMessage){var e="forge.setImmediate",t=[];a.setImmediate=function(r){t.push(r),1===t.length&&window.postMessage(e,"*")},window.addEventListener("message",function(r){if(r.source===window&&r.data===e){r.stopPropagation();var n=t.slice();t.length=0,n.forEach(function(e){e()})}},!0)}if("undefined"!=typeof MutationObserver){var r=Date.now(),n=!0,o=document.createElement("div");t=[];new MutationObserver(function(){var e=t.slice();t.length=0,e.forEach(function(e){e()})}).observe(o,{attributes:!0});var i=a.setImmediate;a.setImmediate=function(e){Date.now()-r>15?(r=Date.now(),i(e)):(t.push(e),1===t.length&&o.setAttribute("a",n=!n))}}a.nextTick=a.setImmediate}(),a.isNodejs="undefined"!=typeof process&&process.versions&&process.versions.node,a.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},a.isArrayBuffer=function(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer},a.isArrayBufferView=function(e){return e&&a.isArrayBuffer(e.buffer)&&void 0!==e.byteLength},a.ByteBuffer=o,a.ByteStringBuffer=o,a.ByteStringBuffer.prototype._optimizeConstructedString=function(e){this._constructedStringLength+=e,this._constructedStringLength>4096&&(this.data.substr(0,1),this._constructedStringLength=0)},a.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read},a.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0},a.ByteStringBuffer.prototype.putByte=function(e){return this.putBytes(String.fromCharCode(e))},a.ByteStringBuffer.prototype.fillWithByte=function(e,t){e=String.fromCharCode(e);for(var r=this.data;t>0;)1&t&&(r+=e),(t>>>=1)>0&&(e+=e);return this.data=r,this._optimizeConstructedString(t),this},a.ByteStringBuffer.prototype.putBytes=function(e){return this.data+=e,this._optimizeConstructedString(e.length),this},a.ByteStringBuffer.prototype.putString=function(e){return this.putBytes(a.encodeUtf8(e))},a.ByteStringBuffer.prototype.putInt16=function(e){return this.putBytes(String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},a.ByteStringBuffer.prototype.putInt24=function(e){return this.putBytes(String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},a.ByteStringBuffer.prototype.putInt32=function(e){return this.putBytes(String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},a.ByteStringBuffer.prototype.putInt16Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255))},a.ByteStringBuffer.prototype.putInt24Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255))},a.ByteStringBuffer.prototype.putInt32Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>24&255))},a.ByteStringBuffer.prototype.putInt=function(e,t){n(t);var r="";do{t-=8,r+=String.fromCharCode(e>>t&255)}while(t>0);return this.putBytes(r)},a.ByteStringBuffer.prototype.putSignedInt=function(e,t){return e<0&&(e+=2<<t-1),this.putInt(e,t)},a.ByteStringBuffer.prototype.putBuffer=function(e){return this.putBytes(e.getBytes())},a.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)},a.ByteStringBuffer.prototype.getInt16=function(){var e=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,e},a.ByteStringBuffer.prototype.getInt24=function(){var e=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,e},a.ByteStringBuffer.prototype.getInt32=function(){var e=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,e},a.ByteStringBuffer.prototype.getInt16Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,e},a.ByteStringBuffer.prototype.getInt24Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,e},a.ByteStringBuffer.prototype.getInt32Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,e},a.ByteStringBuffer.prototype.getInt=function(e){n(e);var t=0;do{t=(t<<8)+this.data.charCodeAt(this.read++),e-=8}while(e>0);return t},a.ByteStringBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),r=2<<e-2;return t>=r&&(t-=r<<1),t},a.ByteStringBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},a.ByteStringBuffer.prototype.bytes=function(e){return void 0===e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},a.ByteStringBuffer.prototype.at=function(e){return this.data.charCodeAt(this.read+e)},a.ByteStringBuffer.prototype.setAt=function(e,t){return this.data=this.data.substr(0,this.read+e)+String.fromCharCode(t)+this.data.substr(this.read+e+1),this},a.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)},a.ByteStringBuffer.prototype.copy=function(){var e=a.createBuffer(this.data);return e.read=this.read,e},a.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this},a.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this},a.ByteStringBuffer.prototype.truncate=function(e){var t=Math.max(0,this.length()-e);return this.data=this.data.substr(this.read,t),this.read=0,this},a.ByteStringBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.length;++t){var r=this.data.charCodeAt(t);r<16&&(e+="0"),e+=r.toString(16)}return e},a.ByteStringBuffer.prototype.toString=function(){return a.decodeUtf8(this.bytes())},a.DataBuffer=function(e,t){t=t||{},this.read=t.readOffset||0,this.growSize=t.growSize||1024;var r=a.isArrayBuffer(e),n=a.isArrayBufferView(e);if(r||n)return this.data=r?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),void(this.write="writeOffset"in t?t.writeOffset:this.data.byteLength);this.data=new DataView(new ArrayBuffer(0)),this.write=0,null!=e&&this.putBytes(e),"writeOffset"in t&&(this.write=t.writeOffset)},a.DataBuffer.prototype.length=function(){return this.write-this.read},a.DataBuffer.prototype.isEmpty=function(){return this.length()<=0},a.DataBuffer.prototype.accommodate=function(e,t){if(this.length()>=e)return this;t=Math.max(t||this.growSize,e);var r=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),n=new Uint8Array(this.length()+t);return n.set(r),this.data=new DataView(n.buffer),this},a.DataBuffer.prototype.putByte=function(e){return this.accommodate(1),this.data.setUint8(this.write++,e),this},a.DataBuffer.prototype.fillWithByte=function(e,t){this.accommodate(t);for(var r=0;r<t;++r)this.data.setUint8(e);return this},a.DataBuffer.prototype.putBytes=function(e,t){if(a.isArrayBufferView(e)){var r=(n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)).byteLength-n.byteOffset;return this.accommodate(r),new Uint8Array(this.data.buffer,this.write).set(n),this.write+=r,this}if(a.isArrayBuffer(e)){var n=new Uint8Array(e);return this.accommodate(n.byteLength),new Uint8Array(this.data.buffer).set(n,this.write),this.write+=n.byteLength,this}if(e instanceof a.DataBuffer||"object"==typeof e&&"number"==typeof e.read&&"number"==typeof e.write&&a.isArrayBufferView(e.data)){n=new Uint8Array(e.data.byteLength,e.read,e.length());return this.accommodate(n.byteLength),new Uint8Array(e.data.byteLength,this.write).set(n),this.write+=n.byteLength,this}if(e instanceof a.ByteStringBuffer&&(e=e.data,t="binary"),t=t||"binary","string"==typeof e){var o;if("hex"===t)return this.accommodate(Math.ceil(e.length/2)),o=new Uint8Array(this.data.buffer,this.write),this.write+=a.binary.hex.decode(e,o,this.write),this;if("base64"===t)return this.accommodate(3*Math.ceil(e.length/4)),o=new Uint8Array(this.data.buffer,this.write),this.write+=a.binary.base64.decode(e,o,this.write),this;if("utf8"===t&&(e=a.encodeUtf8(e),t="binary"),"binary"===t||"raw"===t)return this.accommodate(e.length),o=new Uint8Array(this.data.buffer,this.write),this.write+=a.binary.raw.decode(o),this;if("utf16"===t)return this.accommodate(2*e.length),o=new Uint16Array(this.data.buffer,this.write),this.write+=a.text.utf16.encode(o),this;throw new Error("Invalid encoding: "+t)}throw Error("Invalid parameter: "+e)},a.DataBuffer.prototype.putBuffer=function(e){return this.putBytes(e),e.clear(),this},a.DataBuffer.prototype.putString=function(e){return this.putBytes(e,"utf16")},a.DataBuffer.prototype.putInt16=function(e){return this.accommodate(2),this.data.setInt16(this.write,e),this.write+=2,this},a.DataBuffer.prototype.putInt24=function(e){return this.accommodate(3),this.data.setInt16(this.write,e>>8&65535),this.data.setInt8(this.write,e>>16&255),this.write+=3,this},a.DataBuffer.prototype.putInt32=function(e){return this.accommodate(4),this.data.setInt32(this.write,e),this.write+=4,this},a.DataBuffer.prototype.putInt16Le=function(e){return this.accommodate(2),this.data.setInt16(this.write,e,!0),this.write+=2,this},a.DataBuffer.prototype.putInt24Le=function(e){return this.accommodate(3),this.data.setInt8(this.write,e>>16&255),this.data.setInt16(this.write,e>>8&65535,!0),this.write+=3,this},a.DataBuffer.prototype.putInt32Le=function(e){return this.accommodate(4),this.data.setInt32(this.write,e,!0),this.write+=4,this},a.DataBuffer.prototype.putInt=function(e,t){n(t),this.accommodate(t/8);do{t-=8,this.data.setInt8(this.write++,e>>t&255)}while(t>0);return this},a.DataBuffer.prototype.putSignedInt=function(e,t){return n(t),this.accommodate(t/8),e<0&&(e+=2<<t-1),this.putInt(e,t)},a.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)},a.DataBuffer.prototype.getInt16=function(){var e=this.data.getInt16(this.read);return this.read+=2,e},a.DataBuffer.prototype.getInt24=function(){var e=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,e},a.DataBuffer.prototype.getInt32=function(){var e=this.data.getInt32(this.read);return this.read+=4,e},a.DataBuffer.prototype.getInt16Le=function(){var e=this.data.getInt16(this.read,!0);return this.read+=2,e},a.DataBuffer.prototype.getInt24Le=function(){var e=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,e},a.DataBuffer.prototype.getInt32Le=function(){var e=this.data.getInt32(this.read,!0);return this.read+=4,e},a.DataBuffer.prototype.getInt=function(e){n(e);var t=0;do{t=(t<<8)+this.data.getInt8(this.read++),e-=8}while(e>0);return t},a.DataBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),r=2<<e-2;return t>=r&&(t-=r<<1),t},a.DataBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},a.DataBuffer.prototype.bytes=function(e){return void 0===e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},a.DataBuffer.prototype.at=function(e){return this.data.getUint8(this.read+e)},a.DataBuffer.prototype.setAt=function(e,t){return this.data.setUint8(e,t),this},a.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)},a.DataBuffer.prototype.copy=function(){return new a.DataBuffer(this)},a.DataBuffer.prototype.compact=function(){if(this.read>0){var e=new Uint8Array(this.data.buffer,this.read),t=new Uint8Array(e.byteLength);t.set(e),this.data=new DataView(t),this.write-=this.read,this.read=0}return this},a.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this},a.DataBuffer.prototype.truncate=function(e){return this.write=Math.max(0,this.length()-e),this.read=Math.min(this.read,this.write),this},a.DataBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.byteLength;++t){var r=this.data.getUint8(t);r<16&&(e+="0"),e+=r.toString(16)}return e},a.DataBuffer.prototype.toString=function(e){var t=new Uint8Array(this.data,this.read,this.length());if("binary"===(e=e||"utf8")||"raw"===e)return a.binary.raw.encode(t);if("hex"===e)return a.binary.hex.encode(t);if("base64"===e)return a.binary.base64.encode(t);if("utf8"===e)return a.text.utf8.decode(t);if("utf16"===e)return a.text.utf16.decode(t);throw new Error("Invalid encoding: "+e)},a.createBuffer=function(e,t){return t=t||"raw",void 0!==e&&"utf8"===t&&(e=a.encodeUtf8(e)),new a.ByteBuffer(e)},a.fillString=function(e,t){for(var r="";t>0;)1&t&&(r+=e),(t>>>=1)>0&&(e+=e);return r},a.xorBytes=function(e,t,r){for(var n="",o="",i="",a=0,s=0;r>0;--r,++a)o=e.charCodeAt(a)^t.charCodeAt(a),s>=10&&(n+=i,i="",s=0),i+=String.fromCharCode(o),++s;return n+i},a.hexToBytes=function(e){var t="",r=0;for(!0&e.length&&(r=1,t+=String.fromCharCode(parseInt(e[0],16)));r<e.length;r+=2)t+=String.fromCharCode(parseInt(e.substr(r,2),16));return t},a.bytesToHex=function(e){return a.createBuffer(e).toHex()},a.int32ToBytes=function(e){return String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e)};var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];a.encode64=function(e,t){for(var r,n,o,i="",a="",l=0;l<e.length;)r=e.charCodeAt(l++),n=e.charCodeAt(l++),o=e.charCodeAt(l++),i+=s.charAt(r>>2),i+=s.charAt((3&r)<<4|n>>4),isNaN(n)?i+="==":(i+=s.charAt((15&n)<<2|o>>6),i+=isNaN(o)?"=":s.charAt(63&o)),t&&i.length>t&&(a+=i.substr(0,t)+"\r\n",i=i.substr(t));return a+i},a.decode64=function(e){e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var t,r,n,o,i="",a=0;a<e.length;)t=l[e.charCodeAt(a++)-43],r=l[e.charCodeAt(a++)-43],n=l[e.charCodeAt(a++)-43],o=l[e.charCodeAt(a++)-43],i+=String.fromCharCode(t<<2|r>>4),64!==n&&(i+=String.fromCharCode((15&r)<<4|n>>2),64!==o&&(i+=String.fromCharCode((3&n)<<6|o)));return i},a.encodeUtf8=function(e){return unescape(encodeURIComponent(e))},a.decodeUtf8=function(e){return decodeURIComponent(escape(e))},a.binary={raw:{},hex:{},base64:{}},a.binary.raw.encode=function(e){return String.fromCharCode.apply(null,e)},a.binary.raw.decode=function(e,t,r){var n=t;n||(n=new Uint8Array(e.length));for(var o=r=r||0,i=0;i<e.length;++i)n[o++]=e.charCodeAt(i);return t?o-r:n},a.binary.hex.encode=a.bytesToHex,a.binary.hex.decode=function(e,t,r){var n=t;n||(n=new Uint8Array(Math.ceil(e.length/2)));var o=0,i=r=r||0;for(1&e.length&&(o=1,n[i++]=parseInt(e[0],16));o<e.length;o+=2)n[i++]=parseInt(e.substr(o,2),16);return t?i-r:n},a.binary.base64.encode=function(e,t){for(var r,n,o,i="",a="",l=0;l<e.byteLength;)r=e[l++],n=e[l++],o=e[l++],i+=s.charAt(r>>2),i+=s.charAt((3&r)<<4|n>>4),isNaN(n)?i+="==":(i+=s.charAt((15&n)<<2|o>>6),i+=isNaN(o)?"=":s.charAt(63&o)),t&&i.length>t&&(a+=i.substr(0,t)+"\r\n",i=i.substr(t));return a+i},a.binary.base64.decode=function(e,t,r){var n=t;n||(n=new Uint8Array(3*Math.ceil(e.length/4))),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var o,i,a,s,u=0,d=r=r||0;u<e.length;)o=l[e.charCodeAt(u++)-43],i=l[e.charCodeAt(u++)-43],a=l[e.charCodeAt(u++)-43],s=l[e.charCodeAt(u++)-43],n[d++]=o<<2|i>>4,64!==a&&(n[d++]=(15&i)<<4|a>>2,64!==s&&(n[d++]=(3&a)<<6|s));return t?d-r:n.subarray(0,d)},a.text={utf8:{},utf16:{}},a.text.utf8.encode=function(e,t,r){e=a.encodeUtf8(e);var n=t;n||(n=new Uint8Array(e.length));for(var o=r=r||0,i=0;i<e.length;++i)n[o++]=e.charCodeAt(i);return t?o-r:n},a.text.utf8.decode=function(e){return a.decodeUtf8(String.fromCharCode.apply(null,e))},a.text.utf16.encode=function(e,t,r){var n=t;n||(n=new Uint8Array(2*e.length));for(var o=new Uint16Array(n.buffer),i=r=r||0,a=r,s=0;s<e.length;++s)o[a++]=e.charCodeAt(s),i+=2;return t?i-r:n},a.text.utf16.decode=function(e){return String.fromCharCode.apply(null,new Uint16Array(e.buffer))},a.deflate=function(e,t,r){if(t=a.decode64(e.deflate(a.encode64(t)).rval),r){var n=2;32&t.charCodeAt(1)&&(n=6),t=t.substring(n,t.length-4)}return t},a.inflate=function(e,t,r){var n=e.inflate(a.encode64(t)).rval;return null===n?null:a.decode64(n)};var u=function(e,t,r){if(!e)throw new Error("WebStorage not available.");var n;if(null===r?n=e.removeItem(t):(r=a.encode64(JSON.stringify(r)),n=e.setItem(t,r)),void 0!==n&&!0!==n.rval){var o=new Error(n.error.message);throw o.id=n.error.id,o.name=n.error.name,o}},d=function(e,t){if(!e)throw new Error("WebStorage not available.");var r=e.getItem(t);if(e.init)if(null===r.rval){if(r.error){var n=new Error(r.error.message);throw n.id=r.error.id,n.name=r.error.name,n}r=null}else r=r.rval;return null!==r&&(r=JSON.parse(a.decode64(r))),r},c=function(e,t,r,n){var o=d(e,t);null===o&&(o={}),o[r]=n,u(e,t,o)},p=function(e,t,r){var n=d(e,t);return null!==n&&(n=r in n?n[r]:null),n},h=function(e,t,r){var n=d(e,t);if(null!==n&&r in n){delete n[r];var o=!0;for(var i in n){o=!1;break}o&&(n=null),u(e,t,n)}},f=function(e,t){u(e,t,null)},g=function(e,t,r){var n=null;void 0===r&&(r=["web","flash"]);var o,i=!1,a=null;for(var s in r){o=r[s];try{if("flash"===o||"both"===o){if(null===t[0])throw new Error("Flash local storage not available.");n=e.apply(this,t),i="flash"===o}"web"!==o&&"both"!==o||(t[0]=localStorage,n=e.apply(this,t),i=!0)}catch(e){a=e}if(i)break}if(!i)throw a;return n};a.setItem=function(e,t,r,n,o){g(c,arguments,o)},a.getItem=function(e,t,r,n){return g(p,arguments,n)},a.removeItem=function(e,t,r,n){g(h,arguments,n)},a.clearItems=function(e,t,r){g(f,arguments,r)},a.parseUrl=function(e){var t=/^(https?):\/\/([^:&^\/]*):?(\d*)(.*)$/g;t.lastIndex=0;var r=t.exec(e),n=null===r?null:{full:e,scheme:r[1],host:r[2],port:r[3],path:r[4]};return n&&(n.fullHost=n.host,n.port?80!==n.port&&"http"===n.scheme?n.fullHost+=":"+n.port:443!==n.port&&"https"===n.scheme&&(n.fullHost+=":"+n.port):"http"===n.scheme?n.port=80:"https"===n.scheme&&(n.port=443),n.full=n.scheme+"://"+n.fullHost),n};var m=null;a.getQueryVariables=function(e){var t,r=function(e){for(var t={},r=e.split("&"),n=0;n<r.length;n++){var o,i,a=r[n].indexOf("=");a>0?(o=r[n].substring(0,a),i=r[n].substring(a+1)):(o=r[n],i=null),o in t||(t[o]=[]),o in Object.prototype||null===i||t[o].push(unescape(i))}return t};return void 0===e?(null===m&&(m="undefined"!=typeof window&&window.location&&window.location.search?r(window.location.search.substring(1)):{}),t=m):t=r(e),t},a.parseFragment=function(e){var t=e,r="",n=e.indexOf("?");n>0&&(t=e.substring(0,n),r=e.substring(n+1));var o=t.split("/");return o.length>0&&""===o[0]&&o.shift(),{pathString:t,queryString:r,path:o,query:""===r?{}:a.getQueryVariables(r)}},a.makeRequest=function(e){var t=a.parseFragment(e),r={path:t.pathString,query:t.queryString,getPath:function(e){return void 0===e?t.path:t.path[e]},getQuery:function(e,r){var n;return void 0===e?n=t.query:(n=t.query[e])&&void 0!==r&&(n=n[r]),n},getQueryLast:function(e,t){var n=r.getQuery(e);return n?n[n.length-1]:t}};return r},a.makeLink=function(e,t,r){e=jQuery.isArray(e)?e.join("/"):e;var n=jQuery.param(t||{});return r=r||"",e+(n.length>0?"?"+n:"")+(r.length>0?"#"+r:"")},a.setPath=function(e,t,r){if("object"==typeof e&&null!==e)for(var n=0,o=t.length;n<o;){var i=t[n++];if(n==o)e[i]=r;else{var a=i in e;(!a||a&&"object"!=typeof e[i]||a&&null===e[i])&&(e[i]={}),e=e[i]}}},a.getPath=function(e,t,r){for(var n=0,o=t.length,i=!0;i&&n<o&&"object"==typeof e&&null!==e;){var a=t[n++];(i=a in e)&&(e=e[a])}return i?e:r},a.deletePath=function(e,t){if("object"==typeof e&&null!==e)for(var r=0,n=t.length;r<n;){var o=t[r++];if(r==n)delete e[o];else{if(!(o in e)||"object"!=typeof e[o]||null===e[o])break;e=e[o]}}},a.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},a.format=function(e){for(var t,r,n=/%./g,o=0,i=[],a=0;t=n.exec(e);){(r=e.substring(a,n.lastIndex-2)).length>0&&i.push(r),a=n.lastIndex;var s=t[0][1];switch(s){case"s":case"o":o<arguments.length?i.push(arguments[1+o++]):i.push("<?>");break;case"%":i.push("%");break;default:i.push("<%"+s+"?>")}}return i.push(e.substring(a)),i.join("")},a.formatNumber=function(e,t,r,n){var o=e,i=isNaN(t=Math.abs(t))?2:t,a=void 0===r?",":r,s=void 0===n?".":n,l=o<0?"-":"",u=parseInt(o=Math.abs(+o||0).toFixed(i),10)+"",d=u.length>3?u.length%3:0;return l+(d?u.substr(0,d)+s:"")+u.substr(d).replace(/(\d{3})(?=\d)/g,"$1"+s)+(i?a+Math.abs(o-u).toFixed(i).slice(2):"")},a.formatSize=function(e){return e>=1073741824?a.formatNumber(e/1073741824,2,".","")+" GiB":e>=1048576?a.formatNumber(e/1048576,2,".","")+" MiB":e>=1024?a.formatNumber(e/1024,0)+" KiB":a.formatNumber(e,0)+" bytes"},a.bytesFromIP=function(e){return-1!==e.indexOf(".")?a.bytesFromIPv4(e):-1!==e.indexOf(":")?a.bytesFromIPv6(e):null},a.bytesFromIPv4=function(e){if(4!==(e=e.split(".")).length)return null;for(var t=a.createBuffer(),r=0;r<e.length;++r){var n=parseInt(e[r],10);if(isNaN(n))return null;t.putByte(n)}return t.getBytes()},a.bytesFromIPv6=function(e){for(var t=0,r=2*(8-(e=e.split(":").filter(function(e){return 0===e.length&&++t,!0})).length+t),n=a.createBuffer(),o=0;o<8;++o)if(e[o]&&0!==e[o].length){var i=a.hexToBytes(e[o]);i.length<2&&n.putByte(0),n.putBytes(i)}else n.fillWithByte(0,r),r=0;return n.getBytes()},a.bytesToIP=function(e){return 4===e.length?a.bytesToIPv4(e):16===e.length?a.bytesToIPv6(e):null},a.bytesToIPv4=function(e){if(4!==e.length)return null;for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t.join(".")},a.bytesToIPv6=function(e){if(16!==e.length)return null;for(var t=[],r=[],n=0,o=0;o<e.length;o+=2){for(var i=a.bytesToHex(e[o]+e[o+1]);"0"===i[0]&&"0"!==i;)i=i.substr(1);if("0"===i){var s=r[r.length-1],l=t.length;s&&l===s.end+1?(s.end=l,s.end-s.start>r[n].end-r[n].start&&(n=r.length-1)):r.push({start:l,end:l})}t.push(i)}if(r.length>0){var u=r[n];u.end-u.start>0&&(t.splice(u.start,u.end-u.start+1,""),0===u.start&&t.unshift(""),7===u.end&&t.push(""))}return t.join(":")},a.estimateCores=function(e,t){if("function"==typeof e&&(t=e,e={}),e=e||{},"cores"in a&&!e.update)return t(null,a.cores);if("undefined"!=typeof navigator&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return a.cores=navigator.hardwareConcurrency,t(null,a.cores);if("undefined"==typeof Worker)return a.cores=1,t(null,a.cores);if("undefined"==typeof Blob)return a.cores=2,t(null,a.cores);var r=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",function(e){for(var t=Date.now(),r=t+4;Date.now()<r;);self.postMessage({st:t,et:r})})}.toString(),")()"],{type:"application/javascript"}));!function e(n,o,i){if(0===o){var s=Math.floor(n.reduce(function(e,t){return e+t},0)/n.length);return a.cores=Math.max(1,s),URL.revokeObjectURL(r),t(null,a.cores)}!function(e,t){for(var n=[],o=[],i=0;i<e;++i){var a=new Worker(r);a.addEventListener("message",function(r){if(o.push(r.data),o.length===e){for(var i=0;i<e;++i)n[i].terminate();t(null,o)}}),n.push(a)}for(var i=0;i<e;++i)n[i].postMessage(i)}(i,function(t,r){n.push(function(e,t){for(var r=[],n=0;n<e;++n)for(var o=t[n],i=r[n]=[],a=0;a<e;++a)if(n!==a){var s=t[a];(o.st>s.st&&o.st<s.et||s.st>o.st&&s.st<o.et)&&i.push(a)}return r.reduce(function(e,t){return Math.max(e,t.length)},0)}(i,r)),e(n,o-1,i)})}([],5,16)}},function(e,t,r){e.exports=r(0),r(4),r(5),r(2)},function(e,t,r){var n=r(0);r(1),r(2),(e.exports=n.hmac=n.hmac||{}).create=function(){var e=null,t=null,r=null,o=null,i={start:function(i,a){if(null!==i)if("string"==typeof i){if(!((i=i.toLowerCase())in n.md.algorithms))throw new Error('Unknown hash algorithm "'+i+'"');t=n.md.algorithms[i].create()}else t=i;if(null===a)a=e;else{if("string"==typeof a)a=n.util.createBuffer(a);else if(n.util.isArray(a)){var s=a;a=n.util.createBuffer();for(var l=0;l<s.length;++l)a.putByte(s[l])}var u=a.length();u>t.blockLength&&(t.start(),t.update(a.bytes()),a=t.digest()),r=n.util.createBuffer(),o=n.util.createBuffer(),u=a.length();for(l=0;l<u;++l){s=a.at(l);r.putByte(54^s),o.putByte(92^s)}if(u<t.blockLength)for(s=t.blockLength-u,l=0;l<s;++l)r.putByte(54),o.putByte(92);e=a,r=r.bytes(),o=o.bytes()}t.start(),t.update(r)},update:function(e){t.update(e)},getMac:function(){var e=t.digest().bytes();return t.start(),t.update(o),t.update(e),t.digest()}};return i.digest=i.getMac,i}},function(e,t,r){e.exports=r(1),r(6),r(7),r(8),r(9)},function(e,t,r){function n(e,t,r){for(var n,o,i,a,d,c,p,h=r.length();h>=64;){for(o=e.h0,i=e.h1,a=e.h2,d=e.h3,p=0;p<16;++p)t[p]=r.getInt32Le(),n=o+(d^i&(a^d))+u[p]+t[p],o=d,d=a,a=i,i+=n<<(c=l[p])|n>>>32-c;for(;p<32;++p)n=o+(a^d&(i^a))+u[p]+t[s[p]],o=d,d=a,a=i,i+=n<<(c=l[p])|n>>>32-c;for(;p<48;++p)n=o+(i^a^d)+u[p]+t[s[p]],o=d,d=a,a=i,i+=n<<(c=l[p])|n>>>32-c;for(;p<64;++p)n=o+(a^(i|~d))+u[p]+t[s[p]],o=d,d=a,a=i,i+=n<<(c=l[p])|n>>>32-c;e.h0=e.h0+o|0,e.h1=e.h1+i|0,e.h2=e.h2+a|0,e.h3=e.h3+d|0,h-=64}}var o=r(0);r(1),r(2);var i=e.exports=o.md5=o.md5||{};o.md.md5=o.md.algorithms.md5=i,i.create=function(){d||function(){a=String.fromCharCode(128),a+=o.util.fillString(String.fromCharCode(0),64),s=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,1,6,11,0,5,10,15,4,9,14,3,8,13,2,7,12,5,8,11,14,1,4,7,10,13,0,3,6,9,12,15,2,0,7,14,5,12,3,10,1,8,15,6,13,4,11,2,9],l=[7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21],u=new Array(64);for(var e=0;e<64;++e)u[e]=Math.floor(4294967296*Math.abs(Math.sin(e+1)));d=!0}();var e=null,t=o.util.createBuffer(),r=new Array(16),i={algorithm:"md5",blockLength:64,digestLength:16,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){i.messageLength=0,i.fullMessageLength=i.messageLength64=[];for(var r=i.messageLengthSize/4,n=0;n<r;++n)i.fullMessageLength.push(0);return t=o.util.createBuffer(),e={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878},i}};return i.start(),i.update=function(a,s){"utf8"===s&&(a=o.util.encodeUtf8(a));var l=a.length;i.messageLength+=l,l=[l/4294967296>>>0,l>>>0];for(var u=i.fullMessageLength.length-1;u>=0;--u)i.fullMessageLength[u]+=l[1],l[1]=l[0]+(i.fullMessageLength[u]/4294967296>>>0),i.fullMessageLength[u]=i.fullMessageLength[u]>>>0,l[0]=l[1]/4294967296>>>0;return t.putBytes(a),n(e,r,t),(t.read>2048||0===t.length())&&t.compact(),i},i.digest=function(){var s=o.util.createBuffer();s.putBytes(t.bytes());var l=i.fullMessageLength[i.fullMessageLength.length-1]+i.messageLengthSize&i.blockLength-1;s.putBytes(a.substr(0,i.blockLength-l));for(var u,d=0,c=i.fullMessageLength.length-1;c>=0;--c)d=(u=8*i.fullMessageLength[c]+d)/4294967296>>>0,s.putInt32Le(u>>>0);var p={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3};n(p,r,s);var h=o.util.createBuffer();return h.putInt32Le(p.h0),h.putInt32Le(p.h1),h.putInt32Le(p.h2),h.putInt32Le(p.h3),h},i};var a=null,s=null,l=null,u=null,d=!1},function(e,t,r){function n(e,t,r){for(var n,o,i,a,s,l,u,d=r.length();d>=64;){for(o=e.h0,i=e.h1,a=e.h2,s=e.h3,l=e.h4,u=0;u<16;++u)n=r.getInt32(),t[u]=n,n=(o<<5|o>>>27)+(s^i&(a^s))+l+1518500249+n,l=s,s=a,a=(i<<30|i>>>2)>>>0,i=o,o=n;for(;u<20;++u)n=(n=t[u-3]^t[u-8]^t[u-14]^t[u-16])<<1|n>>>31,t[u]=n,n=(o<<5|o>>>27)+(s^i&(a^s))+l+1518500249+n,l=s,s=a,a=(i<<30|i>>>2)>>>0,i=o,o=n;for(;u<32;++u)n=(n=t[u-3]^t[u-8]^t[u-14]^t[u-16])<<1|n>>>31,t[u]=n,n=(o<<5|o>>>27)+(i^a^s)+l+1859775393+n,l=s,s=a,a=(i<<30|i>>>2)>>>0,i=o,o=n;for(;u<40;++u)n=(n=t[u-6]^t[u-16]^t[u-28]^t[u-32])<<2|n>>>30,t[u]=n,n=(o<<5|o>>>27)+(i^a^s)+l+1859775393+n,l=s,s=a,a=(i<<30|i>>>2)>>>0,i=o,o=n;for(;u<60;++u)n=(n=t[u-6]^t[u-16]^t[u-28]^t[u-32])<<2|n>>>30,t[u]=n,n=(o<<5|o>>>27)+(i&a|s&(i^a))+l+2400959708+n,l=s,s=a,a=(i<<30|i>>>2)>>>0,i=o,o=n;for(;u<80;++u)n=(n=t[u-6]^t[u-16]^t[u-28]^t[u-32])<<2|n>>>30,t[u]=n,n=(o<<5|o>>>27)+(i^a^s)+l+3395469782+n,l=s,s=a,a=(i<<30|i>>>2)>>>0,i=o,o=n;e.h0=e.h0+o|0,e.h1=e.h1+i|0,e.h2=e.h2+a|0,e.h3=e.h3+s|0,e.h4=e.h4+l|0,d-=64}}var o=r(0);r(1),r(2);var i=e.exports=o.sha1=o.sha1||{};o.md.sha1=o.md.algorithms.sha1=i,i.create=function(){s||(a=String.fromCharCode(128),a+=o.util.fillString(String.fromCharCode(0),64),s=!0);var e=null,t=o.util.createBuffer(),r=new Array(80),i={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){i.messageLength=0,i.fullMessageLength=i.messageLength64=[];for(var r=i.messageLengthSize/4,n=0;n<r;++n)i.fullMessageLength.push(0);return t=o.util.createBuffer(),e={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},i}};return i.start(),i.update=function(a,s){"utf8"===s&&(a=o.util.encodeUtf8(a));var l=a.length;i.messageLength+=l,l=[l/4294967296>>>0,l>>>0];for(var u=i.fullMessageLength.length-1;u>=0;--u)i.fullMessageLength[u]+=l[1],l[1]=l[0]+(i.fullMessageLength[u]/4294967296>>>0),i.fullMessageLength[u]=i.fullMessageLength[u]>>>0,l[0]=l[1]/4294967296>>>0;return t.putBytes(a),n(e,r,t),(t.read>2048||0===t.length())&&t.compact(),i},i.digest=function(){var s=o.util.createBuffer();s.putBytes(t.bytes());var l=i.fullMessageLength[i.fullMessageLength.length-1]+i.messageLengthSize&i.blockLength-1;s.putBytes(a.substr(0,i.blockLength-l));for(var u,d=8*i.fullMessageLength[0],c=0;c<i.fullMessageLength.length-1;++c)d+=(u=8*i.fullMessageLength[c+1])/4294967296>>>0,s.putInt32(d>>>0),d=u>>>0;s.putInt32(d);var p={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4};n(p,r,s);var h=o.util.createBuffer();return h.putInt32(p.h0),h.putInt32(p.h1),h.putInt32(p.h2),h.putInt32(p.h3),h.putInt32(p.h4),h},i};var a=null,s=!1},function(e,t,r){function n(e,t,r){for(var n,o,i,a,s,u,d,c,p,h,f,g,m,U=r.length();U>=64;){for(s=0;s<16;++s)t[s]=r.getInt32();for(;s<64;++s)n=((n=t[s-2])>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,o=((o=t[s-15])>>>7|o<<25)^(o>>>18|o<<14)^o>>>3,t[s]=n+t[s-7]+o+t[s-16]|0;for(u=e.h0,d=e.h1,c=e.h2,p=e.h3,h=e.h4,f=e.h5,g=e.h6,m=e.h7,s=0;s<64;++s)i=(u>>>2|u<<30)^(u>>>13|u<<19)^(u>>>22|u<<10),a=u&d|c&(u^d),n=m+((h>>>6|h<<26)^(h>>>11|h<<21)^(h>>>25|h<<7))+(g^h&(f^g))+l[s]+t[s],m=g,g=f,f=h,h=p+n>>>0,p=c,c=d,d=u,u=n+(o=i+a)>>>0;e.h0=e.h0+u|0,e.h1=e.h1+d|0,e.h2=e.h2+c|0,e.h3=e.h3+p|0,e.h4=e.h4+h|0,e.h5=e.h5+f|0,e.h6=e.h6+g|0,e.h7=e.h7+m|0,U-=64}}var o=r(0);r(1),r(2);var i=e.exports=o.sha256=o.sha256||{};o.md.sha256=o.md.algorithms.sha256=i,i.create=function(){s||(a=String.fromCharCode(128),a+=o.util.fillString(String.fromCharCode(0),64),l=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],s=!0);var e=null,t=o.util.createBuffer(),r=new Array(64),i={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){i.messageLength=0,i.fullMessageLength=i.messageLength64=[];for(var r=i.messageLengthSize/4,n=0;n<r;++n)i.fullMessageLength.push(0);return t=o.util.createBuffer(),e={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},i}};return i.start(),i.update=function(a,s){"utf8"===s&&(a=o.util.encodeUtf8(a));var l=a.length;i.messageLength+=l,l=[l/4294967296>>>0,l>>>0];for(var u=i.fullMessageLength.length-1;u>=0;--u)i.fullMessageLength[u]+=l[1],l[1]=l[0]+(i.fullMessageLength[u]/4294967296>>>0),i.fullMessageLength[u]=i.fullMessageLength[u]>>>0,l[0]=l[1]/4294967296>>>0;return t.putBytes(a),n(e,r,t),(t.read>2048||0===t.length())&&t.compact(),i},i.digest=function(){var s=o.util.createBuffer();s.putBytes(t.bytes());var l=i.fullMessageLength[i.fullMessageLength.length-1]+i.messageLengthSize&i.blockLength-1;s.putBytes(a.substr(0,i.blockLength-l));for(var u,d=8*i.fullMessageLength[0],c=0;c<i.fullMessageLength.length-1;++c)d+=(u=8*i.fullMessageLength[c+1])/4294967296>>>0,s.putInt32(d>>>0),d=u>>>0;s.putInt32(d);var p={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4,h5:e.h5,h6:e.h6,h7:e.h7};n(p,r,s);var h=o.util.createBuffer();return h.putInt32(p.h0),h.putInt32(p.h1),h.putInt32(p.h2),h.putInt32(p.h3),h.putInt32(p.h4),h.putInt32(p.h5),h.putInt32(p.h6),h.putInt32(p.h7),h},i};var a=null,s=!1,l=null},function(e,t,r){function n(e,t,r){for(var n,o,i,a,s,l,d,c,p,h,f,g,m,U,y,v,S,_,b,w,C,x,P,A,I,E,R,T,B,F,k,D,L,O=r.length();O>=128;){for(R=0;R<16;++R)t[R][0]=r.getInt32()>>>0,t[R][1]=r.getInt32()>>>0;for(;R<80;++R)n=(((T=(F=t[R-2])[0])>>>19|(B=F[1])<<13)^(B>>>29|T<<3)^T>>>6)>>>0,o=((T<<13|B>>>19)^(B<<3|T>>>29)^(T<<26|B>>>6))>>>0,i=(((T=(D=t[R-15])[0])>>>1|(B=D[1])<<31)^(T>>>8|B<<24)^T>>>7)>>>0,a=((T<<31|B>>>1)^(T<<24|B>>>8)^(T<<25|B>>>7))>>>0,k=t[R-7],L=t[R-16],B=o+k[1]+a+L[1],t[R][0]=n+k[0]+i+L[0]+(B/4294967296>>>0)>>>0,t[R][1]=B>>>0;for(f=e[0][0],g=e[0][1],m=e[1][0],U=e[1][1],y=e[2][0],v=e[2][1],S=e[3][0],_=e[3][1],b=e[4][0],w=e[4][1],C=e[5][0],x=e[5][1],P=e[6][0],A=e[6][1],I=e[7][0],E=e[7][1],R=0;R<80;++R)d=((b>>>14|w<<18)^(b>>>18|w<<14)^(w>>>9|b<<23))>>>0,c=(P^b&(C^P))>>>0,s=((f>>>28|g<<4)^(g>>>2|f<<30)^(g>>>7|f<<25))>>>0,l=((f<<4|g>>>28)^(g<<30|f>>>2)^(g<<25|f>>>7))>>>0,p=(f&m|y&(f^m))>>>0,h=(g&U|v&(g^U))>>>0,B=E+(((b<<18|w>>>14)^(b<<14|w>>>18)^(w<<23|b>>>9))>>>0)+((A^w&(x^A))>>>0)+u[R][1]+t[R][1],n=I+d+c+u[R][0]+t[R][0]+(B/4294967296>>>0)>>>0,o=B>>>0,i=s+p+((B=l+h)/4294967296>>>0)>>>0,a=B>>>0,I=P,E=A,P=C,A=x,C=b,x=w,b=S+n+((B=_+o)/4294967296>>>0)>>>0,w=B>>>0,S=y,_=v,y=m,v=U,m=f,U=g,f=n+i+((B=o+a)/4294967296>>>0)>>>0,g=B>>>0;B=e[0][1]+g,e[0][0]=e[0][0]+f+(B/4294967296>>>0)>>>0,e[0][1]=B>>>0,B=e[1][1]+U,e[1][0]=e[1][0]+m+(B/4294967296>>>0)>>>0,e[1][1]=B>>>0,B=e[2][1]+v,e[2][0]=e[2][0]+y+(B/4294967296>>>0)>>>0,e[2][1]=B>>>0,B=e[3][1]+_,e[3][0]=e[3][0]+S+(B/4294967296>>>0)>>>0,e[3][1]=B>>>0,B=e[4][1]+w,e[4][0]=e[4][0]+b+(B/4294967296>>>0)>>>0,e[4][1]=B>>>0,B=e[5][1]+x,e[5][0]=e[5][0]+C+(B/4294967296>>>0)>>>0,e[5][1]=B>>>0,B=e[6][1]+A,e[6][0]=e[6][0]+P+(B/4294967296>>>0)>>>0,e[6][1]=B>>>0,B=e[7][1]+E,e[7][0]=e[7][0]+I+(B/4294967296>>>0)>>>0,e[7][1]=B>>>0,O-=128}}var o=r(0);r(1),r(2);var i=e.exports=o.sha512=o.sha512||{};o.md.sha512=o.md.algorithms.sha512=i;var a=o.sha384=o.sha512.sha384=o.sha512.sha384||{};a.create=function(){return i.create("SHA-384")},o.md.sha384=o.md.algorithms.sha384=a,o.sha512.sha256=o.sha512.sha256||{create:function(){return i.create("SHA-512/256")}},o.md["sha512/256"]=o.md.algorithms["sha512/256"]=o.sha512.sha256,o.sha512.sha224=o.sha512.sha224||{create:function(){return i.create("SHA-512/224")}},o.md["sha512/224"]=o.md.algorithms["sha512/224"]=o.sha512.sha224,i.create=function(e){if(l||(s=String.fromCharCode(128),s+=o.util.fillString(String.fromCharCode(0),128),u=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],(d={})["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],d["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],d["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],d["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],l=!0),void 0===e&&(e="SHA-512"),!(e in d))throw new Error("Invalid SHA-512 algorithm: "+e);for(var t=d[e],r=null,i=o.util.createBuffer(),a=new Array(80),c=0;c<80;++c)a[c]=new Array(2);var p=64;switch(e){case"SHA-384":p=48;break;case"SHA-512/256":p=32;break;case"SHA-512/224":p=28}var h={algorithm:e.replace("-","").toLowerCase(),blockLength:128,digestLength:p,messageLength:0,fullMessageLength:null,messageLengthSize:16,start:function(){h.messageLength=0,h.fullMessageLength=h.messageLength128=[];for(var e=h.messageLengthSize/4,n=0;n<e;++n)h.fullMessageLength.push(0);i=o.util.createBuffer(),r=new Array(t.length);for(n=0;n<t.length;++n)r[n]=t[n].slice(0);return h}};return h.start(),h.update=function(e,t){"utf8"===t&&(e=o.util.encodeUtf8(e));var s=e.length;h.messageLength+=s,s=[s/4294967296>>>0,s>>>0];for(var l=h.fullMessageLength.length-1;l>=0;--l)h.fullMessageLength[l]+=s[1],s[1]=s[0]+(h.fullMessageLength[l]/4294967296>>>0),h.fullMessageLength[l]=h.fullMessageLength[l]>>>0,s[0]=s[1]/4294967296>>>0;return i.putBytes(e),n(r,a,i),(i.read>2048||0===i.length())&&i.compact(),h},h.digest=function(){var t=o.util.createBuffer();t.putBytes(i.bytes());var l=h.fullMessageLength[h.fullMessageLength.length-1]+h.messageLengthSize&h.blockLength-1;t.putBytes(s.substr(0,h.blockLength-l));for(var u,d=8*h.fullMessageLength[0],c=0;c<h.fullMessageLength.length-1;++c)d+=(u=8*h.fullMessageLength[c+1])/4294967296>>>0,t.putInt32(d>>>0),d=u>>>0;t.putInt32(d);var p=new Array(r.length);for(c=0;c<r.length;++c)p[c]=r[c].slice(0);n(p,a,t);var f,g=o.util.createBuffer();f="SHA-512"===e?p.length:"SHA-384"===e?p.length-2:p.length-4;for(c=0;c<f;++c)g.putInt32(p[c][0]),c===f-1&&"SHA-512/224"===e||g.putInt32(p[c][1]);return g},h};var s=null,l=!1,u=null,d=null},function(e,t,r){e.exports=r(3)}])});